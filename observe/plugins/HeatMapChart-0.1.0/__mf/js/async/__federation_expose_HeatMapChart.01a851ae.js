"use strict";(self.webpackChunkHeatMapChart=self.webpackChunkHeatMapChart||[]).push([["378"],{6568:function(e,t,a){a.r(t),a.d(t,{HeatMapChart:()=>F});var o=a(4246),r=a(7895),i=a(2629),n=a(6494),l=a(5409),s=a.n(l);let d={unit:"decimal"};var u=a(5283),p=a(2054),h=a(4538),m=a(7804),c=a(6232),f=a(7835),x=a(4776),g=a(43);(0,c.D)([f.N]);let y=["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"];function v(e){let{width:t,height:a,data:r,xAxisCategories:n,yAxisCategories:l,yAxisFormat:s,countFormat:d,countMin:u,countMax:p,timeScale:c,showVisualMap:f}=e,v=(0,i.useChartsTheme)(),F=(0,x.Z)(),{timeZone:M}=(0,i.useTimeZone)(),C=(0,h.useMemo)(()=>{var e;return{tooltip:{appendToBody:!0,formatter:e=>(function(e){let{data:t,label:a,marker:o,xAxisCategories:r,yAxisCategories:n,theme:l,yAxisFormat:s,countFormat:d}=e,[u,p]=t,h=r[u],{formattedDate:c,formattedTime:f}=(0,i.getDateAndTime)(h),x=(0,g.iv)`
    border-bottom: 1px solid ${l.palette.grey[500]};
    padding-bottom: 8px;
  `,y=(0,g.iv)`
    display: flex;
    justify-content: space-between;
    padding-top: 8px;
  `,v=(0,g.iv)`
    margin-right: 16px;
  `,F=parseFloat(n[p]),M=n[p+1]?parseFloat(n[p+1]):parseFloat(n[p])+parseFloat(n[p])-parseFloat(n[p-1]);return`
    <div>
      <div style="${x.styles}">${c} ${f}</div>
      <div style="${y.styles}">
        <div style="${v.styles}">
          ${o}
          <strong>${(0,m.formatValue)(F,s)} - ${(0,m.formatValue)(M,s)}</strong>
        </div>
        <div>
          ${(0,m.formatValue)(parseFloat(a),d)}
        </div>
      </div>
    </div>
  `})({data:e.data.value,label:e.data.label,marker:e.marker,xAxisCategories:n,yAxisCategories:l,theme:F,yAxisFormat:s,countFormat:d})},xAxis:{type:"category",data:n,axisLabel:{hideOverlap:!0,formatter:(e=(null==c?void 0:c.rangeMs)??0,function(t){let a=new Date(Number(t));return e>15768e7?(0,i.formatWithTimeZone)(a,"yyy",M):e>63072e6?(0,i.formatWithTimeZone)(a,"MMM yyy",M):e>864e6&&e<1577664e4?(0,i.formatWithTimeZone)(a,"dd.MM",M):e>1728e5&&e<=864e6?(0,i.formatWithTimeZone)(a,"dd.MM HH:mm",M):(0,i.formatWithTimeZone)(a,"HH:mm",M)})}},yAxis:(0,i.getFormattedAxis)({type:"category",data:l},s),visualMap:{show:f??!1,type:"continuous",min:u,max:p,realtime:!1,itemHeight:a-30,itemWidth:10,orient:"vertical",left:"right",top:"center",inRange:{color:y},textStyle:{color:F.palette.text.primary,textBorderColor:F.palette.background.default,textBorderWidth:5}},series:[{name:"Gaussian",type:"heatmap",data:r,emphasis:{itemStyle:{borderColor:"#333",borderWidth:1}},progressive:1e3,animation:!1}]}},[n,null==c?void 0:c.rangeMs,M,l,s,f,u,p,a,F,r,d]),b=(0,h.useMemo)(()=>(0,o.jsx)(i.EChart,{sx:{width:t,height:a,padding:`${v.container.padding.default}px`},option:C,theme:v.echartsTheme}),[v.container.padding.default,v.echartsTheme,a,C,t]);return(0,o.jsx)(o.Fragment,{children:b})}let F={PanelComponent:function(e){let{spec:t,contentDimensions:a,queryResults:r}=e,i=s()({},d,t.yAxisFormat),n=s()({},d,t.countFormat),{data:l,xAxisCategories:c,yAxisCategories:f,countMin:x,countMax:g,timeScale:y}=(0,h.useMemo)(()=>{if(!r||0===r.length||1!=r.length||1!=r[0].data.series.length||void 0===r[0].data.series[0].histograms)return{data:[],xAxisCategories:[],yAxisCategories:[],countMin:0,countMax:0,timeScale:void 0};let e=r[0].data.series[0],t=function(e){let t=e.map(e=>e.data);return(0,m.getCommonTimeScale)(t)}(r),o=function(e){if(!e)return[];let{startMs:t,endMs:a,stepMs:o}=e,r=[];for(let e=t;e<=a;e+=o)r.push(e);return r}(t),i=1/0,n=-1/0,l=1/0,s=-1/0;for(let[t,a]of(null==e?void 0:e.histograms)??[])for(let e of(null==a?void 0:a.buckets)??[]){let[t,a,o,r]=e,d=parseFloat(a),u=parseFloat(o),p=parseFloat(r);d<i&&(i=d),u>n&&(n=u),p<l&&(l=p),p>s&&(s=p)}let d=(null==a?void 0:a.height)??200,u=(n-i)*2/d,p=Array.from({length:Math.ceil(d/2)},(e,t)=>(i+t*u).toFixed(3)),h=[];for(let[t,a]of(null==e?void 0:e.histograms)??[]){let e=o.findIndex(e=>e===1e3*t);for(let t of(null==a?void 0:a.buckets)??[]){let[a,o,r,n]=t,l=Math.floor((parseFloat(o)-i)/u),s=Math.ceil((parseFloat(r)-i)/u);for(let t=0;t<s-l;t++)h.push({value:[e,l+t,parseFloat(n)],label:n})}}return{data:h,xAxisCategories:o,yAxisCategories:p,countMin:l,countMax:s,timeScale:t}},[null==a?void 0:a.height,r]);return r.length>1?(0,o.jsx)(u.Z,{justifyContent:"center",height:"100%",children:(0,o.jsx)(p.Z,{variant:"body2",textAlign:"center",children:"Only one query at a time is supported for now"})}):0===l.length?(0,o.jsx)(u.Z,{justifyContent:"center",height:"100%",children:(0,o.jsx)(p.Z,{variant:"body2",textAlign:"center",children:"No data available (only native histograms are supported for now)"})}):void 0===a?null:(0,o.jsx)(u.Z,{direction:"row",justifyContent:"center",alignItems:"center",children:(0,o.jsx)(v,{width:a.width,height:a.height,data:l,xAxisCategories:c,yAxisCategories:f,yAxisFormat:i,countFormat:n,countMin:x,countMax:g,timeScale:y,showVisualMap:t.showVisualMap})})},supportedQueryTypes:["TimeSeriesQuery"],queryOptions:{mode:"range"},panelOptionsEditorComponents:[{label:"Settings",content:function(e){let{onChange:t,value:a}=e,l=s()({},d,a.yAxisFormat),u=s()({},d,a.countFormat);return(0,o.jsxs)(i.OptionsEditorGrid,{children:[(0,o.jsx)(i.OptionsEditorColumn,{children:(0,o.jsxs)(i.OptionsEditorGroup,{title:"Bucket Count",children:[(0,o.jsx)(i.FormatControls,{value:u,onChange:e=>{t((0,n.produce)(a,t=>{t.countFormat=e}))}}),(0,o.jsx)(i.OptionsEditorControl,{label:"Show Visual Map",control:(0,o.jsx)(r.Z,{checked:!!a.showVisualMap,onChange:(e,o)=>{t((0,n.produce)(a,e=>{e.showVisualMap=o}))}})})]})}),(0,o.jsx)(i.OptionsEditorColumn,{children:(0,o.jsx)(i.OptionsEditorGroup,{title:"Y Axis",children:(0,o.jsx)(i.FormatControls,{value:l,onChange:e=>{t((0,n.produce)(a,t=>{t.yAxisFormat=e}))}})})})]})}}],createInitialOptions:function(){return{yAxisFormat:d,countFormat:d,showVisualMap:!0}}}}}]);