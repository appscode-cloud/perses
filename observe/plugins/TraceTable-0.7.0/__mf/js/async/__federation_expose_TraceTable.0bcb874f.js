"use strict";(self.webpackChunkTraceTable=self.webpackChunkTraceTable||[]).push([["671"],{2520:function(e,t,r){r.r(t),r.d(t,{TraceTable:()=>Z});var n=r(4246),l=r(6372),a=r(2629),i=r(4776),o=r(2054),s=r(2889),d=r(2964),c=r(886),u=r(2469),m=r(9085),p=r(7430),h=r(2026),f=r(982),x=r(4538),g=r(3915);let v=new g.Z({hue:{min:20,max:360}}),y=new g.Z({hue:{min:0,max:20}}),j={},C=new Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"medium"}).format,T=new Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"long",timeZone:"UTC"}).format;function b(e){var t,r,c;let{options:u,result:p,traceLink:g}=e,b=(0,i.Z)(),N=(0,a.useChartsTheme)(),Z=null===(r=u.visual)||void 0===r?void 0:null===(t=r.palette)||void 0===t?void 0:t.mode,k=(0,x.useCallback)(e=>(function(e,t,r,n){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return"categorical"===r?function(e,t,r,n){let l=t?n:r;if(0===l.length)return console.warn("getConsistentCategoricalColor() called with empty color palette, fallback to #000"),"#000";let a=0;for(let t=0;t<e.length;t++)a=e.charCodeAt(t)+((a<<5)-a);return l[Math.abs(a)%l.length]??"#000"}(n,l,t.echartsTheme.color,[e.palette.error.light,e.palette.error.main,e.palette.error.dark]):function(e,t){let r=`${e}_____${t}`,n=j[r];return n||(n=function(e,t){let[r,n,l]=t?y.hsl(e):v.hsl(e),a=`${(100*n).toFixed(0)}%`,i=`${(100*l).toFixed(0)}%`;return`hsla(${r.toFixed(2)},${a},${i},0.9)`}(e,t),j[r]=n),n}(n,l)})(b,N,Z,e),[b,N,Z]),$=[];for(let e of p)for(let t of(null===(c=e.data)||void 0===c?void 0:c.searchResult)||[])$.push({...t,id:t.traceId,traceLink:null==g?void 0:g({query:e.definition,traceId:t.traceId})});let O=(0,x.useMemo)(()=>[{field:"name",headerName:"Trace name",type:"string",flex:4,display:"flex",valueGetter:(e,t)=>`${t.rootServiceName}: ${t.rootTraceName}`,renderCell:e=>{let{row:t}=e;return(0,n.jsxs)(l.Z,{sx:{my:1},children:[(0,n.jsx)(S,{row:t}),(0,n.jsx)("br",{}),Object.entries(t.serviceStats).map(e=>{let[t,r]=e;return(0,n.jsx)(w,{serviceName:t,stats:r,serviceColor:k(t)},t)})]})}},{field:"spanCount",headerName:"Spans",type:"number",headerAlign:"left",align:"left",flex:2,minWidth:145,display:"flex",valueGetter:(e,t)=>Object.values(t.serviceStats).reduce((e,t)=>e+t.spanCount,0),renderCell:e=>{let{row:t}=e,r=0,l=0;for(let e of Object.values(t.serviceStats))r+=e.spanCount,l+=e.errorCount??0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o.Z,{display:"inline",children:[r," spans"]}),l>0&&(0,n.jsx)(s.Z,{label:`${l} error${1===l?"":"s"}`,sx:{marginLeft:"5px"},icon:(0,n.jsx)(h.default,{}),variant:"outlined",size:"small",color:"error"})]})}},{field:"durationMs",headerName:"Duration",type:"number",headerAlign:"left",align:"left",flex:1,minWidth:70,display:"flex",renderCell:e=>{let{row:t}=e;return(0,n.jsx)(o.Z,{display:"inline",children:t.durationMs<1?"<1ms":(0,m.LU)((0,m.oK)(t.durationMs))})}},{field:"startTimeUnixMs",headerName:"Start time",type:"number",headerAlign:"left",align:"left",flex:3,minWidth:240,display:"flex",renderCell:e=>{let{row:t}=e;return(0,n.jsx)(d.Z,{title:T(new Date(t.startTimeUnixMs)),placement:"top",arrow:!0,children:(0,n.jsx)(o.Z,{display:"inline",children:C(new Date(t.startTimeUnixMs))},`st-${t.traceId}`)})}}],[k]);return(0,n.jsx)(f._,{sx:{borderWidth:0},columns:O,rows:$,getRowHeight:()=>"auto",getEstimatedRowHeight:()=>66,disableRowSelectionOnClick:!0,pageSizeOptions:[10,20,50,100],initialState:{pagination:{paginationModel:{pageSize:20}}}})}function S(e){let{row:t}=e;return t.traceLink?(0,n.jsxs)(c.Z,{variant:"body1",color:"inherit",underline:"hover",component:p.Link,to:t.traceLink,children:[(0,n.jsxs)("strong",{children:[t.rootServiceName,":"]})," ",t.rootTraceName]}):(0,n.jsxs)(o.Z,{display:"inline",children:[(0,n.jsxs)("strong",{children:[t.rootServiceName,":"]})," ",t.rootTraceName]})}function w(e){let{serviceName:t,stats:r,serviceColor:l}=e;return(0,n.jsx)(s.Z,{label:t,variant:"outlined",size:"small",style:{"--service-color":l},sx:{marginTop:"5px",marginRight:"5px",borderColor:"var(--service-color)"},avatar:(0,n.jsx)(u.Z,{sx:{minWidth:"fit-content",padding:"6px",backgroundColor:"var(--service-color)",fontSize:"0.65rem",fontWeight:"bold",textShadow:"0 0 5px #fff"},children:r.spanCount})})}function N(e){let{query:t,traceId:r}=e,n=JSON.parse(JSON.stringify(t));n.spec.plugin.spec.query=r;let l=new URLSearchParams({explorer:"Tempo-TempoExplorer",data:JSON.stringify({queries:[n]})});return`/explore?${l}`}let Z={PanelComponent:function(e){let{spec:t,queryResults:r,traceLink:i}=e,o=(0,a.useChartsTheme)().container.padding.default;return r.some(e=>{var t;return((null===(t=e.data)||void 0===t?void 0:t.searchResult)??[]).length>0})?(0,n.jsx)(l.Z,{sx:{height:"100%",padding:`${o}px`,overflowY:"auto"},children:(0,n.jsx)(b,{options:t,result:r,traceLink:null===i?void 0:i??N})}):(0,n.jsx)(a.NoDataOverlay,{resource:"traces"})},supportedQueryTypes:["TraceQuery"],createInitialOptions:function(){return{}}}}}]);