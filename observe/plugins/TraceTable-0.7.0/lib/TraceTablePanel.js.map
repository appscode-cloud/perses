{"version":3,"sources":["../../src/TraceTablePanel.tsx"],"sourcesContent":["// Copyright 2024 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { PanelProps } from '@perses-dev/plugin-system';\nimport { Box } from '@mui/material';\nimport { NoDataOverlay, useChartsTheme } from '@perses-dev/components';\nimport { QueryDefinition, TraceData } from '@perses-dev/core';\nimport { ReactElement } from 'react';\nimport { DataTable, TraceLink } from './DataTable';\nimport { TraceTableOptions } from './trace-table-model';\n\nexport interface TraceTablePanelProps extends PanelProps<TraceTableOptions, TraceData> {\n  /**\n   * Specify a link for the traces in the table.\n   * If this field is unset or undefined, a link to the Gantt chart on the explore page is configured.\n   * Set this field explicitly to null to disable creating a link.\n   */\n  traceLink?: TraceLink | null;\n}\n\nexport function defaultTraceLink({\n  query: originalQuery,\n  traceId,\n}: {\n  query: QueryDefinition;\n  traceId: string;\n}): string {\n  // clone the original query spec (including the datasource) and replace the query value with the trace id\n  const query: QueryDefinition = JSON.parse(JSON.stringify(originalQuery));\n  query.spec.plugin.spec.query = traceId;\n\n  const traceLinkParams = new URLSearchParams({\n    explorer: 'Tempo-TempoExplorer',\n    data: JSON.stringify({ queries: [query] }),\n  });\n\n  return `/explore?${traceLinkParams}`;\n}\n\nexport function TraceTablePanel(props: TraceTablePanelProps): ReactElement {\n  const { spec, queryResults, traceLink } = props;\n\n  const chartsTheme = useChartsTheme();\n  const contentPadding = chartsTheme.container.padding.default;\n\n  const tracesFound = queryResults.some((traceData) => (traceData.data?.searchResult ?? []).length > 0);\n  if (!tracesFound) {\n    return <NoDataOverlay resource=\"traces\" />;\n  }\n\n  return (\n    <Box sx={{ height: '100%', padding: `${contentPadding}px`, overflowY: 'auto' }}>\n      <DataTable\n        options={spec}\n        result={queryResults}\n        traceLink={traceLink === null ? undefined : (traceLink ?? defaultTraceLink)}\n      />\n    </Box>\n  );\n}\n"],"names":["Box","NoDataOverlay","useChartsTheme","DataTable","defaultTraceLink","query","originalQuery","traceId","JSON","parse","stringify","spec","plugin","traceLinkParams","URLSearchParams","explorer","data","queries","TraceTablePanel","props","queryResults","traceLink","chartsTheme","contentPadding","container","padding","default","tracesFound","some","traceData","searchResult","length","resource","sx","height","overflowY","options","result","undefined"],"mappings":"AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;AAGjC,SAASA,GAAG,QAAQ,gBAAgB;AACpC,SAASC,aAAa,EAAEC,cAAc,QAAQ,yBAAyB;AAGvE,SAASC,SAAS,QAAmB,cAAc;AAYnD,OAAO,SAASC,iBAAiB,EAC/BC,OAAOC,aAAa,EACpBC,OAAO,EAIR;IACC,yGAAyG;IACzG,MAAMF,QAAyBG,KAAKC,KAAK,CAACD,KAAKE,SAAS,CAACJ;IACzDD,MAAMM,IAAI,CAACC,MAAM,CAACD,IAAI,CAACN,KAAK,GAAGE;IAE/B,MAAMM,kBAAkB,IAAIC,gBAAgB;QAC1CC,UAAU;QACVC,MAAMR,KAAKE,SAAS,CAAC;YAAEO,SAAS;gBAACZ;aAAM;QAAC;IAC1C;IAEA,OAAO,CAAC,SAAS,EAAEQ,iBAAiB;AACtC;AAEA,OAAO,SAASK,gBAAgBC,KAA2B;IACzD,MAAM,EAAER,IAAI,EAAES,YAAY,EAAEC,SAAS,EAAE,GAAGF;IAE1C,MAAMG,cAAcpB;IACpB,MAAMqB,iBAAiBD,YAAYE,SAAS,CAACC,OAAO,CAACC,OAAO;IAE5D,MAAMC,cAAcP,aAAaQ,IAAI,CAAC,CAACC,YAAc,AAACA,CAAAA,UAAUb,IAAI,EAAEc,gBAAgB,EAAE,AAAD,EAAGC,MAAM,GAAG;IACnG,IAAI,CAACJ,aAAa;QAChB,qBAAO,KAAC1B;YAAc+B,UAAS;;IACjC;IAEA,qBACE,KAAChC;QAAIiC,IAAI;YAAEC,QAAQ;YAAQT,SAAS,GAAGF,eAAe,EAAE,CAAC;YAAEY,WAAW;QAAO;kBAC3E,cAAA,KAAChC;YACCiC,SAASzB;YACT0B,QAAQjB;YACRC,WAAWA,cAAc,OAAOiB,YAAajB,aAAajB;;;AAIlE"}