{"version":3,"sources":["../../../src/utils/get-color.ts"],"sourcesContent":["// Copyright 2024 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { PersesChartsTheme } from '@perses-dev/components';\nimport { applyValueMapping, ThresholdOptions, ValueMapping } from '@perses-dev/core';\nimport { StatChartOptions } from '../stat-chart-model';\n\ntype StatChartValue = number | string | null;\n\nexport function getStatChartColor(\n  chartsTheme: PersesChartsTheme,\n  spec?: StatChartOptions,\n  value?: StatChartValue\n): string {\n  const { mappings, thresholds } = spec ?? {};\n\n  // Determine the default color from thresholds or theme\n  const defaultColor = thresholds?.defaultColor ?? chartsTheme.thresholds.defaultColor;\n\n  if (!value || (!thresholds?.steps && !mappings)) {\n    return defaultColor;\n  }\n\n  // Check mappings first\n  if (mappings?.length) {\n    const colorFromMappings = getColorFromMappings(value, mappings);\n    if (colorFromMappings) {\n      return colorFromMappings;\n    }\n  }\n\n  // Check thresholds next\n  if (thresholds) {\n    const colorFromThresholds = getColorFromThresholds(value, thresholds, chartsTheme, defaultColor);\n    if (colorFromThresholds) {\n      return colorFromThresholds;\n    }\n  }\n\n  // Fallback to default color\n  return defaultColor;\n}\n\nfunction getColorFromMappings(value: StatChartValue, mappings: ValueMapping[]): string | null {\n  if (mappings?.length && value) {\n    const { color } = applyValueMapping(value, mappings);\n    return color || null;\n  }\n  return null;\n}\n\nfunction getColorFromThresholds(\n  value: StatChartValue,\n  thresholds: ThresholdOptions,\n  chartsTheme: PersesChartsTheme,\n  defaultColor: string\n): string | null {\n  if (thresholds?.steps && typeof value === 'number') {\n    const matchingColors = thresholds.steps\n      .map((step, index) => {\n        if (value >= step.value) {\n          return step.color ?? chartsTheme.thresholds.palette[index] ?? defaultColor;\n        }\n        return null;\n      })\n      .filter((color): color is string => color !== null);\n\n    return matchingColors[matchingColors.length - 1] ?? null;\n  }\n  return null;\n}\n"],"names":["applyValueMapping","getStatChartColor","chartsTheme","spec","value","mappings","thresholds","defaultColor","steps","length","colorFromMappings","getColorFromMappings","colorFromThresholds","getColorFromThresholds","color","matchingColors","map","step","index","palette","filter"],"mappings":"AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;AAGjC,SAASA,iBAAiB,QAAwC,mBAAmB;AAKrF,OAAO,SAASC,kBACdC,WAA8B,EAC9BC,IAAuB,EACvBC,KAAsB;IAEtB,MAAM,EAAEC,QAAQ,EAAEC,UAAU,EAAE,GAAGH,QAAQ,CAAC;IAE1C,uDAAuD;IACvD,MAAMI,eAAeD,YAAYC,gBAAgBL,YAAYI,UAAU,CAACC,YAAY;IAEpF,IAAI,CAACH,SAAU,CAACE,YAAYE,SAAS,CAACH,UAAW;QAC/C,OAAOE;IACT;IAEA,uBAAuB;IACvB,IAAIF,UAAUI,QAAQ;QACpB,MAAMC,oBAAoBC,qBAAqBP,OAAOC;QACtD,IAAIK,mBAAmB;YACrB,OAAOA;QACT;IACF;IAEA,wBAAwB;IACxB,IAAIJ,YAAY;QACd,MAAMM,sBAAsBC,uBAAuBT,OAAOE,YAAYJ,aAAaK;QACnF,IAAIK,qBAAqB;YACvB,OAAOA;QACT;IACF;IAEA,4BAA4B;IAC5B,OAAOL;AACT;AAEA,SAASI,qBAAqBP,KAAqB,EAAEC,QAAwB;IAC3E,IAAIA,UAAUI,UAAUL,OAAO;QAC7B,MAAM,EAAEU,KAAK,EAAE,GAAGd,kBAAkBI,OAAOC;QAC3C,OAAOS,SAAS;IAClB;IACA,OAAO;AACT;AAEA,SAASD,uBACPT,KAAqB,EACrBE,UAA4B,EAC5BJ,WAA8B,EAC9BK,YAAoB;IAEpB,IAAID,YAAYE,SAAS,OAAOJ,UAAU,UAAU;QAClD,MAAMW,iBAAiBT,WAAWE,KAAK,CACpCQ,GAAG,CAAC,CAACC,MAAMC;YACV,IAAId,SAASa,KAAKb,KAAK,EAAE;gBACvB,OAAOa,KAAKH,KAAK,IAAIZ,YAAYI,UAAU,CAACa,OAAO,CAACD,MAAM,IAAIX;YAChE;YACA,OAAO;QACT,GACCa,MAAM,CAAC,CAACN,QAA2BA,UAAU;QAEhD,OAAOC,cAAc,CAACA,eAAeN,MAAM,GAAG,EAAE,IAAI;IACtD;IACA,OAAO;AACT"}