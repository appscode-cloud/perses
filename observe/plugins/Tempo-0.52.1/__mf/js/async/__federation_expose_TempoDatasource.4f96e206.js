/*! For license information please see __federation_expose_TempoDatasource.4f96e206.js.LICENSE.txt */
"use strict";(self.webpackChunkTempo=self.webpackChunkTempo||[]).push([["2509"],{35015:function(e,t,r){async function n(...e){let t=await r.g.fetch(...e);if(!1===t.ok){let e=t.headers.get("content-type");if(e?.includes("application/json")){let e=await t.json();if(e.error)throw new s(e.error,t.status);if(e.message)throw new s(e.message,t.status)}let r=await t.text();if(r)throw new s(r,t.status);throw new o(t)}return t}async function a(...e){let t=await n(...e);return await t.json()}r.d(t,{he:()=>n,rd:()=>a});class o extends Error{status;constructor(e){super(`${e.status} ${e.statusText}`),this.status=e.status,Object.setPrototypeOf(this,o.prototype)}}class s extends Error{status;constructor(e,t){super(e),this.status=t,Object.setPrototypeOf(this,s.prototype)}}},71426:function(e,t,r){var n=r(54538),a=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var n,o={},u=null,l=null;for(n in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,n)&&!c.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:a,type:e,key:u,ref:l,props:o,_owner:i.current}}t.Fragment=o,t.jsx=u,t.jsxs=u},24246:function(e,t,r){e.exports=r(71426)},77792:function(e,t,r){r.r(t),r.d(t,{TempoDatasource:()=>p});var n=r(35015);let a=async function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let a=await (0,n.he)(...t);try{return await a.json()}catch(e){throw console.error("Invalid response from server",e),Error("Invalid response from server")}};function o(e,t,r){let{datasourceUrl:n,headers:o={}}=r,s=`${n}${e}`,i=(function(e){let t=new URLSearchParams;for(let r in e){let n=e[r];switch(typeof n){case"string":t.append(r,n);break;case"number":t.append(r,n.toString())}}return t})(t).toString();return""!==i&&(s+="?"+i),a(s,{method:"GET",headers:o})}function s(e,t){return o("/api/search",e,t)}function i(e,t){return o(`/api/traces/${encodeURIComponent(e.traceId)}`,{},t)}async function c(e,t){let r=await s(e,t);return r.traces&&0!==r.traces.length?r.traces.every(e=>e.serviceStats)?r:{traces:await Promise.all(r.traces.map(async e=>{if(e.serviceStats)return e;let r={};for(let o of(await i({traceId:e.traceID},t)).batches){var n,a;let e="unknown";for(let t of(null===(n=o.resource)||void 0===n?void 0:n.attributes)??[])if("service.name"===t.key&&"stringValue"in t.value){e=t.value.stringValue;break}let t=r[e]??{spanCount:0};for(let e of o.scopeSpans)for(let r of(t.spanCount+=e.spans.length,e.spans))(null===(a=r.status)||void 0===a?void 0:a.code)==="STATUS_CODE_ERROR"&&(t.errorCount=(t.errorCount??0)+1);r[e]=t}return{...e,serviceStats:r}}))}:{traces:[]}}var u=r(24246),l=r(58891);r(54538);let p={createClient:(e,t)=>{let{directUrl:r,proxy:n}=e,{proxyUrl:a}=t,u=r??a;if(void 0===u)throw Error("No URL specified for Tempo client. You can use directUrl in the spec to configure it.");let l=null==n?void 0:n.spec.headers;return{options:{datasourceUrl:u},query:(e,t)=>i(e,{datasourceUrl:u,headers:t??l}),search:(e,t)=>s(e,{datasourceUrl:u,headers:t??l}),searchWithFallback:(e,t)=>c(e,{datasourceUrl:u,headers:t??l}),searchTags:(e,t)=>o("/api/v2/search/tags",e,{datasourceUrl:u,headers:t??l}),searchTagValues:(e,t)=>(function(e,t){let{tag:r,...n}=e;return o(`/api/v2/search/tag/${encodeURIComponent(r)}/values`,n,t)})(e,{datasourceUrl:u,headers:t??l})}},OptionsEditorComponent:function(e){let{value:t,onChange:r,isReadonly:n}=e;return(0,u.jsx)(l.HTTPSettingsEditor,{value:t,onChange:r,isReadonly:n,initialSpecDirect:{directUrl:""},initialSpecProxy:{proxy:{kind:"HTTPProxy",spec:{allowedEndpoints:[{endpointPattern:"/api/search",method:"GET"},{endpointPattern:"/api/traces",method:"GET"},{endpointPattern:"/api/v2/search/tags",method:"GET"},{endpointPattern:"/api/v2/search/tag",method:"GET"}],url:""}}}})},createInitialOptions:()=>({directUrl:""})}}}]);