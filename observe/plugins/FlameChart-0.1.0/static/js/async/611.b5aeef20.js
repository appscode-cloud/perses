"use strict";(self.webpackChunkFlameChart=self.webpackChunkFlameChart||[]).push([["611"],{8193:function(e,n,r){r.d(n,{BL:()=>s,Jj:()=>d,bk:()=>c,dT:()=>p,kx:()=>l,vo:()=>o,zx:()=>u});let t=["bottom","right"],i=["list","table"],a=["small","medium"];function o(e){return t.includes(e)}function l(e){return i.includes(e)}function s(e){return a.includes(e)}let u={position:"bottom",mode:"list",size:"medium"};function d(e){return void 0===e?u.position:o(e)?e:u.position}function c(e){return e&&l(e)?e:u.mode}function p(e){return e&&s(e)?e:u.size}},78639:function(e,n,r){r.r(n),r.d(n,{LEGEND_SIZE_CONFIG:()=>e4,PanelSpecEditor:()=>nx,validateLegendSpec:()=>e6,ProjectStoreProvider:()=>n9,useInitialRefreshInterval:()=>rd,MultiQueryEditor:()=>nu,useReplaceVariablesInString:()=>eR,LEGEND_VALUE_CONFIG:()=>e7,VariableListPreview:()=>nG,TimeRangeSettingsContext:()=>nV,selectorToOptionValue:()=>e_,DEFAULT_REFRESH_INTERVAL_OPTIONS:()=>nA,OptionsEditorTabs:()=>np,replaceVariables:()=>ek,DatasourceSelect:()=>eq,useActiveTimeSeriesQueries:()=>rj,getVariableValuesKey:()=>nF,useListVariablePluginValues:()=>n$,usePluginBuiltinVariableDefinitions:()=>et,TimeRangeProvider:()=>nZ,useListDatasourceSelectItems:()=>ej,BuiltinVariableContext:()=>eZ,useUsageMetrics:()=>rZ,useShowCustomTimeRangeSetting:()=>nI,useTraceQueries:()=>rT,CalculationSelector:()=>l,useSetRefreshIntervalParams:()=>rc,QueryCountProvider:()=>nm,decodeTimeRangeValue:()=>ri,usePluginRegistry:()=>X,TRACE_QUERY_KEY:()=>rP,useBuiltinVariableDefinitions:()=>ez,TimeRangeProviderWithQueryParams:()=>rp,ProjectSelect:()=>re,TOOLTIP_TEXT:()=>nC,datasourceSelectValueToSelector:()=>eU,OptionsEditorRadios:()=>eX,useProjectList:()=>n6,useTimeRangeContext:()=>nT,VariablePreview:()=>nK,useDataQueriesContext:()=>rD,usePlugins:()=>en,useBuiltinVariableValues:()=>eV,TimeRangeSettingsProvider:()=>nR,useProjectStore:()=>n8,LEGEND_MODE_CONFIG:()=>e3,useDatasourceStore:()=>ey,ValidationProvider:()=>B,mockPluginRegistry:()=>rA,LEGEND_POSITIONS_CONFIG:()=>e5,PluginLoaderComponent:()=>rG,getMockPluginName:()=>rM,useQueryCountContext:()=>nh,getUnixTimeRange:()=>rk,TimeRangeParam:()=>ra,useShowZoomRangeSetting:()=>nD,replaceVariable:()=>eT,useTimeRangeSettingsContext:()=>nz,useTimeSeriesQueries:()=>rb,remotePluginLoader:()=>rY,LegendOptionsEditor:()=>nr,useTimeRangeOptionsSetting:()=>nL,useDatasourceSelectValueToSelector:()=>eB,optionValueToSelector:()=>eN,useBuiltinVariableContext:()=>eS,PluginSpecEditor:()=>es,encodeTimeRangeValue:()=>rt,useListPluginMetadata:()=>er,useQueryType:()=>rO,VariableEditorForm:()=>nX,useTimeSeriesQuery:()=>rv,DataQueriesContext:()=>rI,PluginKindSelect:()=>ei,filterVariableList:()=>nq,useSuggestedStepMs:()=>nw,useTimeRange:()=>nE,DataQueriesProvider:()=>rR,isVariableDatasource:()=>eQ,PluginRegistry:()=>nf,getActiveTimeSeriesQueries:()=>rC,usePluginEditor:()=>ec,useValidationSchemas:()=>U,PluginRegistryContext:()=>Y,UsageMetricsProvider:()=>rV,TimeRangeControls:()=>nM,usePlugin:()=>ee,legendValues:()=>e2,timeRangeQueryConfig:()=>ro,MetricLabelInput:()=>rn,VariableContext:()=>eI,HTTPSettingsEditor:()=>e0,VARIABLE_TYPES:()=>n_,getSubmitText:()=>K,refreshIntervalQueryConfig:()=>rl,useUsageMetricsContext:()=>rw,useVariableValues:()=>eD,ValidationSchemasContext:()=>Q,dynamicImportPluginLoader:()=>rr,PluginEditor:()=>ep,TimeRangeContext:()=>nk,transformQueryResults:()=>rz,useDataQueries:()=>rL,useDatasource:()=>eP,getTitleAction:()=>W,parseVariables:()=>ew,ProjectStoreContext:()=>n7,useAllVariableValues:()=>eL,useTimeRangeSettings:()=>nO,UsageMetricsContext:()=>rE,useTimeRangeParams:()=>ru,DatasourceName:()=>e$,useInitialTimeRange:()=>rs,VariableStoreStateMap:()=>eO,DatasourceStoreContext:()=>eb,TIME_SERIES_QUERY_KEY:()=>rx,DatasourceEditorForm:()=>eg,useDatasourceClient:()=>eC});var t=r(24246),i=r(20370);let a={first:{label:"First",description:"First value"},last:{label:"Last",description:"Last value"},"first-number":{label:"First *",description:"First numeric value"},"last-number":{label:"Last *",description:"Last numeric value"},mean:{label:"Avg",description:"Average value excluding nulls"},sum:{label:"Sum",description:"The sum of all values"},min:{label:"Min",description:"Minimum value"},max:{label:"Max",description:"Maximum value"}},o=Object.entries(a).map(([e,n])=>({id:e,...n}));function l({value:e,onChange:n}){let r=a[e];return(0,t.jsx)(i.OptionsEditorControl,{label:"Calculation",control:(0,t.jsx)(i.SettingsAutocomplete,{value:{...r,id:e},options:o,onChange:(e,r)=>{n(r.id)},disableClearable:!0})})}var s=r(494),u=r(36372),d=r(52054),c=r(38359),p=r(8695),g=r(25283),m=r(28797),h=r(87895),x=r(79119),f=r(54538),v=r.n(f),b=r(36679),y=r(77891);let j=y.z.string().min(1,"Required").max(75,"Must be 75 or fewer characters long").regex(/^[a-zA-Z0-9_.-]+$/,"Must only contains alphanumerical characters and special characters _ . -"),C=y.z.object({name:j}),P=C.extend({project:j}),k=y.z.object({kind:y.z.string().min(1,"Required"),spec:y.z.record(y.z.string(),y.z.any())}),T=y.z.object({name:y.z.string().optional(),description:y.z.string().optional()}),E=y.z.object({display:T.optional(),default:y.z.boolean(),plugin:k}),w=y.z.object({kind:y.z.literal("Datasource"),metadata:P,spec:E}),Z=y.z.object({kind:y.z.literal("GlobalDatasource"),metadata:C,spec:E});y.z.discriminatedUnion("kind",[w,Z]);let S=y.z.object({name:y.z.string().min(1),spec:E}),V=y.z.object({name:y.z.string().min(1,{message:"Required"}),description:y.z.string().optional()}),z=y.z.object({kind:y.z.string().min(1),spec:y.z.object({plugin:k})}),O=y.z.object({name:y.z.string().optional(),url:y.z.string().min(1),tooltip:y.z.string().optional(),renderVariables:y.z.boolean().optional(),targetBlank:y.z.boolean().optional()}),I=y.z.object({display:V,plugin:k,queries:y.z.array(z).optional(),links:y.z.array(O).optional()}),D=y.z.object({kind:y.z.literal("Panel"),spec:I}),L=y.z.object({groupId:y.z.number(),panelDefinition:D}),R=y.z.object({name:y.z.string().optional(),description:y.z.string().optional(),hidden:y.z.boolean().optional()}),A=y.z.object({name:y.z.string().min(1),display:R.optional(),defaultValue:y.z.string().or(y.z.array(y.z.string())).optional(),allowAllValue:y.z.boolean(),allowMultiple:y.z.boolean(),customAllValue:y.z.string().optional(),capturingRegexp:y.z.string().optional(),sort:y.z.enum(["none","alphabetical-asc","alphabetical-desc","numerical-asc","numerical-desc","alphabetical-ci-asc","alphabetical-ci-desc"]).optional(),plugin:k}),M=y.z.object({kind:y.z.literal("ListVariable"),spec:A}),q=y.z.object({name:y.z.string().min(1),display:R.optional(),value:y.z.string(),constant:y.z.boolean().optional()}),$=y.z.object({kind:y.z.literal("TextVariable"),spec:q}),F=y.z.discriminatedUnion("kind",[$,M]),_=y.z.object({kind:y.z.literal("Variable"),metadata:P,spec:F}),N=y.z.object({kind:y.z.literal("GlobalVariable"),metadata:P,spec:F});y.z.discriminatedUnion("kind",[_,N]);let Q=(0,f.createContext)(void 0);function U(){let e=(0,f.useContext)(Q);if(void 0===e)throw Error("No ValidationSchemasContext found. Did you forget a Provider?");return e}function B({children:e}){let[n,r]=(0,f.useState)(S),[i,a]=(0,f.useState)(L),[o,l]=(0,f.useState)(F);return(0,t.jsx)(Q.Provider,{value:{datasourceEditorSchema:n,panelEditorSchema:i,variableEditorSchema:o,setDatasourceEditorSchemaPlugin:function(e){r(y.z.object({name:y.z.string().min(1),spec:y.z.object({display:T.optional(),default:y.z.boolean(),plugin:e})}))},setPanelEditorSchemaPlugin:function(e){a(y.z.object({groupId:y.z.number(),panelDefinition:y.z.object({kind:y.z.literal("Panel"),spec:y.z.object({display:V,plugin:e,queries:y.z.array(z).optional(),links:y.z.array(O).optional()})})}))},setVariableEditorSchemaPlugin:function(e){l(y.z.discriminatedUnion("kind",[y.z.object({kind:y.z.literal("ListVariable"),spec:y.z.object({name:y.z.string().min(1),display:R.optional(),defaultValue:y.z.string().or(y.z.array(y.z.string())).optional(),allowAllValue:y.z.boolean(),allowMultiple:y.z.boolean(),customAllValue:y.z.string().optional(),capturingRegexp:y.z.string().optional(),sort:y.z.enum(["none","alphabetical-asc","alphabetical-desc","numerical-asc","numerical-desc","alphabetical-ci-asc","alphabetical-ci-desc"]).optional(),plugin:e})}),y.z.object({kind:y.z.literal("TextVariable"),spec:q})]))}},children:e})}function W(e,n){return"read"===e?"View":n&&"create"===e?"Add":n||"create"!==e?"update"===e?"Edit":"":"Create"}function K(e,n){return n&&"create"===e?"Add":n&&"update"===e?"Apply":n?"":"Save"}var G=r(10517),J=r(9432),H=r(13986);let Y=(0,f.createContext)(void 0);function X(){let e=(0,f.useContext)(Y);if(void 0===e)throw Error("PluginRegistryContext not found. Did you forget a provider?");return e}function ee(e,n,r){r={...r,enabled:(r?.enabled??!0)&&void 0!==e&&""!==n};let{getPlugin:t}=X();return(0,J.a)({queryKey:["getPlugin",e,n],queryFn:()=>t(e,n),...r})}function en(e,n){let{getPlugin:r}=X(),t=[...new Set(n.map(e=>e.kind))],i=(0,H.h)({queries:t.map(n=>({queryKey:["getPlugin",e,n],queryFn:()=>r(e,n)}))});return n.map(e=>i[t.indexOf(e.kind)])}function er(e,n){let{listPluginMetadata:r}=X();return(0,J.a)({queryKey:["listPluginMetadata",e],queryFn:()=>r(e),...n})}function et(){let{getPlugin:e,listPluginMetadata:n}=X();return(0,J.a)({queryKey:["usePluginBuiltinVariableDefinitions"],queryFn:async()=>{let r=new Set((await n(["Datasource"])).map(e=>e.spec.name)),t=[];for(let n of r){let r=await e("Datasource",n);r.getBuiltinVariableDefinitions&&r.getBuiltinVariableDefinitions().forEach(e=>t.push(e))}return t}})}let ei=(0,f.forwardRef)((e,n)=>{let{pluginTypes:r,value:i,onChange:a,...o}=e,{data:l,isLoading:s}=er(r),u=!i||s?"":eo(i),d=(0,f.useCallback)(e=>{if(""===e)return"";let n=el(e);return l?.find(e=>e.kind===n.type&&e.spec.name===n.kind)?.spec.display.name},[l]);return(0,t.jsxs)(p.Z,{select:!0,inputRef:n,...o,value:u,"aria-label":u,onChange:e=>{a?.(el(e.target.value))},SelectProps:{renderValue:d},"data-testid":"plugin-kind-select",children:[s&&(0,t.jsx)(G.Z,{value:"",children:"Loading..."}),l?.map(e=>t.jsx(G.Z,{"data-testid":"option",value:eo({type:e.kind,kind:e.spec.name}),children:e.spec.display.name},e.kind+e.spec.name))]})});ei.displayName="PluginKindSelect";let ea="_____";function eo(e){return[e.type,e.kind].join(ea)}function el(e){let n=e.split(ea),r=n[0],t=n[1];if(void 0===r||void 0===t)throw Error("Invalid optionValue string");return{type:r,kind:t}}function es(e){let{pluginSelection:{type:n,kind:r},...a}=e,{data:o,isLoading:l,error:s}=ee(n,r);if(s)return(0,t.jsx)(i.ErrorAlert,{error:s});if(l)return null;if(void 0===o)throw Error(`Missing implementation for ${n} plugin with kind '${r}'`);if("Panel"===n)throw Error("This editor should not be used for panel type. Please use Panel Spec Editor instead.");let{OptionsEditorComponent:u}=o;return void 0!==u?(0,t.jsx)(u,{...a}):null}var eu=r(67469),ed=r(75586);function ec(e){let{pluginTypes:n,value:r,onHideQueryEditorChange:t=()=>{}}=e,i=(0,eu.z)(e.onChange),a=(0,eu.z)(t),o=(0,f.useRef)({[r.selection.type]:{[r.selection.kind]:r.spec}}),l=(0,eu.z)(()=>{let e=o.current[r.selection.type];void 0===e&&(e={},o.current[r.selection.type]=e),e[r.selection.kind]=r.spec}),s=(0,f.useRef)({[r.selection.kind]:!1}),{defaultPluginKinds:u}=X(),d=n[0],c=d?u?.[d]:void 0,p=d&&c?{type:d,kind:c}:void 0,g=!r.selection&&p?p:void 0,[m,h]=(0,f.useState)(g);(0,f.useEffect)(()=>{""===r.selection.kind&&(r.selection.kind=c||"")},[r.selection,c]);let{data:x,isFetching:v,error:b}=ee(m?.type,m?.kind||"");return(0,f.useEffect)(()=>{m&&void 0!==x&&(l(),i({selection:m,spec:x.createInitialOptions?x.createInitialOptions():{}}),"Panel"===m.type&&(s.current[m.kind]=!!x.hideQueryEditor,!!x.hideQueryEditor!==s.current[r.selection.kind]&&a(!!x.hideQueryEditor)),h(void 0))},[m,x,l,i,a,s,r.selection]),{pendingSelection:m,isLoading:v,error:b,onSelectionChange:e=>{let n=o.current[e.type]?.[e.kind];void 0!==n?(l(),i({selection:e,spec:n})):h(e),"Panel"===e.type&&void 0!==s.current[e.kind]&&s.current[r.selection.kind]!==s.current[e.kind]&&a(!!s.current[e.kind])},onSpecChange:e=>{i((0,ed.Uy)(r,n=>{n.spec=e}))},rememberCurrentSpecState:l}}function ep(e){let{value:n,pluginTypes:r,pluginKindLabel:a,onChange:o,isReadonly:l,...s}=e,{pendingSelection:d,isLoading:c,error:p,onSelectionChange:g,onSpecChange:m}=ec(e);return(0,t.jsxs)(u.Z,{...s,children:[(0,t.jsx)(ei,{fullWidth:!1,sx:{mb:2,minWidth:120},margin:"dense",label:a,pluginTypes:r,disabled:c,value:d||n.selection,InputProps:{readOnly:l},error:!!p,helperText:p?.message,onChange:g}),(0,t.jsx)(i.ErrorBoundary,{FallbackComponent:i.ErrorAlert,children:(0,t.jsx)(es,{pluginSelection:n.selection,value:n.spec,onChange:m,isReadonly:l})})]})}function eg(e){let{initialDatasourceDefinition:n,action:r,isDraft:a,isReadonly:o,onActionChange:l,onSave:v,onClose:y,onDelete:j}=e,[C,P]=(0,f.useState)(!1),k=W(r,a),T=K(r,a),{datasourceEditorSchema:E}=U(),w=(0,b.useForm)({resolver:(0,s.F)(E),mode:"onBlur",defaultValues:n});function Z(e){let n={...e};return n.spec.display?.name===void 0&&n.spec.display?.description===void 0&&delete n.spec.display,n}return(0,t.jsxs)(b.FormProvider,{...w,children:[(0,t.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",padding:e=>e.spacing(1,2),borderBottom:e=>`1px solid ${e.palette.divider}`},children:[(0,t.jsxs)(d.Z,{variant:"h2",children:[k," Datasource"]}),(0,t.jsx)(i.FormActions,{action:r,submitText:T,isReadonly:o,isValid:w.formState.isValid,onActionChange:l,onSubmit:w.handleSubmit(e=>{v(Z(e))}),onDelete:j,onCancel:function(){JSON.stringify(n)!==JSON.stringify(Z(w.getValues()))?P(!0):y()}})]}),(0,t.jsxs)(u.Z,{padding:2,sx:{overflowY:"scroll"},children:[(0,t.jsxs)(c.ZP,{container:!0,spacing:2,mb:2,children:[(0,t.jsx)(c.ZP,{item:!0,xs:4,children:(0,t.jsx)(b.Controller,{control:w.control,name:"name",render:({field:e,fieldState:n})=>(0,t.jsx)(p.Z,{...e,required:!0,fullWidth:!0,name:"name",label:"Name",InputLabelProps:{shrink:"read"===r||void 0},InputProps:{disabled:"update"===r&&!a,readOnly:"read"===r},error:!!n.error,helperText:n.error?.message,value:e.value??"",onChange:n=>{e.onChange(n)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:8,children:(0,t.jsx)(b.Controller,{control:w.control,name:"spec.display.name",render:({field:e,fieldState:n})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,name:"title",label:"Display Label",InputLabelProps:{shrink:"read"===r||void 0},InputProps:{readOnly:"read"===r},error:!!n.error,helperText:n.error?.message,value:e.value??"",onChange:n=>{e.onChange(n)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:12,children:(0,t.jsx)(b.Controller,{control:w.control,name:"spec.display.description",render:({field:e,fieldState:n})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,name:"description",label:"Description",InputLabelProps:{shrink:"read"===r||void 0},InputProps:{readOnly:"read"===r},error:!!n.error,helperText:n.error?.message,value:e.value??"",onChange:n=>{e.onChange(n)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:6,sx:{paddingTop:"5px !important"},children:(0,t.jsxs)(g.Z,{children:[(0,t.jsx)(b.Controller,{control:w.control,name:"spec.default",render:({field:e})=>(0,t.jsx)(m.Z,{label:"Set as default",control:(0,t.jsx)(h.Z,{...e,checked:!!e.value,readOnly:"read"===r,onChange:n=>{"read"!==r&&e.onChange(n)}})})}),(0,t.jsxs)(d.Z,{variant:"caption",children:["Whether this datasource should be the default ",w.getValues().spec.plugin.kind," to be used"]})]})})]}),(0,t.jsx)(x.Z,{}),(0,t.jsx)(d.Z,{py:1,variant:"h3",children:"Plugin Options"}),(0,t.jsx)(b.Controller,{control:w.control,name:"spec.plugin",render:({field:e})=>(0,t.jsx)(ep,{width:"100%",pluginTypes:["Datasource"],pluginKindLabel:"Source",value:{selection:{type:"Datasource",kind:e.value.kind},spec:e.value.spec},isReadonly:"read"===r,onChange:n=>{e.onChange({kind:n.selection.kind,spec:n.spec})}})})]}),(0,t.jsx)(i.DiscardChangesConfirmationDialog,{description:"Are you sure you want to discard your changes? Changes cannot be recovered.",isOpen:C,onCancel:()=>P(!1),onDiscardChanges:()=>{P(!1),y()}})]})}var em=r(14371),eh=r(11774),ex=r(12577),ef=r(52889),ev=r(75094);let eb=(0,f.createContext)(void 0);function ey(){let e=(0,f.useContext)(eb);if(void 0===e)throw Error("No DatasourceStoreContext found. Did you forget a Provider?");return e}function ej(e,n){let{listDatasourceSelectItems:r}=ey();return(0,J.a)({queryKey:["listDatasourceSelectItems",e,n],queryFn:()=>r(e)})}function eC(e){let n=ey();return(0,J.a)({queryKey:["getDatasourceClient",e],queryFn:()=>n.getDatasourceClient(e)})}function eP(e){let n=ey();return(0,J.a)({queryKey:["getDatasource",e],queryFn:()=>n.getDatasource(e)})}function ek(e,n){let r=ew(e),t=e;return r.sort((e,n)=>n.length-e.length).forEach(e=>{let r=n[e];r&&void 0!==r.value&&(t=eT(t,e,r?.value))}),t}function eT(e,n,r){let t="";return Array.isArray(r)&&(t=`(${r.join("|")})`),"string"==typeof r&&(t=r),(e=e.replaceAll("$"+n,t)).replaceAll("${"+n+"}",t)}let eE=/\$(\w+)|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/gm,ew=e=>{let n;let r=new Set;for(;null!==(n=eE.exec(e));)n&&(n[1]?r.add(n[1]):n[2]&&r.add(n[2]));return Array.from(r.values())},eZ=(0,f.createContext)(void 0);function eS(){let e=(0,f.useContext)(eZ);if(void 0===e)throw Error("No BuiltinVariableContext found. Did you forget a Provider?");return e}function eV(e){let{variables:n}=eS(),r=(0,f.useMemo)(()=>{let e={};for(let r of n)e[r.spec.name]={loading:!1,value:r.spec.value()};return e},[n]),t=(0,f.useMemo)(()=>{let n={};return e?.forEach(e=>{let t=r[e];t&&(n[e]=t)}),n},[e,r]);return void 0===e?r:t}function ez(){let{variables:e}=eS();return e}class eO{[ed.sc]=!0;DEFAULT_LOCAL_SOURCE_NAME="";_state={};get(e){return this._sourceStatesOrEmpty(e.source)[e.name]}set(e,n){let r=this._sourceName(e.source);return this._state[r]||(this._state[r]={}),this._sourceStatesOrEmpty(e.source)[e.name]=n,n}has(e){return void 0!==this._sourceStatesOrEmpty(e.source)[e.name]}delete(e){let n=this.has(e),r=this._sourceName(e.source),t=this._state[r];return t&&delete t[e.name],Object.keys(t??{})?.length===0&&delete this._state[r],n}_sourceName(e){return e??this.DEFAULT_LOCAL_SOURCE_NAME}_sourceStatesOrEmpty(e){return this._state[this._sourceName(e)]??{}}}let eI=(0,f.createContext)(void 0);function eD(e){let{state:n}=function(){let e=(0,f.useContext)(eI);if(void 0===e)throw Error("No VariableContext found. Did you forget a Provider?");return e}(),r=(0,f.useMemo)(()=>{let r={};return e?.forEach(e=>{let t=n[e];t&&(r[e]=t)}),r},[n,e]);return void 0===e?n:r}function eL(e){let n=eD(e),r=eV(e);return(0,f.useMemo)(()=>({...n,...r}),[n,r])}function eR(e){let n=eL(e?ew(e):[]);if(e)return ek(e,n)}let eA="__DATASOURCE_VARIABLE_VALUE__",eM={name:"",value:""};function eq(e){let{datasourcePluginKind:n,value:r,project:i,onChange:a,...o}=e,{data:l,isLoading:s}=ej(n,i),u=eD(),d=(0,f.useMemo)(()=>{if(eQ(r))return r;let e=(l??[]).flatMap(e=>e.items).find(e=>r.kind===e.selector.kind&&r.name===e.selector.name&&!e.overridden)?.selector.group;return{...r,group:e}},[r,l]),c=(0,f.useMemo)(()=>{let e=(l||[]).flatMap(e=>e.items.map(n=>({groupLabel:e.group,groupEditLink:e.editLink,name:n.name,overriding:n.overriding,overridden:n.overridden,saved:n.saved??!0,group:n.selector.group,value:e_(n.selector)}))),n=new Map(e.map(e=>[e.name,e]));return[...e,...Object.entries(u).flatMap(([e,r])=>Array.isArray(r.value)||!n.get(r.value??"")?[]:{groupLabel:"Variables",name:`$${e}`,saved:!0,value:`${eA}$${e}`})]},[l,u]),m=s?eM:c.find(e=>e.value===e_(d)),h=e=>{e?a(eN(e?.value||"")):a({kind:n})},x=()=>{};return(0,t.jsx)(eh.Z,{options:c,renderInput:e=>(0,t.jsx)(p.Z,{...e,label:o.label,placeholder:""}),groupBy:e=>e.groupLabel||"No group",getOptionLabel:e=>e.name,onChange:(e,n)=>h(n),value:m,renderOption:(e,n)=>(0,f.createElement)("li",{...e,key:n.value},(0,t.jsxs)(g.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",width:"100%",children:[(0,t.jsx)(ex.Z,{children:(0,t.jsx)(e$,{name:n.name,overridden:n.overridden,overriding:n.overriding})}),!n.saved&&(0,t.jsx)(ex.Z,{children:"Save the dashboard to enable this datasource"}),(0,t.jsx)(ex.Z,{style:{textAlign:"right"},children:n.groupLabel&&n.groupLabel.length>0&&(0,t.jsx)(ef.Z,{disabled:!1,label:n.groupLabel,size:"small",onDelete:n.groupEditLink?x:void 0,deleteIcon:n.groupEditLink?(0,t.jsx)(ev.Z,{href:n.groupEditLink,target:"_blank",children:(0,t.jsx)(em.default,{fontSize:"small"})}):void 0})})]}))})}function e$(e){let{name:n,overridden:r,overriding:i}=e;return(0,t.jsxs)(t.Fragment,{children:[`${n} `,!r&&i&&(0,t.jsx)(u.Z,{display:"inline",fontWeight:"normal",color:e=>e.palette.primary.main,children:"(overriding)"}),r&&"(overridden)"]})}let eF="_____";function e_(e){return eQ(e)?`${eA}${e}`:[e.kind,e.group??"",e.name??""].join(eF)}function eN(e){if(e.startsWith(eA))return e.split(eA)[1];let n=e.split(eF),r=n[0],t=n[2];if(void 0===r||void 0===t)throw Error("Invalid optionValue string");return{kind:r,name:""===t?void 0:t}}function eQ(e){return"string"==typeof e&&e.startsWith("$")}let eU=(e,n,r)=>{if(!eQ(e))return e;let[t]=ew(e),i=n[t??""];if(!i||Array.isArray(i.value))return;let a=(r||[]).flatMap(e=>e.items).find(e=>e.name===i.value);if(void 0!==a)return{kind:a.selector.kind,name:a.selector.name}},eB=(e,n)=>{let{data:r}=ej(n),t=eD();return eQ(e)?eU(e,t,r)??{kind:n}:e};var eW=r(86396),eK=r(33755),eG=r(90192),eJ=r(65091),eH=r(12e3);function eY(e){let{children:n,value:r,index:i,...a}=e,o=r===i;return(0,t.jsx)("div",{role:"tabpanel",hidden:!o,id:`options-editor-tabpanel-${i}`,"aria-labelledby":`options-editor-tab-${i}`,...a,children:o&&(0,t.jsx)(u.Z,{mt:2,children:n})})}let eX=e=>{let{tabs:n,defaultTab:r,onModeChange:i,isReadonly:a}=e,[o,l]=(0,f.useState)(r);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Z,{sx:{borderBottom:1,borderColor:e=>e.palette.divider},children:(0,t.jsx)(eG.Z,{children:(0,t.jsx)(eJ.Z,{row:!0,defaultValue:r,value:o,onChange:(e,n)=>{let r=parseInt(n);l(r),i(r)},"aria-labelledby":"Configuration radio",children:n.map(({label:e},n)=>(0,t.jsx)(m.Z,{disabled:a,value:n,control:(0,t.jsx)(eH.Z,{}),label:e},e))})})}),n.map(({label:e,content:n},r)=>(0,t.jsx)(eY,{value:o,index:r,children:n},e))]})};function e0(e){let{value:n,onChange:r,isReadonly:i,initialSpecDirect:a,initialSpecProxy:o}=e,l="Direct access",s="Proxy";n.directUrl||n.proxy||Object.assign(n,o);let u=(e,n,r)=>void 0===e?e:{...Object.keys(e).reduce((t,i)=>(i===n?t[r]=e[n]||"":t[i]=e[i]||"",t),{})},g=[{label:l,content:(0,t.jsx)(b.Controller,{name:"URL",render:({field:e,fieldState:a})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,label:"URL",value:n.directUrl||"",error:!!a.error,helperText:a.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{e.onChange(t),r((0,ed.Uy)(n,e=>{e.directUrl=t.target.value}))}})})},{label:s,content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Controller,{name:"URL",render:({field:e,fieldState:a})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,label:"URL",value:n.proxy?.spec.url||"",error:!!a.error,helperText:a.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{e.onChange(t),r((0,ed.Uy)(n,e=>{void 0!==e.proxy&&(e.proxy.spec.url=t.target.value)}))},sx:{mb:2}})}),(0,t.jsx)(d.Z,{variant:"h4",mb:2,children:"Allowed endpoints"}),(0,t.jsxs)(c.ZP,{container:!0,spacing:2,mb:2,children:[n.proxy?.spec.allowedEndpoints&&n.proxy?.spec.allowedEndpoints.length!==0?n.proxy.spec.allowedEndpoints.map(({endpointPattern:e,method:a},o)=>(0,t.jsxs)(f.Fragment,{children:[(0,t.jsx)(c.ZP,{item:!0,xs:8,children:(0,t.jsx)(b.Controller,{name:`Endpoint pattern ${o}`,render:({field:a,fieldState:l})=>(0,t.jsx)(p.Z,{...a,fullWidth:!0,label:"Endpoint pattern",value:e,error:!!l.error,helperText:l.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:e=>{a.onChange(e),r((0,ed.Uy)(n,n=>{void 0!==n.proxy&&(n.proxy.spec.allowedEndpoints=n.proxy.spec.allowedEndpoints?.map((n,r)=>o===r?{endpointPattern:e.target.value,method:n.method}:n))}))}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:3,children:(0,t.jsx)(b.Controller,{name:`Method ${o}`,render:({field:e,fieldState:l})=>(0,t.jsxs)(p.Z,{...e,select:!0,fullWidth:!0,label:"Method",value:a,error:!!l.error,helperText:l.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{e.onChange(t),r((0,ed.Uy)(n,e=>{void 0!==e.proxy&&(e.proxy.spec.allowedEndpoints=e.proxy.spec.allowedEndpoints?.map((e,n)=>o===n?{endpointPattern:e.endpointPattern,method:t.target.value}:e))}))},children:[(0,t.jsx)(G.Z,{value:"GET",children:"GET"}),(0,t.jsx)(G.Z,{value:"POST",children:"POST"}),(0,t.jsx)(G.Z,{value:"PUT",children:"PUT"}),(0,t.jsx)(G.Z,{value:"PATCH",children:"PATCH"}),(0,t.jsx)(G.Z,{value:"DELETE",children:"DELETE"})]})})}),(0,t.jsx)(c.ZP,{item:!0,xs:1,children:(0,t.jsx)(b.Controller,{name:`Remove Endpoint ${o}`,render:({field:e})=>(0,t.jsx)(ev.Z,{...e,disabled:i,onClick:t=>{e.onChange(t),r((0,ed.Uy)(n,e=>{void 0!==e.proxy&&(e.proxy.spec.allowedEndpoints=[...e.proxy.spec.allowedEndpoints?.filter((e,n)=>n!==o)||[]])}))},children:(0,t.jsx)(eW.default,{})})})})]},o)):(0,t.jsx)(c.ZP,{item:!0,xs:4,children:(0,t.jsx)(d.Z,{sx:{fontStyle:"italic"},children:"None"})}),(0,t.jsx)(c.ZP,{item:!0,xs:12,sx:{paddingTop:"0px !important",paddingLeft:"5px !important"},children:(0,t.jsx)(ev.Z,{disabled:i,onClick:()=>r((0,ed.Uy)(n,e=>{void 0!==e.proxy&&(e.proxy.spec.allowedEndpoints=[...e.proxy.spec.allowedEndpoints??[],{endpointPattern:"",method:""}])})),children:(0,t.jsx)(eK.default,{})})})]}),(0,t.jsx)(d.Z,{variant:"h4",mb:2,children:"Request Headers"}),(0,t.jsxs)(c.ZP,{container:!0,spacing:2,mb:2,children:[n.proxy?.spec.headers&&Object.keys(n.proxy.spec.headers).map((e,a)=>(0,t.jsxs)(f.Fragment,{children:[(0,t.jsx)(c.ZP,{item:!0,xs:4,children:(0,t.jsx)(b.Controller,{name:`Header name ${a}`,render:({field:a,fieldState:o})=>(0,t.jsx)(p.Z,{...a,fullWidth:!0,label:"Header name",value:e,error:!!o.error,helperText:o.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{a.onChange(t),r((0,ed.Uy)(n,n=>{void 0!==n.proxy&&(n.proxy.spec.headers=u(n.proxy.spec.headers,e,t.target.value))}))}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:7,children:(0,t.jsx)(b.Controller,{name:`Header value ${a}`,render:({field:a,fieldState:o})=>(0,t.jsx)(p.Z,{...a,fullWidth:!0,label:"Header value",value:n.proxy?.spec.headers?.[e],error:!!o.error,helperText:o.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{a.onChange(t),r((0,ed.Uy)(n,n=>{void 0!==n.proxy&&(n.proxy.spec.headers={...n.proxy.spec.headers,[e]:t.target.value})}))}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:1,children:(0,t.jsx)(b.Controller,{name:`Remove Header ${a}`,render:({field:a})=>(0,t.jsx)(ev.Z,{...a,disabled:i,onClick:t=>{a.onChange(t);let i={...n.proxy?.spec.headers};delete i[e],r((0,ed.Uy)(n,e=>{void 0!==e.proxy&&(e.proxy.spec.headers=i)}))},children:(0,t.jsx)(eW.default,{})})})})]},a)),(0,t.jsx)(c.ZP,{item:!0,xs:12,sx:{paddingTop:"0px !important",paddingLeft:"5px !important"},children:(0,t.jsx)(ev.Z,{disabled:i,onClick:()=>r((0,ed.Uy)(n,e=>{void 0!==e.proxy&&(e.proxy.spec.headers={...e.proxy.spec.headers,"":""})})),children:(0,t.jsx)(eK.default,{})})})]}),(0,t.jsx)(b.Controller,{name:"Secret",render:({field:e,fieldState:a})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,label:"Secret",value:n.proxy?.spec.secret||"",error:!!a.error,helperText:a.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{e.onChange(t),r((0,ed.Uy)(n,e=>{void 0!==e.proxy&&(e.proxy.spec.secret=t.target.value)}))}})})]})}],m=g.findIndex(e=>e.label===l),h=g.findIndex(e=>e.label===s),x=n.proxy?h:m,[v,y]=(0,f.useState)(a),[j,C]=(0,f.useState)(o);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{variant:"h4",mt:2,children:"HTTP Settings"}),(0,t.jsx)(eX,{isReadonly:i,tabs:g,defaultTab:x,onModeChange:e=>{if(g[e]?.label===l){C(n);let{proxy:e,...t}=n;r({...t,directUrl:v.directUrl})}else if(g[e]?.label===s){y(n);let{directUrl:e,...t}=n;r({...t,proxy:j.proxy})}}})]})}var e1=r(8193);let e2=["mean","first","first-number","last","last-number","min","max","sum"],e5={bottom:{label:"Bottom"},right:{label:"Right"}},e3={list:{label:"List"},table:{label:"Table"}},e4={small:{label:"Small"},medium:{label:"Medium"}},e7=e2.reduce((e,n)=>(e[n]=a[n],e),{});function e6(e){return void 0===e||!!((0,e1.vo)(e.position)&&(!e.mode||(0,e1.kx)(e.mode))&&(!e.size||(0,e1.BL)(e.size)))}let e8=Object.entries(e5).map(([e,n])=>({id:e,...n})),e9=Object.entries(e3).map(([e,n])=>({id:e,...n})),ne=Object.entries(e4).map(([e,n])=>({id:e,...n})),nn=Object.entries(e7).map(([e,n])=>({id:e,...n}));function nr({value:e,onChange:n,showValuesEditor:r=!0}){let a=e6(e),o=(0,e1.Jj)(e?.position),l=e5[o],s=(0,e1.bk)(e?.mode),u=e3[s],d=(0,e1.dT)(e?.size),c=e4[d],p=(e?.values||[]).reduce((e,n)=>{let r=e7[n];return r&&e.push({...r,id:n}),e},[]);return(0,t.jsxs)(i.OptionsEditorGroup,{title:"Legend",children:[!a&&(0,t.jsx)(i.ErrorAlert,{error:{name:"invalid-legend",message:"Invalid legend spec"}}),(0,t.jsx)(i.OptionsEditorControl,{label:"Show",control:(0,t.jsx)(h.Z,{checked:void 0!==e,onChange:(e,r)=>{n(!0===r?{position:e1.zx.position}:void 0)}})}),(0,t.jsx)(i.OptionsEditorControl,{label:"Position",control:(0,t.jsx)(i.SettingsAutocomplete,{value:{...l,id:o},options:e8,onChange:(r,t)=>{n({...e,position:t.id})},disabled:void 0===e,disableClearable:!0})}),(0,t.jsx)(i.OptionsEditorControl,{label:"Mode",control:(0,t.jsx)(i.SettingsAutocomplete,{value:{...u,id:s},options:e9,onChange:(r,t)=>{n({...e,position:o,mode:t.id})},disabled:void 0===e,disableClearable:!0})}),(0,t.jsx)(i.OptionsEditorControl,{label:"Size",control:(0,t.jsx)(i.SettingsAutocomplete,{value:{...c,id:d},options:ne,onChange:(r,t)=>{n({...e,position:o,size:t.id})},disabled:void 0===e||"table"!==s,disableClearable:!0})}),r&&(0,t.jsx)(i.OptionsEditorControl,{label:"Values",control:(0,t.jsx)(i.SettingsAutocomplete,{multiple:!0,disableCloseOnSelect:!0,disableClearable:!0,value:p,options:nn,onChange:(r,t)=>{n({...e,position:o,values:t.map(e=>e.id)})},disabled:void 0===e||"table"!==s,limitTags:1,ChipProps:{size:"small"}})})]})}var nt=r(48565),ni=r(22446),na=r(12449),no=r(84974);let nl=({queryTypes:e,index:n,query:r,isCollapsed:i,onDelete:a,onChange:o,onCollapseExpand:l})=>(0,t.jsxs)(g.Z,{spacing:1,children:[(0,t.jsxs)(g.Z,{direction:"row",alignItems:"center",borderBottom:1,borderColor:e=>e.palette.divider,children:[(0,t.jsx)(ev.Z,{size:"small",onClick:()=>l(n),children:i?(0,t.jsx)(no.default,{}):(0,t.jsx)(na.default,{})}),(0,t.jsxs)(d.Z,{variant:"overline",component:"h4",children:["Query #",n+1]}),(0,t.jsx)(ev.Z,{size:"small",sx:{marginLeft:"auto",visibility:`${a?"visible":"hidden"}`},onClick:()=>a&&a(n),children:(0,t.jsx)(ni.default,{})})]}),!i&&(0,t.jsx)(ns,{queryTypes:e,value:r,onChange:e=>o(n,e)})]},n);function ns(e){let{value:n,onChange:r,queryTypes:i,...a}=e;return(0,t.jsx)(u.Z,{...a,children:(0,t.jsx)(ep,{pluginTypes:i,pluginKindLabel:"Query Type",value:{selection:{kind:n.spec.plugin.kind,type:n.kind},spec:n.spec.plugin.spec},onChange:e=>{r((0,ed.Uy)(n,n=>{n.kind=e.selection.type,n.spec.plugin.kind=e.selection.kind,n.spec.plugin.spec=e.spec}))}})})}function nu({queryTypes:e,queries:n=[],onChange:r}){let{defaultInitialQueryDefinition:i,isLoading:a}=function(e){let n=e[0],{data:r,isLoading:t}=er(e),{defaultPluginKinds:i}=X(),a=i?.[n]??r?.[0]?.spec.name??"",{data:o}=ee(n,a,{useErrorBoundary:!0,enabled:!0});return{defaultInitialQueryDefinition:{kind:n,spec:{plugin:{kind:a,spec:o?.createInitialOptions()||{}}}},isLoading:t}}(e),[o,l]=(0,f.useState)(n.map(()=>!1)),s=(e,t)=>{r((0,ed.Uy)(n,n=>{n?n[e]=t:n=[t]}))},u=e=>{r((0,ed.Uy)(n,n=>{n.splice(e,1)})),l(n=>(n.splice(e,1),[...n]))},d=e=>{l(n=>(n[e]=!n[e],[...n]))},c=n.length?n:a?[]:[i];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Z,{spacing:1,children:c.map((r,i)=>(0,t.jsx)(nl,{queryTypes:e,index:i,query:r,isCollapsed:!!o[i],onChange:s,onDelete:n.length>1?u:void 0,onCollapseExpand:d},i))}),(0,t.jsx)(nt.Z,{variant:"contained",startIcon:(0,t.jsx)(eK.default,{}),sx:{marginTop:1},onClick:()=>{r((0,ed.Uy)(n,e=>{e?e.push(i):e=[...n,i]})),l(e=>(e.push(!1),[...e]))},children:"Add Query"})]})}var nd=r(51781),nc=r(49408);let np=({tabs:e})=>{let[n,r]=(0,f.useState)(0);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Z,{sx:{borderBottom:1,borderColor:e=>e.palette.divider},children:(0,t.jsx)(nd.Z,{value:n,onChange:(e,n)=>{r(n)},"aria-label":"Panel configuration tabs",children:e.map(({label:e},n)=>(0,t.jsx)(nc.Z,{label:e,id:`options-editor-tab-${n}`,"aria-controls":`options-editor-tabpanel-${n}`},e))})}),e.map(({label:e,content:r},i)=>(0,t.jsx)(eY,{value:n,index:i,children:r},e))]})},ng=(0,f.createContext)(0),nm=({queryCount:e,children:n})=>(0,t.jsx)(ng.Provider,{value:e,children:n}),nh=()=>(0,f.useContext)(ng);function nx(e){let{control:n,panelDefinition:r,onJSONChange:a,onQueriesChange:o,onPluginSpecChange:l}=e,{kind:s}=r.spec.plugin,{data:u,isLoading:d,error:c}=ee("Panel",s);if(c)return(0,t.jsx)(i.ErrorAlert,{error:c});if(d)return null;if(void 0===u)throw Error(`Missing implementation for panel plugin with kind '${s}'`);let{panelOptionsEditorComponents:p,hideQueryEditor:g}=u,m=[];return g||m.push({label:"Query",content:(0,t.jsx)(b.Controller,{control:n,name:"panelDefinition.spec.queries",render:({field:e})=>(0,t.jsx)(nu,{queryTypes:u.supportedQueryTypes??[],queries:r.spec.queries??[],onChange:n=>{e.onChange(n),o(n)}})})}),void 0!==p&&(m=m.concat(p.map(({label:e,content:i})=>({label:e,content:(0,t.jsx)(b.Controller,{control:n,name:"panelDefinition.spec.plugin.spec",render:({field:e})=>(0,t.jsx)(i,{value:r.spec.plugin.spec,onChange:n=>{e.onChange(n),l(n)}})})})))),m.push({label:"Links",content:(0,t.jsx)(i.LinksEditor,{control:n})}),m.push({label:"JSON",content:(0,t.jsx)(b.Controller,{control:n,name:"panelDefinition",render:({field:e})=>(0,t.jsx)(i.JSONEditor,{maxHeight:"80vh",value:r,onChange:n=>{e.onChange(JSON.parse(n)),a(n)}})})}),(0,t.jsx)(nm,{queryCount:(r.spec.queries??[]).length,children:(0,t.jsx)(np,{tabs:m},m.length)})}function nf(e){let{pluginLoader:{getInstalledPlugins:n,importPluginModule:r},children:i,defaultPluginKinds:a}=e,o=function(e){let n=(0,eu.z)(async()=>{let n=await e(),r=new Map,t=new Map;for(let e of n)for(let n of e.spec.plugins){var i,a;let{kind:o,spec:{name:l}}=n,s=(i=o,a=l,`${i}:${a}`);r.has(s)&&console.warn(`Got more than one ${o} plugin for kind ${l}`),r.set(s,e);let u=t.get(o);void 0===u&&(u=[],t.set(o,u)),u.push({...n,module:e.metadata})}return{pluginResourcesByNameAndKind:r,pluginMetadataByKind:t}}),r=(0,f.useRef)(void 0);return(0,f.useCallback)(()=>{let e=r.current;return void 0===e&&(e=n(),r.current=e,e.catch(()=>void 0===r.current)),e},[n])}(n),l=(0,f.useRef)(new Map),s=(0,eu.z)(e=>{let n=l.current.get(e);return void 0===n&&(n=r(e),l.current.set(e,n),n.catch(()=>l.current.delete(e))),n}),u=(0,f.useCallback)(async(e,n)=>{let r=await o(),t=`${e}:${n}`,i=r.pluginResourcesByNameAndKind.get(t);if(void 0===i)throw Error(`A ${n} plugin for kind '${e}' is not installed`);let a=(await s(i))[n];if(void 0===a)throw Error(`The ${n} plugin for kind '${e}' is missing from the ${i.metadata.name} plugin module`);return a},[o,s]),d=(0,f.useCallback)(async e=>{let n=await o();return e.flatMap(e=>n.pluginMetadataByKind.get(e)??[])},[o]),c=(0,f.useMemo)(()=>({getPlugin:u,listPluginMetadata:d,defaultPluginKinds:a}),[u,d,a]);return(0,t.jsx)(Y.Provider,{value:c,children:i})}var nv=r(67877),nb=r(28278),ny=r(17001),nj=r(29085);let nC={refreshVariableValues:"Refresh values",copyVariableValues:"Copy values to clipboard",refresh:"Refresh",refreshInterval:"Auto refresh interval",zoomIn:"Zoom in",zoomOut:"Zoom out"};var nP=r(20461);let nk=(0,f.createContext)(void 0);function nT(){let e=(0,f.useContext)(nk);if(void 0===e)throw Error("No TimeRangeContext found. Did you forget a Provider?");return e}function nE(){return nT()}function nw(e){let{absoluteTimeRange:n}=nE();return void 0===e?0:(0,nj.YF)(n,e)}function nZ(e){let{timeRange:n,refreshInterval:r,children:i,setTimeRange:a,setRefreshInterval:o}=e,[l,s]=(0,f.useState)(n),[u,d]=(0,f.useState)(r),[c,p]=(0,f.useState)(0);(0,f.useEffect)(()=>{s(n)},[n,c]),(0,f.useEffect)(()=>{d(r)},[r]);let g=(0,f.useCallback)(()=>{p(e=>e+1)},[p]),m=null!=u?(0,nP.milliseconds)((0,nj.Ib)(u)):0;(0,f.useEffect)(()=>{if(m>0){let e=setInterval(()=>{g()},m);return()=>clearInterval(e)}},[g,m]);let h=(0,f.useMemo)(()=>{let e=(0,nj.s3)(l)?(0,nj.sG)(l):l;return{timeRange:l,setTimeRange:a??s,absoluteTimeRange:e,refresh:g,refreshKey:`${e.start}:${e.end}:${u}:${c}`,refreshInterval:u,refreshIntervalInMs:m,setRefreshInterval:o??d}},[l,a,g,u,c,m,o]);return(0,t.jsx)(nk.Provider,{value:h,children:i})}let nS={showCustom:!0,showZoomButtons:!0,options:["5m","15m","30m","1h","6h","12h","24h","7d","14d"].map(e=>(0,i.buildRelativeTimeOption)(e))},nV=(0,f.createContext)(nS);function nz(){let e=(0,f.useContext)(nV);if(void 0===e)throw Error("No TimeRangeContext found. Did you forget a Provider?");return e}function nO(){return nz()}function nI(e){let n=nO().showCustom;return void 0!==e?e:n}function nD(e){let n=nO().showZoomButtons;return void 0!==e?e:n}function nL(e){let n=nO().options;return void 0!==e?e:n}function nR(e){let n=(0,f.useMemo)(()=>({showCustom:void 0===e.showCustom?nS.showCustom:e.showCustom,showZoomButtons:void 0===e.showZoomButtons?nS.showZoomButtons:e.showZoomButtons,options:void 0===e.options?nS.options:e.options}),[e.showCustom,e.showZoomButtons,e.options]);return(0,t.jsx)(nV.Provider,{value:n,children:e.children})}let nA=[{value:{pastDuration:"0s"},display:"Off"},{value:{pastDuration:"5s"},display:"5s"},{value:{pastDuration:"10s"},display:"10s"},{value:{pastDuration:"15s"},display:"15s"},{value:{pastDuration:"30s"},display:"30s"},{value:{pastDuration:"60s"},display:"1m"}];function nM({heightPx:e,showTimeRangeSelector:n=!0,showRefreshButton:r=!0,showRefreshInterval:a=!0,showCustomTimeRange:o,showZoomButtons:l=!0,timePresets:s}){let{timeRange:u,setTimeRange:d,refresh:c,refreshInterval:p,setRefreshInterval:m}=nE(),h=nI(o),x=nD(l),v=nL(s),b=void 0===e?"34px":`${e}px`;"pastDuration"in u&&!v.some(e=>e.value.pastDuration===u.pastDuration)&&v.push((0,i.buildRelativeTimeOption)(u.pastDuration));let y=(0,f.useCallback)(e=>{m(e)},[m]),j=e=>{let n=(0,nj.Ib)(e);return((n.seconds??0)+(n.minutes??0)*60+(n.hours??0)*3600+(n.days??0)*86400+(n.weeks??0)*604800+(n.months??0)*2629746+(n.years??0)*0x1e18558)*1e3},C=()=>{let e,n,r;let t=new Date;return Object.hasOwn(u,"start")?(r=(u.end.getTime()-u.start.getTime())/2,e=new Date(u.start.getTime()-r),n=new Date(u.end.getTime()+r)):(r=j(u.pastDuration)/2,e=new Date((n=void 0===u.end?t:new Date(u.end.getTime()+r)).getTime()-4*r)),n.getTime()>t.getTime()&&(n=t,e.setTime(t.getTime()-4*r)),1>e.getTime()&&e.setTime(1),{start:e,end:n}},P=()=>{let e,n;if(Object.hasOwn(u,"start")){let r=(u.end.getTime()-u.start.getTime())/4;e=new Date(u.start.getTime()+r),n=new Date(u.end.getTime()-r)}else{let r=j(u.pastDuration)/4;e=new Date((n=void 0!==u.end?new Date(u.end.getTime()-r):new Date).getTime()-2*r)}return e.getTime()>=n.getTime()-1e3&&e.setTime(n.getTime()-1e3),{start:e,end:n}};return(0,t.jsxs)(g.Z,{direction:"row",spacing:1,children:[n&&(0,t.jsx)(i.TimeRangeSelector,{timeOptions:v,value:u,onChange:d,height:b,showCustomTimeRange:h}),x&&(0,t.jsx)(i.InfoTooltip,{description:nC.zoomOut,children:(0,t.jsx)(i.ToolbarIconButton,{"aria-label":nC.zoomOut,onClick:()=>d(C()),sx:{height:b},children:(0,t.jsx)(ny.default,{})})}),x&&(0,t.jsx)(i.InfoTooltip,{description:nC.zoomIn,children:(0,t.jsx)(i.ToolbarIconButton,{"aria-label":nC.zoomIn,onClick:()=>d(P()),sx:{height:b},children:(0,t.jsx)(nb.default,{})})}),r&&(0,t.jsx)(i.InfoTooltip,{description:nC.refresh,children:(0,t.jsx)(i.ToolbarIconButton,{"aria-label":nC.refresh,onClick:c,sx:{height:b},children:(0,t.jsx)(nv.default,{})})}),a&&(0,t.jsx)(i.InfoTooltip,{description:nC.refreshInterval,children:(0,t.jsx)(i.RefreshIntervalPicker,{timeOptions:nA,value:p,onChange:y,height:b})})]})}function nq(e,n){let r=[],t=new Set;for(let i of e){let e=i.value.matchAll(n),a="";for(let n of e)for(let e=1;e<n.length;e++){let r=n[e];void 0!==r&&(a=`${a}${r}`)}""===a||t.has(a)||(t.add(a),r.push({label:i.label,value:a}))}return r}function n$(e){let{data:n}=ee("Variable",e.spec.plugin.kind),r=ey(),t=eL(),{absoluteTimeRange:i,refreshKey:a}=nE(),o=e.spec.plugin.spec,l=void 0!==e.spec.capturingRegexp?RegExp(e.spec.capturingRegexp,"g"):void 0,s=Object.keys(t);if(n?.dependsOn){let e=n.dependsOn(o,{timeRange:i,datasourceStore:r,variables:t});s=e.variables?e.variables:s}let u=eL(s=s.filter(n=>n!==e.spec.name)),d=!1;s&&(d=s.some(e=>u[e]?.loading));let c=nF(u);return(0,J.a)({queryKey:[e,c,i,a],queryFn:async()=>{let e=await n?.getVariableOptions(o,{datasourceStore:r,variables:u,timeRange:i});return void 0===e?[]:l?nq(e.data,l):e.data},enabled:!!n||d})}function nF(e){return Object.values(e).map(e=>JSON.stringify(e.value)).join(",")}let n_=[{label:"List",kind:"ListVariable"},{label:"Text",kind:"TextVariable"}];var nN=r(70313),nQ=r(84954),nU=r(315),nB=r(50898),nW=r(60993);function nK(e){let{values:n,onRefresh:r,isLoading:a,error:o}=e,[l,s]=(0,f.useState)(50),{infoSnackbar:c}=(0,i.useSnackbar)(),p=0;return n&&n?.length>0&&l&&(p=n.length-l),(0,t.jsxs)(u.Z,{children:[(0,t.jsxs)(g.Z,{direction:"row",spacing:1,alignItems:"center",mb:1,children:[(0,t.jsx)(d.Z,{variant:"h4",children:"Preview Values"}),r&&(0,t.jsx)(i.InfoTooltip,{description:nC.refreshVariableValues,children:(0,t.jsx)(ev.Z,{onClick:r,size:"small",children:(0,t.jsx)(nv.default,{})})}),(0,t.jsx)(i.InfoTooltip,{description:nC.copyVariableValues,children:(0,t.jsx)(ev.Z,{onClick:async()=>{n?.length&&(await navigator.clipboard.writeText(n.map(e=>e).join(", ")),c("Preview values copied to clipboard!"))},size:"small",children:(0,t.jsx)(nW.default,{})})})]}),(0,t.jsx)(nQ.Z,{variant:"outlined",children:(0,t.jsxs)(u.Z,{sx:{display:"flex",flexWrap:"wrap",gap:1,m:2},children:[o&&(0,t.jsx)(nU.Z,{severity:"error",children:o}),n?.length===0&&(0,t.jsx)(nU.Z,{severity:"info",children:"No results"}),a&&(0,t.jsx)(g.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,t.jsx)(nB.Z,{})}),n?.slice(0,l).map((e,n)=>t.jsx(ef.Z,{size:"small",label:e},n)),p>0&&(0,t.jsx)(ef.Z,{onClick:()=>{s(void 0)},variant:"outlined",size:"small",label:`+${p} more`})]})})]})}function nG(e){let{definition:n,onRefresh:r}=e,{data:i,isFetching:a,error:o}=n$(n),l=o?.message;return(0,t.jsx)(nK,{values:i?.map(e=>e.value)||[],onRefresh:r,isLoading:a,error:l})}function nJ(){return(0,t.jsx)("div",{children:"Error previewing values"})}function nH({action:e,control:n}){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{py:1,variant:"subtitle1",children:"Text Options"}),(0,t.jsxs)(g.Z,{spacing:2,children:[(0,t.jsx)(b.Controller,{control:n,name:"spec.value",render:({field:n,fieldState:r})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Z,{children:(0,t.jsx)(nK,{values:[n.value]})}),(0,t.jsx)(p.Z,{...n,label:"Value",InputLabelProps:{shrink:"read"===e||void 0},InputProps:{readOnly:"read"===e},error:!!r.error,helperText:r.error?.message,value:n.value??"",onChange:e=>{n.onChange(e)}})]})}),(0,t.jsx)(b.Controller,{control:n,name:"spec.constant",render:({field:n})=>(0,t.jsx)(m.Z,{label:"Constant",control:(0,t.jsx)(h.Z,{...n,checked:!!n.value,readOnly:"read"===e,value:n.value??!1,onChange:r=>{"read"!==e&&n.onChange(r)}})})})]})]})}function nY({action:e,control:n}){let r=(0,b.useFormContext)(),[a,o]=(0,f.useState)(r.getValues()),l=()=>{o(r.getValues())},s=(0,b.useWatch)({control:n,name:"spec.plugin"}),c=s?.kind,v=s?.spec,y=(0,b.useWatch)({control:n,name:"spec.allowAllValue"}),j=r.getValues();return void 0===j.spec.allowAllValue&&r.setValue("spec.allowAllValue",!1),void 0===j.spec.allowMultiple&&r.setValue("spec.allowMultiple",!1),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{py:1,variant:"subtitle1",children:"List Options"}),(0,t.jsxs)(g.Z,{spacing:2,mb:2,children:[c?(0,t.jsx)(u.Z,{children:(0,t.jsx)(i.ErrorBoundary,{FallbackComponent:nJ,resetKeys:[a],children:(0,t.jsx)(nG,{definition:a,onRefresh:l})})}):(0,t.jsx)(nK,{isLoading:!0}),(0,t.jsxs)(g.Z,{children:[(0,t.jsx)(nN.d,{onClickAway:()=>l(),children:(0,t.jsx)(u.Z,{})}),(0,t.jsx)(i.ErrorBoundary,{FallbackComponent:i.ErrorAlert,children:(0,t.jsx)(b.Controller,{control:n,name:"spec.plugin",render:({field:n})=>(0,t.jsx)(ep,{width:"100%",pluginTypes:["Variable"],pluginKindLabel:"Source",value:{selection:{type:"Variable",kind:c??"StaticListVariable"},spec:v??{values:[]}},isReadonly:"read"===e,onChange:e=>{n.onChange({kind:e.selection.kind,spec:e.spec})}})})})]}),(0,t.jsx)(g.Z,{children:(0,t.jsx)(b.Controller,{control:n,name:"spec.capturingRegexp",render:({field:n,fieldState:r})=>(0,t.jsx)(p.Z,{...n,label:"Capturing Regexp Filter",InputLabelProps:{shrink:"read"===e||void 0},InputProps:{readOnly:"read"===e},error:!!r.error,value:n.value??"",onChange:e=>{""===e.target.value?n.onChange(void 0):n.onChange(e)},helperText:r.error?.message?r.error.message:"Optional, if you want to filter on captured result."})})}),(0,t.jsx)(g.Z,{children:(0,t.jsx)(b.Controller,{control:n,name:"spec.sort",render:({field:n,fieldState:r})=>(0,t.jsxs)(p.Z,{select:!0,...n,fullWidth:!0,label:"Sort",InputLabelProps:{shrink:"read"===e||void 0},InputProps:{readOnly:"read"===e},error:!!r.error,helperText:r.error?.message,value:n.value??"none",onChange:e=>{n.onChange(e)},children:[(0,t.jsx)(G.Z,{value:"none",children:"None"}),(0,t.jsx)(G.Z,{value:"alphabetical-asc",children:"Alphabetical, asc"}),(0,t.jsx)(G.Z,{value:"alphabetical-desc",children:"Alphabetical, desc"}),(0,t.jsx)(G.Z,{value:"numerical-asc",children:"Numerical, asc"}),(0,t.jsx)(G.Z,{value:"numerical-desc",children:"Numerical, desc"}),(0,t.jsx)(G.Z,{value:"alphabetical-ci-asc",children:"Alphabetical, case-insensitive, asc"}),(0,t.jsx)(G.Z,{value:"alphabetical-ci-desc",children:"Alphabetical, case-insensitive, desc"})]})})})]}),(0,t.jsx)(x.Z,{}),(0,t.jsx)(d.Z,{py:1,variant:"subtitle1",children:"Dropdown Options"}),(0,t.jsxs)(g.Z,{spacing:"2",children:[(0,t.jsxs)(g.Z,{children:[(0,t.jsx)(b.Controller,{control:n,name:"spec.allowMultiple",render:({field:n})=>(0,t.jsx)(m.Z,{label:"Allow Multiple Values",control:(0,t.jsx)(h.Z,{...n,checked:!!n.value,readOnly:"read"===e,value:n.value??!1,onChange:r=>{"read"!==e&&n.onChange(r)}})})}),(0,t.jsx)(d.Z,{variant:"caption",children:"Enables multiple values to be selected at the same time"})]}),(0,t.jsxs)(g.Z,{children:[(0,t.jsx)(b.Controller,{control:n,name:"spec.allowAllValue",render:({field:n})=>(0,t.jsx)(m.Z,{label:"Allow All option",control:(0,t.jsx)(h.Z,{...n,checked:!!n.value,readOnly:"read"===e,value:n.value??!1,onChange:r=>{"read"!==e&&n.onChange(r)}})})}),(0,t.jsx)(d.Z,{mb:1,variant:"caption",children:"Enables an option to include all variable values"}),y&&(0,t.jsx)(b.Controller,{control:n,name:"spec.customAllValue",render:({field:n,fieldState:r})=>(0,t.jsx)(p.Z,{...n,fullWidth:!0,label:"Custom All Value",InputLabelProps:{shrink:"read"===e||void 0},InputProps:{readOnly:"read"===e},error:!!r.error,helperText:r.error?.message?r.error.message:"When All is selected, this value will be used",value:n.value??"",onChange:e=>{""===e.target.value?n.onChange(void 0):n.onChange(e)}})})]})]})]})}function nX({initialVariableDefinition:e,action:n,isDraft:r,isReadonly:a,onActionChange:o,onSave:l,onClose:g,onDelete:m}){let[h,v]=(0,f.useState)(!1),y=W(n,r),j=K(n,r),{variableEditorSchema:C}=U(),P=(0,b.useForm)({resolver:(0,s.F)(C),mode:"onBlur",defaultValues:e}),k=(0,b.useWatch)({control:P.control,name:"kind"});function T(e){let n={...e};return n.spec.display?.name===void 0&&n.spec.display?.description===void 0&&n.spec.display?.hidden===void 0&&delete n.spec.display,n}return(0,t.jsxs)(b.FormProvider,{...P,children:[(0,t.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",padding:e=>e.spacing(1,2),borderBottom:e=>`1px solid ${e.palette.divider}`},children:[(0,t.jsxs)(d.Z,{variant:"h2",children:[y," Variable"]}),(0,t.jsx)(i.FormActions,{action:n,submitText:j,isReadonly:a,isValid:P.formState.isValid,onActionChange:o,onSubmit:P.handleSubmit(e=>{l(T(e))}),onDelete:m,onCancel:function(){JSON.stringify(e)!==JSON.stringify(T(P.getValues()))?v(!0):g()}})]}),(0,t.jsxs)(u.Z,{padding:2,sx:{overflowY:"scroll"},children:[(0,t.jsxs)(c.ZP,{container:!0,spacing:2,mb:2,children:[(0,t.jsx)(c.ZP,{item:!0,xs:8,children:(0,t.jsx)(b.Controller,{control:P.control,name:"spec.name",render:({field:e,fieldState:i})=>(0,t.jsx)(p.Z,{...e,required:!0,fullWidth:!0,label:"Name",InputLabelProps:{shrink:"read"===n||void 0},InputProps:{disabled:"update"===n&&!r,readOnly:"read"===n},error:!!i.error,helperText:i.error?.message,value:e.value??"",onChange:n=>{e.onChange(n)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:4,children:(0,t.jsx)(b.Controller,{control:P.control,name:"spec.display.name",render:({field:e,fieldState:r})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,label:"Display Label",InputLabelProps:{shrink:"read"===n||void 0},InputProps:{readOnly:"read"===n},error:!!r.error,helperText:r.error?.message,value:e.value??"",onChange:n=>{e.onChange(n)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:8,children:(0,t.jsx)(b.Controller,{control:P.control,name:"spec.display.description",render:({field:e,fieldState:r})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,label:"Description",InputLabelProps:{shrink:"read"===n||void 0},InputProps:{readOnly:"read"===n},error:!!r.error,helperText:r.error?.message,value:e.value??"",onChange:n=>{e.onChange(n)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:4,children:(0,t.jsx)(b.Controller,{control:P.control,name:"kind",render:({field:e,fieldState:r})=>(0,t.jsx)(p.Z,{select:!0,...e,fullWidth:!0,label:"Type",InputLabelProps:{shrink:"read"===n||void 0},InputProps:{readOnly:"read"===n},error:!!r.error,helperText:r.error?.message,value:e.value??"TextVariable",onChange:n=>{e.onChange(n)},children:n_.map(e=>(0,t.jsx)(G.Z,{value:e.kind,children:e.label},e.kind))})})})]}),(0,t.jsx)(x.Z,{}),"TextVariable"===k&&(0,t.jsx)(i.ErrorBoundary,{FallbackComponent:i.ErrorAlert,children:(0,t.jsx)(nH,{action:n,control:P.control})}),"ListVariable"===k&&(0,t.jsx)(i.ErrorBoundary,{FallbackComponent:i.ErrorAlert,children:(0,t.jsx)(nY,{action:n,control:P.control})})]}),(0,t.jsx)(i.DiscardChangesConfirmationDialog,{description:"Are you sure you want to discard these changes? Changes cannot be recovered.",isOpen:h,onCancel:()=>{v(!1)},onDiscardChanges:()=>{v(!1),g()}})]})}var n0=r(63767);async function n1(...e){let n=await r.g.fetch(...e);if(!1===n.ok){let e=n.headers.get("content-type");if(e?.includes("application/json")){let e=await n.json();if(e.error)throw new n3(e.error,n.status);if(e.message)throw new n3(e.message,n.status)}let r=await n.text();if(r)throw new n3(r,n.status);throw new n5(n)}return n}async function n2(...e){let n=await n1(...e);return await n.json()}class n5 extends Error{status;constructor(e){super(`${e.status} ${e.statusText}`),this.status=e.status,Object.setPrototypeOf(this,n5.prototype)}}class n3 extends Error{status;constructor(e,n){super(e),this.status=n,Object.setPrototypeOf(this,n3.prototype)}}var n4=r(51564);let n7=(0,f.createContext)(void 0);function n6(){return(0,J.a)({queryKey:["projects"],queryFn:()=>n2("/api/v1/projects")})}function n8(){let e=(0,f.useContext)(n7);if(void 0===e)throw Error("No ProjectStoreContext found. Did you forget a Provider?");return e}function n9(e){let{children:n,enabledURLParams:r}=e,{project:i,setProject:a}=function(e=!0){let[n,r]=(0,n4.useQueryParams)({project:""},{updateType:"replaceIn"}),[t,i]=(0,f.useState)("none"),a=(0,f.useCallback)(e=>r({project:e}),[r]);return e?{project:n.project||"none",setProject:a}:{project:t,setProject:i}}(r),o=(0,f.useMemo)(()=>({project:{kind:"Project",metadata:{name:i}},setProject:e=>{a(e.metadata.name)}}),[i,a]);return(0,t.jsx)(n7.Provider,{value:o,children:n})}function re(e){let{onChange:n,value:r,...i}=e,{data:a,isLoading:o}=n6(),l=o?"":r.metadata.name??"none";return(0,t.jsxs)(n0.Z,{...i,value:l,onChange:e=>{n({kind:"Project",metadata:{name:e.target.value},spec:{}})},children:[(0,t.jsx)(G.Z,{value:"none",children:(0,t.jsx)(g.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:32,children:(0,t.jsx)(ex.Z,{children:"None"})})}),a?.map(e=>[t.jsx(G.Z,{value:e.metadata.name,children:t.jsx(g.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:32,children:t.jsx(ex.Z,{children:e.metadata.name})})},e.metadata.name)])]})}let rn=({value:e,onChange:n})=>(0,t.jsx)(i.OptionsEditorControl,{label:"Metric label",description:"Specify label to display",control:(0,t.jsx)(p.Z,{fullWidth:!0,name:"Metric label",value:e||"",onChange:e=>{n(e.target.value||void 0)}})});function rr(e){let n=new Map(e.map(e=>[e.resource,e.importPlugin]));return{getInstalledPlugins:async()=>Promise.resolve(Array.from(n.keys())),importPluginModule(e){let r=n.get(e);if(void 0===r)throw Error("Plugin not found");return r()}}}function rt(e){return!e||"string"==typeof e&&(0,nj.fs)(e)?e:(1e3*(0,nP.getUnixTime)(e)).toString()}function ri(e){let n=function(e,n){if(!e||0===e.length)return null;let r=e instanceof Array?e[0]:e;return null==r?r:""!==r?r:null}(e);return n?(0,nj.fs)(n)?n:new Date(Number(n)):null}let ra={encode:rt,decode:ri,equals:(e,n)=>e===n||(e&&n?e.valueOf()===n.valueOf():e===n)},ro={start:ra,end:ra},rl={refresh:ra};function rs(e){let[n]=(0,n4.useQueryParams)(ro,{updateType:"replaceIn"}),{start:r,end:t}=n;return(0,f.useMemo)(()=>{let n={pastDuration:e};if(!r)return n;let i=r.toString();return(0,nj.fs)(i)?n={pastDuration:i}:(0,nP.isDate)(r)&&(0,nP.isDate)(t)&&(n={start:r,end:t}),n},[r,t,e])}function ru(e){let[n,r]=(0,n4.useQueryParams)(ro,{updateType:"replaceIn"}),[t,i]=(0,f.useState)(!1),{start:a}=n;return(0,f.useEffect)(()=>{!t&&!a&&(0,nj.s3)(e)&&(r({start:e.pastDuration,end:void 0}),i(!0))},[e,t,a,r]),{timeRange:e,setTimeRange:(0,f.useCallback)(e=>{(0,nj.s3)(e)?r({start:e.pastDuration,end:void 0}):r(e)},[r])}}function rd(e){let[n]=(0,n4.useQueryParams)(rl,{updateType:"replaceIn"}),{refresh:r}=n;return(0,f.useMemo)(()=>{let n=e;if(!r)return n;let t=r.toString();return(0,nj.fs)(t)&&(n=t),n},[e,r])}function rc(e){let[n,r]=(0,n4.useQueryParams)(rl,{updateType:"replaceIn"}),[t,i]=(0,f.useState)(!1),{refresh:a}=n;return(0,f.useEffect)(()=>{t||a||(r({refresh:e}),i(!0))},[e,t,a,r]),{refreshInterval:e,setRefreshInterval:(0,f.useCallback)(e=>r({refresh:e}),[r])}}function rp(e){let{initialTimeRange:n,initialRefreshInterval:r,children:i}=e,{timeRange:a,setTimeRange:o}=ru(n),{refreshInterval:l,setRefreshInterval:s}=rc(r);return(0,t.jsx)(nZ,{timeRange:a,refreshInterval:l,setTimeRange:o,setRefreshInterval:s,children:i})}var rg=r(39517);function rm(e,n){return n?Object.fromEntries(Object.entries(e).filter(([e])=>n.includes(e))):e}function rh(e){return Object.values(e).map(e=>JSON.stringify(e.value)).join(",")}let rx="TimeSeriesQuery";function rf({plugin:e,definition:n,context:r}){let{timeRange:t,datasourceStore:i,suggestedStepMs:a,mode:o,variableState:l,refreshKey:s}=r,u=e?.dependsOn?e.dependsOn(n.spec.plugin.spec,r):{},d=u?.variables,c=[n,t,i,a,o,rh(rm(l,d)),s],p=!1;return d&&(p=d.some(e=>l[e]?.loading)),{queryKey:c,queryEnabled:void 0!==e&&!p}}let rv=(e,n,r)=>{let{data:t}=ee(rx,e.spec.plugin.kind),i=ry(),{queryEnabled:a,queryKey:o}=rf({plugin:t,definition:e,context:i});return(0,J.a)({enabled:(r?.enabled??!0)||a,queryKey:o,queryFn:()=>{if(void 0===t)throw Error("Expected plugin to be loaded");let r={...i,suggestedStepMs:n?.suggestedStepMs};return t.getTimeSeriesData(e.spec.plugin.spec,r)}})};function rb(e,n,r){let{getPlugin:t}=X(),i={...ry(),mode:n?.mode},a=en(rx,e.map(e=>({kind:e.spec.plugin.kind})));return(0,H.h)({queries:e.map((e,o)=>{let{queryEnabled:l,queryKey:s}=rf({plugin:a[o]?.data,definition:e,context:i});return{...r,enabled:(r?.enabled??!0)&&l,queryKey:s,queryFn:async()=>{let r={...i,suggestedStepMs:n?.suggestedStepMs},a=await t(rx,e.spec.plugin.kind);return await a.getTimeSeriesData(e.spec.plugin.spec,r)}}})})}function ry(){let{absoluteTimeRange:e,refreshKey:n}=nE();return{timeRange:e,variableState:eL(),datasourceStore:ey(),refreshKey:n}}function rj(){return rC((0,rg.NL)().getQueryCache())}function rC(e){let n=[];for(let r of e.findAll({type:"active"})){let e=r.queryKey?.[0];e?.kind&&e.kind.startsWith(rx)&&n.push(r)}return n}let rP="TraceQuery";function rk(e){let{start:n,end:r}=e;return{start:Math.ceil((0,nP.getUnixTime)(n)),end:Math.ceil((0,nP.getUnixTime)(r))}}function rT(e){let{getPlugin:n}=X(),r=function(){let{absoluteTimeRange:e}=nE();return{variableState:eL(),datasourceStore:ey(),absoluteTimeRange:e}}(),t=en("TraceQuery",e.map(e=>({kind:e.spec.plugin.kind})));return(0,H.h)({queries:e.map((e,i)=>{let{queryEnabled:a,queryKey:o}=function({plugin:e,definition:n,context:r}){let{datasourceStore:t,variableState:i,absoluteTimeRange:a}=r,o=e?.dependsOn?e.dependsOn(n.spec.plugin.spec,r):{},l=o?.variables,s=[n,t,a,rh(rm(i,l))],u=!1;return l&&(u=l.some(e=>i[e]?.loading)),{queryKey:s,queryEnabled:void 0!==e&&!u}}({context:r,definition:e,plugin:t[i]?.data}),l=e?.spec?.plugin?.kind;return{enabled:a,queryKey:o,queryFn:async()=>{let t=await n(rP,l);return await t.getTraceData(e.spec.plugin.spec,r)}}})})}let rE=(0,f.createContext)(void 0),rw=()=>(0,f.useContext)(rE),rZ=()=>{let e=rw();return{markQuery:(n,r)=>{if(void 0===e)return;let t=JSON.stringify(n);if((!e.pendingQueries.has(t)||"pending"!==r)&&e.pendingQueries.get(t)!==r){e.pendingQueries.set(t,r),"error"===r&&(e.renderErrorCount+=1);let n=[...e.pendingQueries.values()].every(e=>"pending"!==e);0===e.renderDurationMs&&n&&(e.renderDurationMs=Date.now()-e.startRenderTime,rS(e))}}}},rS=async e=>{await n1("/api/v1/view",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project:e.project,dashboard:e.dashboard,render_time:e.renderDurationMs/1e3,render_errors:e.renderErrorCount})})},rV=({project:e,dashboard:n,children:r})=>{let i={project:e,dashboard:n,renderErrorCount:0,startRenderTime:Date.now(),renderDurationMs:0,pendingQueries:new Map};return(0,t.jsx)(rE.Provider,{value:i,children:r})};function rz(e,n){return e.map(({data:e,isFetching:r,isLoading:t,refetch:i,error:a},o)=>({definition:n[o],data:e,isFetching:r,isLoading:t,refetch:i,error:a}))}function rO(){let{data:e,isLoading:n}=er(["TimeSeriesQuery"]),{data:r,isLoading:t}=er(["TraceQuery"]),i=(0,f.useMemo)(()=>{let n={TimeSeriesQuery:[],TraceQuery:[]};return e&&e.forEach(e=>{n[e.kind]?.push(e.spec.name)}),r&&r.forEach(e=>{n[e.kind]?.push(e.spec.name)}),n},[e,r]);return(0,f.useCallback)(e=>{if(!(e=>{switch(e){case"PrometheusTimeSeriesQuery":return n;case"TempoTraceQuery":return t}return t||n})(e)){for(let n in i)if(i[n]?.includes(e))return n;throw Error(`Unable to determine the query type: ${e}`)}},[i,n,t])}let rI=(0,f.createContext)(void 0);function rD(){let e=(0,f.useContext)(rI);if(void 0===e)throw Error("No DataQueriesContext found. Did you forget a Provider?");return e}function rL(e){let n=rD(),r=n.queryResults.filter(n=>n?.definition?.kind===e),t=n.errors.filter((r,t)=>n.queryResults[t]?.definition?.kind===e);return{queryResults:r,isFetching:r.some(e=>e.isFetching),isLoading:r.some(e=>e.isLoading),refetchAll:n.refetchAll,errors:t}}function rR(e){let{definitions:n,options:r,children:i,queryOptions:a}=e,o=rO(),l=n.map(e=>({kind:o(e.kind),spec:{plugin:e}})),s=rZ(),u=l.filter(e=>"TimeSeriesQuery"===e.kind),d=rb(u,r,a),c=l.filter(e=>"TraceQuery"===e.kind),p=rT(c),g=(0,f.useCallback)(()=>{d.forEach(e=>e.refetch()),p.forEach(e=>e.refetch())},[d,p]),m=(0,f.useMemo)(()=>{let e=[...rz(d,u),...rz(p,c)];if(a?.enabled)for(let n of e)n.isLoading||n.isFetching||n.error?n.error?s.markQuery(n.definition,"error"):s.markQuery(n.definition,"pending"):s.markQuery(n.definition,"success");return{queryResults:e,isFetching:e.some(e=>e.isFetching),isLoading:e.some(e=>e.isLoading),refetchAll:g,errors:e.map(e=>e.error)}},[u,d,c,p,g,a?.enabled,s]);return(0,t.jsx)(rI.Provider,{value:m,children:i})}function rA(...e){let n={kind:"PluginModule",metadata:{name:"Fake Plugin Module for Tests",version:"0"},spec:{plugins:e.map(({kind:e,spec:{name:n}})=>({kind:e,spec:{name:n,display:{name:rM(e,n)}}}))}},r={};for(let n of e)r[n.spec.name]=n.plugin;return{pluginLoader:{getInstalledPlugins:()=>Promise.resolve([n]),importPluginModule:()=>Promise.resolve(r)},defaultPluginKinds:{TimeSeriesQuery:"PrometheusTimeSeriesQuery"}}}function rM(e,n){return`${e} Plugin for ${n}`}var rq=r(56119),r$=r(72570),rF=r(6085),r_=r.n(rF),rN=r(65895);let rQ=null,rU=()=>(null===rQ&&(rQ=(0,rq.init)({name:"@perses/perses-ui-host",remotes:[],shared:{react:{version:v().version,lib:()=>v(),shareConfig:{singleton:!0,requiredVersion:`^${v().version}`}},"react-dom":{version:"18.3.1",lib:()=>r_(),shareConfig:{singleton:!0,requiredVersion:"^18.3.1"}},"react-router-dom":{version:"6.26.0",lib:()=>rN,shareConfig:{singleton:!0,requiredVersion:"^6.26.0"}},"@tanstack/react-query":{version:"4.39.1",lib:()=>r$,shareConfig:{singleton:!0,requiredVersion:"^4.39.1"}},"react-hook-form":{version:"7.52.2",lib:()=>b,shareConfig:{singleton:!0,requiredVersion:"^7.52.2"}},echarts:{version:"5.5.0",lib:()=>r(30156),shareConfig:{singleton:!0,requiredVersion:"^5.5.0"}},"@perses-dev/components":{version:"0.51.0-beta.0",lib:()=>r(20370),shareConfig:{singleton:!0,requiredVersion:"^0.51.0-rc.0"}},"@perses-dev/plugin-system":{version:"0.51.0-beta.0",lib:()=>r(57751),shareConfig:{singleton:!0,requiredVersion:"^0.51.0-rc.0"}},"@perses-dev/explore":{version:"0.51.0-beta.0",lib:()=>r(73223),shareConfig:{singleton:!0,requiredVersion:"^0.51.0-rc.0"}},"@perses-dev/dashboards":{version:"0.51.0-beta.0",lib:()=>r(24407),shareConfig:{singleton:!0,requiredVersion:"^0.51.0-rc.0"}},"date-fns":{version:"4.1.0",lib:()=>r(20461),shareConfig:{singleton:!0,requiredVersion:"^4.1.0"}},"date-fns-tz":{version:"3.2.0",lib:()=>r(4665),shareConfig:{singleton:!0,requiredVersion:"^3.2.0"}},lodash:{version:"4.17.21",lib:()=>r(74614),shareConfig:{singleton:!0,requiredVersion:"^4.17.21"}},"@emotion/react":{version:"11.11.3",lib:()=>r(72116),shareConfig:{singleton:!0,requiredVersion:"^11.11.3"}},"@emotion/styled":{version:"11.11.0",lib:()=>r(55922),shareConfig:{singleton:!0,requiredVersion:"^11.11.0"}},"@hookform/resolvers/zod":{version:"3.3.4",lib:()=>r(22538),shareConfig:{singleton:!0,requiredVersion:"^3.3.4"}},"use-resize-observer":{version:"9.1.0",lib:()=>r(75276),shareConfig:{singleton:!0,requiredVersion:"^9.1.0"}},"mdi-material-ui":{version:"7.4.0",lib:()=>r(61157),shareConfig:{singleton:!0,requiredVersion:"^7.4.0"}},immer:{version:"10.1.1",lib:()=>r(86373),shareConfig:{singleton:!0,requiredVersion:"^10.1.1"}}}})),rQ),rB=(e,n)=>{let r=rU();if(!r.options.remotes.find(n=>n.name===e)){let t=n?`${n}/${e}/mf-manifest.json`:`/plugins/${e}/mf-manifest.json`;r.registerRemotes([{name:e,entry:t,alias:e}])}},rW=async(e,n,r)=>(rB(e,r),(0,rq.loadRemote)(`${e}/${n}`));function rK({pluginFn:e,props:n}){return e(n)}function rG({plugin:e,props:n,field:r}){let{loadPlugin:i}=function({plugin:e}){return{pluginRuntime:rU(),loadPlugin:()=>rW(e.moduleName,e.name,e.baseURL)}}({plugin:e}),[a,o]=(0,f.useState)(null),[l,s]=(0,f.useState)(null),u=`${e.moduleName}-${e.name}`,d=(0,f.useRef)(u);if((0,f.useEffect)(()=>{d.current=u,s(null),i().then(e=>{o(e)}).catch(n=>{o(null),console.error(`PluginLoaderComponent: Error loading plugin ${e.name} from module ${e.moduleName}:`,n),s(Error(`PluginLoaderComponent: Error loading plugin ${e.name} from module ${e.moduleName}`))})},[u]),l)throw l;if(!a)return null;let c=a[e.name];if(r&&c&&"object"==typeof c&&r in c&&(c=c[r]),!c)throw Error(`PluginLoaderComponent: Plugin module ${e.moduleName} does not have a ${e.name} export`);if("function"!=typeof c)throw Error(`PluginLoaderComponent: Plugin ${e.name} export is not a function`);return d.current!==u?null:(0,t.jsx)(rK,{pluginFn:c,props:n},u)}let rJ=e=>"object"==typeof e&&null!==e&&"kind"in e&&"spec"in e&&"object"==typeof e.spec&&null!==e.spec&&"name"in e.spec,rH=e=>"object"==typeof e&&null!==e&&"metadata"in e&&"spec"in e&&"object"==typeof e.spec&&null!==e.spec&&"plugins"in e.spec&&Array.isArray(e.spec.plugins)&&e.spec.plugins.every(rJ),rY=e=>({getInstalledPlugins:async()=>{let n=await fetch(`${e||""}/api/v1/plugins`),r=await n.json(),t=[];return Array.isArray(r)?t=r.filter(rH):console.error("RemotePluginLoader: Error loading plugins, response is not an array"),t.length||console.error("RemotePluginLoader: No valid plugins found"),t},importPluginModule:async e=>{let n=e.metadata.name,r={};for(let t of e.spec.plugins){let e=await rW(n,t.spec.name),i=e?.[t.spec.name];i?r[t.spec.name]=i:console.error(`RemotePluginLoader: Error loading plugin ${t.spec.name}`)}return r}})}}]);