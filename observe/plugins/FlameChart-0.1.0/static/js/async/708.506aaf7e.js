"use strict";(self.webpackChunkFlameChart=self.webpackChunkFlameChart||[]).push([["708"],{38475:function(e,r,n){n.d(r,{BL:()=>s,Jj:()=>d,bk:()=>c,dT:()=>p,kx:()=>l,vo:()=>o,zx:()=>u});let t=["bottom","right"],i=["list","table"],a=["small","medium"];function o(e){return t.includes(e)}function l(e){return i.includes(e)}function s(e){return a.includes(e)}let u={position:"bottom",mode:"list",size:"medium"};function d(e){return void 0===e?u.position:o(e)?e:u.position}function c(e){return e&&l(e)?e:u.mode}function p(e){return e&&s(e)?e:u.size}},32340:function(e,r,n){n.r(r),n.d(r,{LEGEND_SIZE_CONFIG:()=>e4,PanelSpecEditor:()=>rf,validateLegendSpec:()=>e6,ProjectStoreProvider:()=>r9,useInitialRefreshInterval:()=>nd,MultiQueryEditor:()=>ru,useReplaceVariablesInString:()=>eR,LEGEND_VALUE_CONFIG:()=>e7,VariableListPreview:()=>rG,TimeRangeSettingsContext:()=>rV,selectorToOptionValue:()=>eQ,DEFAULT_REFRESH_INTERVAL_OPTIONS:()=>rA,OptionsEditorTabs:()=>rp,replaceVariables:()=>ek,DatasourceSelect:()=>eq,useActiveTimeSeriesQueries:()=>nj,getVariableValuesKey:()=>rF,useListVariablePluginValues:()=>r$,usePluginBuiltinVariableDefinitions:()=>et,TimeRangeProvider:()=>rS,useListDatasourceSelectItems:()=>ej,BuiltinVariableContext:()=>eS,useUsageMetrics:()=>nV,useShowCustomTimeRangeSetting:()=>rI,useTraceQueries:()=>nT,CalculationSelector:()=>l,useSetRefreshIntervalParams:()=>nc,QueryCountProvider:()=>rm,decodeTimeRangeValue:()=>ni,usePluginRegistry:()=>X,TRACE_QUERY_KEY:()=>nP,useBuiltinVariableDefinitions:()=>eO,TimeRangeProviderWithQueryParams:()=>np,ProjectSelect:()=>ne,TOOLTIP_TEXT:()=>rC,datasourceSelectValueToSelector:()=>eU,PROFILE_QUERY_KEY:()=>nE,OptionsEditorRadios:()=>eX,useProjectList:()=>r6,useTimeRangeContext:()=>rT,VariablePreview:()=>rK,useDataQueriesContext:()=>nR,usePlugins:()=>er,useBuiltinVariableValues:()=>eV,TimeRangeSettingsProvider:()=>rR,useProjectStore:()=>r8,LEGEND_MODE_CONFIG:()=>e3,useDatasourceStore:()=>ey,ValidationProvider:()=>B,mockPluginRegistry:()=>nq,LEGEND_POSITIONS_CONFIG:()=>e5,PluginLoaderComponent:()=>nH,getMockPluginName:()=>n$,useQueryCountContext:()=>rh,getUnixTimeRange:()=>nk,TimeRangeParam:()=>na,useShowZoomRangeSetting:()=>rD,replaceVariable:()=>eT,useTimeRangeSettingsContext:()=>rO,useTimeSeriesQueries:()=>nb,remotePluginLoader:()=>n0,LegendOptionsEditor:()=>rn,useTimeRangeOptionsSetting:()=>rL,useDatasourceSelectValueToSelector:()=>eB,optionValueToSelector:()=>e_,useBuiltinVariableContext:()=>eZ,PluginSpecEditor:()=>es,encodeTimeRangeValue:()=>nt,useListPluginMetadata:()=>en,useQueryType:()=>nD,VariableEditorForm:()=>rX,useTimeSeriesQuery:()=>nv,DataQueriesContext:()=>nL,PluginKindSelect:()=>ei,filterVariableList:()=>rq,useSuggestedStepMs:()=>rw,useTimeRange:()=>rE,DataQueriesProvider:()=>nM,isVariableDatasource:()=>eN,PluginRegistry:()=>rx,getActiveTimeSeriesQueries:()=>nC,useProfileQueries:()=>nw,usePluginEditor:()=>ec,useValidationSchemas:()=>U,PluginRegistryContext:()=>Y,UsageMetricsProvider:()=>nz,TimeRangeControls:()=>rM,usePlugin:()=>ee,legendValues:()=>e2,timeRangeQueryConfig:()=>no,MetricLabelInput:()=>nr,VariableContext:()=>eI,HTTPSettingsEditor:()=>e0,VARIABLE_TYPES:()=>rQ,getSubmitText:()=>K,refreshIntervalQueryConfig:()=>nl,useUsageMetricsContext:()=>nZ,useVariableValues:()=>eD,ValidationSchemasContext:()=>N,dynamicImportPluginLoader:()=>nn,PluginEditor:()=>ep,TimeRangeContext:()=>rk,transformQueryResults:()=>nI,useDataQueries:()=>nA,useDatasource:()=>eP,getTitleAction:()=>W,parseVariables:()=>ew,ProjectStoreContext:()=>r7,useAllVariableValues:()=>eL,useTimeRangeSettings:()=>rz,UsageMetricsContext:()=>nS,useTimeRangeParams:()=>nu,DatasourceName:()=>e$,useInitialTimeRange:()=>ns,VariableStoreStateMap:()=>ez,DatasourceStoreContext:()=>eb,TIME_SERIES_QUERY_KEY:()=>nf,DatasourceEditorForm:()=>eg,useDatasourceClient:()=>eC});var t=n(24246),i=n(36765);let a={first:{label:"First",description:"First value"},last:{label:"Last",description:"Last value"},"first-number":{label:"First *",description:"First numeric value"},"last-number":{label:"Last *",description:"Last numeric value"},mean:{label:"Avg",description:"Average value excluding nulls"},sum:{label:"Sum",description:"The sum of all values"},min:{label:"Min",description:"Minimum value"},max:{label:"Max",description:"Maximum value"}},o=Object.entries(a).map(([e,r])=>({id:e,...r}));function l({value:e,onChange:r}){let n=a[e];return(0,t.jsx)(i.OptionsEditorControl,{label:"Calculation",control:(0,t.jsx)(i.SettingsAutocomplete,{value:{...n,id:e},options:o,onChange:(e,n)=>{r(n.id)},disableClearable:!0})})}var s=n(494),u=n(36372),d=n(52054),c=n(38359),p=n(8695),g=n(25283),m=n(28797),h=n(87895),f=n(79119),x=n(54538),v=n.n(x),b=n(36679),y=n(77891);let j=y.z.string().min(1,"Required").max(75,"Must be 75 or fewer characters long").regex(/^[a-zA-Z0-9_.-]+$/,"Must only contains alphanumerical characters and special characters _ . -"),C=y.z.object({name:j}),P=C.extend({project:j}),k=y.z.object({kind:y.z.string().min(1,"Required"),spec:y.z.record(y.z.string(),y.z.any())}),T=y.z.object({name:y.z.string().optional(),description:y.z.string().optional()}),E=y.z.object({display:T.optional(),default:y.z.boolean(),plugin:k}),w=y.z.object({kind:y.z.literal("Datasource"),metadata:P,spec:E}),S=y.z.object({kind:y.z.literal("GlobalDatasource"),metadata:C,spec:E});y.z.discriminatedUnion("kind",[w,S]);let Z=y.z.object({name:y.z.string().min(1),spec:E}),V=y.z.object({name:y.z.string().min(1,{message:"Required"}),description:y.z.string().optional()}),O=y.z.object({kind:y.z.string().min(1),spec:y.z.object({plugin:k})}),z=y.z.object({name:y.z.string().optional(),url:y.z.string().min(1),tooltip:y.z.string().optional(),renderVariables:y.z.boolean().optional(),targetBlank:y.z.boolean().optional()}),I=y.z.object({display:V,plugin:k,queries:y.z.array(O).optional(),links:y.z.array(z).optional()}),D=y.z.object({kind:y.z.literal("Panel"),spec:I}),L=y.z.object({groupId:y.z.number(),panelDefinition:D}),R=y.z.object({name:y.z.string().optional(),description:y.z.string().optional(),hidden:y.z.boolean().optional()}),A=y.z.object({name:y.z.string().min(1),display:R.optional(),defaultValue:y.z.string().or(y.z.array(y.z.string())).optional(),allowAllValue:y.z.boolean(),allowMultiple:y.z.boolean(),customAllValue:y.z.string().optional(),capturingRegexp:y.z.string().optional(),sort:y.z.enum(["none","alphabetical-asc","alphabetical-desc","numerical-asc","numerical-desc","alphabetical-ci-asc","alphabetical-ci-desc"]).optional(),plugin:k}),M=y.z.object({kind:y.z.literal("ListVariable"),spec:A}),q=y.z.object({name:y.z.string().min(1),display:R.optional(),value:y.z.string(),constant:y.z.boolean().optional()}),$=y.z.object({kind:y.z.literal("TextVariable"),spec:q}),F=y.z.discriminatedUnion("kind",[$,M]),Q=y.z.object({kind:y.z.literal("Variable"),metadata:P,spec:F}),_=y.z.object({kind:y.z.literal("GlobalVariable"),metadata:P,spec:F});y.z.discriminatedUnion("kind",[Q,_]);let N=(0,x.createContext)(void 0);function U(){let e=(0,x.useContext)(N);if(void 0===e)throw Error("No ValidationSchemasContext found. Did you forget a Provider?");return e}function B({children:e}){let[r,n]=(0,x.useState)(Z),[i,a]=(0,x.useState)(L),[o,l]=(0,x.useState)(F);return(0,t.jsx)(N.Provider,{value:{datasourceEditorSchema:r,panelEditorSchema:i,variableEditorSchema:o,setDatasourceEditorSchemaPlugin:function(e){n(y.z.object({name:y.z.string().min(1),spec:y.z.object({display:T.optional(),default:y.z.boolean(),plugin:e})}))},setPanelEditorSchemaPlugin:function(e){a(y.z.object({groupId:y.z.number(),panelDefinition:y.z.object({kind:y.z.literal("Panel"),spec:y.z.object({display:V,plugin:e,queries:y.z.array(O).optional(),links:y.z.array(z).optional()})})}))},setVariableEditorSchemaPlugin:function(e){l(y.z.discriminatedUnion("kind",[y.z.object({kind:y.z.literal("ListVariable"),spec:y.z.object({name:y.z.string().min(1),display:R.optional(),defaultValue:y.z.string().or(y.z.array(y.z.string())).optional(),allowAllValue:y.z.boolean(),allowMultiple:y.z.boolean(),customAllValue:y.z.string().optional(),capturingRegexp:y.z.string().optional(),sort:y.z.enum(["none","alphabetical-asc","alphabetical-desc","numerical-asc","numerical-desc","alphabetical-ci-asc","alphabetical-ci-desc"]).optional(),plugin:e})}),y.z.object({kind:y.z.literal("TextVariable"),spec:q})]))}},children:e})}function W(e,r){return"read"===e?"View":r&&"create"===e?"Add":r||"create"!==e?"update"===e?"Edit":"":"Create"}function K(e,r){return r&&"create"===e?"Add":r&&"update"===e?"Apply":r?"":"Save"}var G=n(10517),J=n(9432),H=n(13986);let Y=(0,x.createContext)(void 0);function X(){let e=(0,x.useContext)(Y);if(void 0===e)throw Error("PluginRegistryContext not found. Did you forget a provider?");return e}function ee(e,r,n){n={...n,enabled:(n?.enabled??!0)&&void 0!==e&&""!==r};let{getPlugin:t}=X();return(0,J.a)({queryKey:["getPlugin",e,r],queryFn:()=>t(e,r),...n})}function er(e,r){let{getPlugin:n}=X(),t=[...new Set(r.map(e=>e.kind))],i=(0,H.h)({queries:t.map(r=>({queryKey:["getPlugin",e,r],queryFn:()=>n(e,r)}))});return r.map(e=>i[t.indexOf(e.kind)])}function en(e,r){let{listPluginMetadata:n}=X();return(0,J.a)({queryKey:["listPluginMetadata",e],queryFn:()=>n(e),...r})}function et(){let{getPlugin:e,listPluginMetadata:r}=X();return(0,J.a)({queryKey:["usePluginBuiltinVariableDefinitions"],queryFn:async()=>{let n=new Set((await r(["Datasource"])).map(e=>e.spec.name)),t=[];for(let r of n){let n=await e("Datasource",r);n.getBuiltinVariableDefinitions&&n.getBuiltinVariableDefinitions().forEach(e=>t.push(e))}return t}})}let ei=(0,x.forwardRef)((e,r)=>{let{pluginTypes:n,value:i,onChange:a,...o}=e,{data:l,isLoading:s}=en(n),u=!i||s?"":eo(i),d=(0,x.useCallback)(e=>{if(""===e)return"";let r=el(e);return l?.find(e=>e.kind===r.type&&e.spec.name===r.kind)?.spec.display.name},[l]);return(0,t.jsxs)(p.Z,{select:!0,inputRef:r,...o,value:u,"aria-label":u,onChange:e=>{a?.(el(e.target.value))},SelectProps:{renderValue:d},"data-testid":"plugin-kind-select",children:[s&&(0,t.jsx)(G.Z,{value:"",children:"Loading..."}),l?.map(e=>t.jsx(G.Z,{"data-testid":"option",value:eo({type:e.kind,kind:e.spec.name}),children:e.spec.display.name},e.kind+e.spec.name))]})});ei.displayName="PluginKindSelect";let ea="_____";function eo(e){return[e.type,e.kind].join(ea)}function el(e){let r=e.split(ea),n=r[0],t=r[1];if(void 0===n||void 0===t)throw Error("Invalid optionValue string");return{type:n,kind:t}}function es(e){let{pluginSelection:{type:r,kind:n},...a}=e,{data:o,isLoading:l,error:s}=ee(r,n);if(s)return(0,t.jsx)(i.ErrorAlert,{error:s});if(l)return null;if(void 0===o)throw Error(`Missing implementation for ${r} plugin with kind '${n}'`);if("Panel"===r)throw Error("This editor should not be used for panel type. Please use Panel Spec Editor instead.");let{OptionsEditorComponent:u}=o;return void 0!==u?(0,t.jsx)(u,{...a}):null}function eu(e){let r=(0,x.useRef)(e);return(0,x.useLayoutEffect)(()=>{r.current=e}),(0,x.useCallback)((...e)=>r.current(...e),[])}var ed=n(75586);function ec(e){let{pluginTypes:r,value:n,onHideQueryEditorChange:t=()=>{}}=e,i=eu(e.onChange),a=eu(t),o=(0,x.useRef)({[n.selection.type]:{[n.selection.kind]:n.spec}}),l=eu(()=>{let e=o.current[n.selection.type];void 0===e&&(e={},o.current[n.selection.type]=e),e[n.selection.kind]=n.spec}),s=(0,x.useRef)({[n.selection.kind]:!1}),{defaultPluginKinds:u}=X(),d=r[0],c=d?u?.[d]:void 0,p=d&&c?{type:d,kind:c}:void 0,g=!n.selection&&p?p:void 0,[m,h]=(0,x.useState)(g);(0,x.useEffect)(()=>{""===n.selection.kind&&(n.selection.kind=c||"")},[n.selection,c]);let{data:f,isFetching:v,error:b}=ee(m?.type,m?.kind||"");return(0,x.useEffect)(()=>{m&&void 0!==f&&(l(),i({selection:m,spec:f.createInitialOptions?f.createInitialOptions():{}}),"Panel"===m.type&&(s.current[m.kind]=!!f.hideQueryEditor,!!f.hideQueryEditor!==s.current[n.selection.kind]&&a(!!f.hideQueryEditor)),h(void 0))},[m,f,l,i,a,s,n.selection]),{pendingSelection:m,isLoading:v,error:b,onSelectionChange:e=>{let r=o.current[e.type]?.[e.kind];void 0!==r?(l(),i({selection:e,spec:r})):h(e),"Panel"===e.type&&void 0!==s.current[e.kind]&&s.current[n.selection.kind]!==s.current[e.kind]&&a(!!s.current[e.kind])},onSpecChange:e=>{i((0,ed.Uy)(n,r=>{r.spec=e}))},rememberCurrentSpecState:l}}function ep(e){let{value:r,pluginTypes:n,pluginKindLabel:a,onChange:o,isReadonly:l,...s}=e,{pendingSelection:d,isLoading:c,error:p,onSelectionChange:g,onSpecChange:m}=ec(e);return(0,t.jsxs)(u.Z,{...s,children:[(0,t.jsx)(ei,{fullWidth:!1,sx:{mb:2,minWidth:120},margin:"dense",label:a,pluginTypes:n,disabled:c,value:d||r.selection,InputProps:{readOnly:l},error:!!p,helperText:p?.message,onChange:g}),(0,t.jsx)(i.ErrorBoundary,{FallbackComponent:i.ErrorAlert,children:(0,t.jsx)(es,{pluginSelection:r.selection,value:r.spec,onChange:m,isReadonly:l})})]})}function eg(e){let{initialDatasourceDefinition:r,action:n,isDraft:a,isReadonly:o,onActionChange:l,onSave:v,onClose:y,onDelete:j}=e,[C,P]=(0,x.useState)(!1),k=W(n,a),T=K(n,a),{datasourceEditorSchema:E}=U(),w=(0,b.useForm)({resolver:(0,s.F)(E),mode:"onBlur",defaultValues:r});function S(e){let r={...e};return r.spec.display?.name===void 0&&r.spec.display?.description===void 0&&delete r.spec.display,r}return(0,t.jsxs)(b.FormProvider,{...w,children:[(0,t.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",padding:e=>e.spacing(1,2),borderBottom:e=>`1px solid ${e.palette.divider}`},children:[(0,t.jsxs)(d.Z,{variant:"h2",children:[k," Datasource"]}),(0,t.jsx)(i.FormActions,{action:n,submitText:T,isReadonly:o,isValid:w.formState.isValid,onActionChange:l,onSubmit:w.handleSubmit(e=>{v(S(e))}),onDelete:j,onCancel:function(){JSON.stringify(r)!==JSON.stringify(S(w.getValues()))?P(!0):y()}})]}),(0,t.jsxs)(u.Z,{padding:2,sx:{overflowY:"scroll"},children:[(0,t.jsxs)(c.ZP,{container:!0,spacing:2,mb:2,children:[(0,t.jsx)(c.ZP,{item:!0,xs:4,children:(0,t.jsx)(b.Controller,{control:w.control,name:"name",render:({field:e,fieldState:r})=>(0,t.jsx)(p.Z,{...e,required:!0,fullWidth:!0,name:"name",label:"Name",InputLabelProps:{shrink:"read"===n||void 0},InputProps:{disabled:"update"===n&&!a,readOnly:"read"===n},error:!!r.error,helperText:r.error?.message,value:e.value??"",onChange:r=>{e.onChange(r)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:8,children:(0,t.jsx)(b.Controller,{control:w.control,name:"spec.display.name",render:({field:e,fieldState:r})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,name:"title",label:"Display Label",InputLabelProps:{shrink:"read"===n||void 0},InputProps:{readOnly:"read"===n},error:!!r.error,helperText:r.error?.message,value:e.value??"",onChange:r=>{e.onChange(r)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:12,children:(0,t.jsx)(b.Controller,{control:w.control,name:"spec.display.description",render:({field:e,fieldState:r})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,name:"description",label:"Description",InputLabelProps:{shrink:"read"===n||void 0},InputProps:{readOnly:"read"===n},error:!!r.error,helperText:r.error?.message,value:e.value??"",onChange:r=>{e.onChange(r)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:6,sx:{paddingTop:"5px !important"},children:(0,t.jsxs)(g.Z,{children:[(0,t.jsx)(b.Controller,{control:w.control,name:"spec.default",render:({field:e})=>(0,t.jsx)(m.Z,{label:"Set as default",control:(0,t.jsx)(h.Z,{...e,checked:!!e.value,readOnly:"read"===n,onChange:r=>{"read"!==n&&e.onChange(r)}})})}),(0,t.jsxs)(d.Z,{variant:"caption",children:["Whether this datasource should be the default ",w.getValues().spec.plugin.kind," to be used"]})]})})]}),(0,t.jsx)(f.Z,{}),(0,t.jsx)(d.Z,{py:1,variant:"h3",children:"Plugin Options"}),(0,t.jsx)(b.Controller,{control:w.control,name:"spec.plugin",render:({field:e})=>(0,t.jsx)(ep,{width:"100%",pluginTypes:["Datasource"],pluginKindLabel:"Source",value:{selection:{type:"Datasource",kind:e.value.kind},spec:e.value.spec},isReadonly:"read"===n,onChange:r=>{e.onChange({kind:r.selection.kind,spec:r.spec})}})})]}),(0,t.jsx)(i.DiscardChangesConfirmationDialog,{description:"Are you sure you want to discard your changes? Changes cannot be recovered.",isOpen:C,onCancel:()=>P(!1),onDiscardChanges:()=>{P(!1),y()}})]})}var em=n(14371),eh=n(11774),ef=n(12577),ex=n(52889),ev=n(75094);let eb=(0,x.createContext)(void 0);function ey(){let e=(0,x.useContext)(eb);if(void 0===e)throw Error("No DatasourceStoreContext found. Did you forget a Provider?");return e}function ej(e,r){let{listDatasourceSelectItems:n}=ey();return(0,J.a)({queryKey:["listDatasourceSelectItems",e,r],queryFn:()=>n(e)})}function eC(e){let r=ey();return(0,J.a)({queryKey:["getDatasourceClient",e],queryFn:()=>r.getDatasourceClient(e)})}function eP(e){let r=ey();return(0,J.a)({queryKey:["getDatasource",e],queryFn:()=>r.getDatasource(e)})}function ek(e,r){let n=ew(e),t=e;return n.sort((e,r)=>r.length-e.length).forEach(e=>{let n=r[e];n&&void 0!==n.value&&(t=eT(t,e,n?.value))}),t}function eT(e,r,n){let t="";return Array.isArray(n)&&(t=`(${n.join("|")})`),"string"==typeof n&&(t=n),(e=e.replaceAll("$"+r,t)).replaceAll("${"+r+"}",t)}let eE=/\$(\w+)|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/gm,ew=e=>{let r;let n=new Set;for(;null!==(r=eE.exec(e));)r&&(r[1]?n.add(r[1]):r[2]&&n.add(r[2]));return Array.from(n.values())},eS=(0,x.createContext)(void 0);function eZ(){let e=(0,x.useContext)(eS);if(void 0===e)throw Error("No BuiltinVariableContext found. Did you forget a Provider?");return e}function eV(e){let{variables:r}=eZ(),n=(0,x.useMemo)(()=>{let e={};for(let n of r)e[n.spec.name]={loading:!1,value:n.spec.value()};return e},[r]),t=(0,x.useMemo)(()=>{let r={};return e?.forEach(e=>{let t=n[e];t&&(r[e]=t)}),r},[e,n]);return void 0===e?n:t}function eO(){let{variables:e}=eZ();return e}class ez{[ed.sc]=!0;DEFAULT_LOCAL_SOURCE_NAME="";_state={};get(e){return this._sourceStatesOrEmpty(e.source)[e.name]}set(e,r){let n=this._sourceName(e.source);return this._state[n]||(this._state[n]={}),this._sourceStatesOrEmpty(e.source)[e.name]=r,r}has(e){return void 0!==this._sourceStatesOrEmpty(e.source)[e.name]}delete(e){let r=this.has(e),n=this._sourceName(e.source),t=this._state[n];return t&&delete t[e.name],Object.keys(t??{})?.length===0&&delete this._state[n],r}_sourceName(e){return e??this.DEFAULT_LOCAL_SOURCE_NAME}_sourceStatesOrEmpty(e){return this._state[this._sourceName(e)]??{}}}let eI=(0,x.createContext)(void 0);function eD(e){let{state:r}=function(){let e=(0,x.useContext)(eI);if(void 0===e)throw Error("No VariableContext found. Did you forget a Provider?");return e}(),n=(0,x.useMemo)(()=>{let n={};return e?.forEach(e=>{let t=r[e];t&&(n[e]=t)}),n},[r,e]);return void 0===e?r:n}function eL(e){let r=eD(e),n=eV(e);return(0,x.useMemo)(()=>({...r,...n}),[r,n])}function eR(e){let r=eL(e?ew(e):[]);if(e)return ek(e,r)}let eA="__DATASOURCE_VARIABLE_VALUE__",eM={name:"",value:""};function eq(e){let{datasourcePluginKind:r,value:n,project:i,onChange:a,...o}=e,{data:l,isLoading:s}=ej(r,i),u=eD(),d=(0,x.useMemo)(()=>{if(eN(n))return n;let e=(l??[]).flatMap(e=>e.items).find(e=>n.kind===e.selector.kind&&n.name===e.selector.name&&!e.overridden)?.selector.group;return{...n,group:e}},[n,l]),c=(0,x.useMemo)(()=>{let e=(l||[]).flatMap(e=>e.items.map(r=>({groupLabel:e.group,groupEditLink:e.editLink,name:r.name,overriding:r.overriding,overridden:r.overridden,saved:r.saved??!0,group:r.selector.group,value:eQ(r.selector)}))),r=new Map(e.map(e=>[e.name,e]));return[...e,...Object.entries(u).flatMap(([e,n])=>Array.isArray(n.value)||!r.get(n.value??"")?[]:{groupLabel:"Variables",name:`$${e}`,saved:!0,value:`${eA}$${e}`})]},[l,u]),m=s?eM:c.find(e=>e.value===eQ(d)),h=e=>{e?a(e_(e?.value||"")):a({kind:r})},f=()=>{};return(0,t.jsx)(eh.Z,{options:c,renderInput:e=>(0,t.jsx)(p.Z,{...e,label:o.label,placeholder:""}),groupBy:e=>e.groupLabel||"No group",getOptionLabel:e=>e.name,onChange:(e,r)=>h(r),value:m,renderOption:(e,r)=>(0,x.createElement)("li",{...e,key:r.value},(0,t.jsxs)(g.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",width:"100%",children:[(0,t.jsx)(ef.Z,{children:(0,t.jsx)(e$,{name:r.name,overridden:r.overridden,overriding:r.overriding})}),!r.saved&&(0,t.jsx)(ef.Z,{children:"Save the dashboard to enable this datasource"}),(0,t.jsx)(ef.Z,{style:{textAlign:"right"},children:r.groupLabel&&r.groupLabel.length>0&&(0,t.jsx)(ex.Z,{disabled:!1,label:r.groupLabel,size:"small",onDelete:r.groupEditLink?f:void 0,deleteIcon:r.groupEditLink?(0,t.jsx)(ev.Z,{href:r.groupEditLink,target:"_blank",children:(0,t.jsx)(em.default,{fontSize:"small"})}):void 0})})]}))})}function e$(e){let{name:r,overridden:n,overriding:i}=e;return(0,t.jsxs)(t.Fragment,{children:[`${r} `,!n&&i&&(0,t.jsx)(u.Z,{display:"inline",fontWeight:"normal",color:e=>e.palette.primary.main,children:"(overriding)"}),n&&"(overridden)"]})}let eF="_____";function eQ(e){return eN(e)?`${eA}${e}`:[e.kind,e.group??"",e.name??""].join(eF)}function e_(e){if(e.startsWith(eA))return e.split(eA)[1];let r=e.split(eF),n=r[0],t=r[2];if(void 0===n||void 0===t)throw Error("Invalid optionValue string");return{kind:n,name:""===t?void 0:t}}function eN(e){return"string"==typeof e&&e.startsWith("$")}let eU=(e,r,n)=>{if(!eN(e))return e;let[t]=ew(e),i=r[t??""];if(!i||Array.isArray(i.value))return;let a=(n||[]).flatMap(e=>e.items).find(e=>e.name===i.value);if(void 0!==a)return{kind:a.selector.kind,name:a.selector.name}},eB=(e,r)=>{let{data:n}=ej(r),t=eD();return eN(e)?eU(e,t,n)??{kind:r}:e};var eW=n(86396),eK=n(33755),eG=n(90192),eJ=n(65091),eH=n(12e3);function eY(e){let{children:r,value:n,index:i,...a}=e,o=n===i;return(0,t.jsx)("div",{role:"tabpanel",hidden:!o,id:`options-editor-tabpanel-${i}`,"aria-labelledby":`options-editor-tab-${i}`,...a,children:o&&(0,t.jsx)(u.Z,{mt:2,children:r})})}let eX=e=>{let{tabs:r,defaultTab:n,onModeChange:i,isReadonly:a}=e,[o,l]=(0,x.useState)(n);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Z,{sx:{borderBottom:1,borderColor:e=>e.palette.divider},children:(0,t.jsx)(eG.Z,{children:(0,t.jsx)(eJ.Z,{row:!0,defaultValue:n,value:o,onChange:(e,r)=>{let n=parseInt(r);l(n),i(n)},"aria-labelledby":"Configuration radio",children:r.map(({label:e},r)=>(0,t.jsx)(m.Z,{disabled:a,value:r,control:(0,t.jsx)(eH.Z,{}),label:e},e))})})}),r.map(({label:e,content:r},n)=>(0,t.jsx)(eY,{value:o,index:n,children:r},e))]})};function e0(e){let{value:r,onChange:n,isReadonly:i,initialSpecDirect:a,initialSpecProxy:o}=e,l="Direct access",s="Proxy";r.directUrl||r.proxy||Object.assign(r,o);let u=(e,r,n)=>void 0===e?e:{...Object.keys(e).reduce((t,i)=>(i===r?t[n]=e[r]||"":t[i]=e[i]||"",t),{})},g=[{label:l,content:(0,t.jsx)(b.Controller,{name:"URL",render:({field:e,fieldState:a})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,label:"URL",value:r.directUrl||"",error:!!a.error,helperText:a.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{e.onChange(t),n((0,ed.Uy)(r,e=>{e.directUrl=t.target.value}))}})})},{label:s,content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Controller,{name:"URL",render:({field:e,fieldState:a})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,label:"URL",value:r.proxy?.spec.url||"",error:!!a.error,helperText:a.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{e.onChange(t),n((0,ed.Uy)(r,e=>{void 0!==e.proxy&&(e.proxy.spec.url=t.target.value)}))},sx:{mb:2}})}),(0,t.jsx)(d.Z,{variant:"h4",mb:2,children:"Allowed endpoints"}),(0,t.jsxs)(c.ZP,{container:!0,spacing:2,mb:2,children:[r.proxy?.spec.allowedEndpoints&&r.proxy?.spec.allowedEndpoints.length!==0?r.proxy.spec.allowedEndpoints.map(({endpointPattern:e,method:a},o)=>(0,t.jsxs)(x.Fragment,{children:[(0,t.jsx)(c.ZP,{item:!0,xs:8,children:(0,t.jsx)(b.Controller,{name:`Endpoint pattern ${o}`,render:({field:a,fieldState:l})=>(0,t.jsx)(p.Z,{...a,fullWidth:!0,label:"Endpoint pattern",value:e,error:!!l.error,helperText:l.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:e=>{a.onChange(e),n((0,ed.Uy)(r,r=>{void 0!==r.proxy&&(r.proxy.spec.allowedEndpoints=r.proxy.spec.allowedEndpoints?.map((r,n)=>o===n?{endpointPattern:e.target.value,method:r.method}:r))}))}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:3,children:(0,t.jsx)(b.Controller,{name:`Method ${o}`,render:({field:e,fieldState:l})=>(0,t.jsxs)(p.Z,{...e,select:!0,fullWidth:!0,label:"Method",value:a,error:!!l.error,helperText:l.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{e.onChange(t),n((0,ed.Uy)(r,e=>{void 0!==e.proxy&&(e.proxy.spec.allowedEndpoints=e.proxy.spec.allowedEndpoints?.map((e,r)=>o===r?{endpointPattern:e.endpointPattern,method:t.target.value}:e))}))},children:[(0,t.jsx)(G.Z,{value:"GET",children:"GET"}),(0,t.jsx)(G.Z,{value:"POST",children:"POST"}),(0,t.jsx)(G.Z,{value:"PUT",children:"PUT"}),(0,t.jsx)(G.Z,{value:"PATCH",children:"PATCH"}),(0,t.jsx)(G.Z,{value:"DELETE",children:"DELETE"})]})})}),(0,t.jsx)(c.ZP,{item:!0,xs:1,children:(0,t.jsx)(b.Controller,{name:`Remove Endpoint ${o}`,render:({field:e})=>(0,t.jsx)(ev.Z,{...e,disabled:i,onClick:t=>{e.onChange(t),n((0,ed.Uy)(r,e=>{void 0!==e.proxy&&(e.proxy.spec.allowedEndpoints=[...e.proxy.spec.allowedEndpoints?.filter((e,r)=>r!==o)||[]])}))},children:(0,t.jsx)(eW.default,{})})})})]},o)):(0,t.jsx)(c.ZP,{item:!0,xs:4,children:(0,t.jsx)(d.Z,{sx:{fontStyle:"italic"},children:"None"})}),(0,t.jsx)(c.ZP,{item:!0,xs:12,sx:{paddingTop:"0px !important",paddingLeft:"5px !important"},children:(0,t.jsx)(ev.Z,{disabled:i,onClick:()=>n((0,ed.Uy)(r,e=>{void 0!==e.proxy&&(e.proxy.spec.allowedEndpoints=[...e.proxy.spec.allowedEndpoints??[],{endpointPattern:"",method:""}])})),children:(0,t.jsx)(eK.default,{})})})]}),(0,t.jsx)(d.Z,{variant:"h4",mb:2,children:"Request Headers"}),(0,t.jsxs)(c.ZP,{container:!0,spacing:2,mb:2,children:[r.proxy?.spec.headers&&Object.keys(r.proxy.spec.headers).map((e,a)=>(0,t.jsxs)(x.Fragment,{children:[(0,t.jsx)(c.ZP,{item:!0,xs:4,children:(0,t.jsx)(b.Controller,{name:`Header name ${a}`,render:({field:a,fieldState:o})=>(0,t.jsx)(p.Z,{...a,fullWidth:!0,label:"Header name",value:e,error:!!o.error,helperText:o.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{a.onChange(t),n((0,ed.Uy)(r,r=>{void 0!==r.proxy&&(r.proxy.spec.headers=u(r.proxy.spec.headers,e,t.target.value))}))}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:7,children:(0,t.jsx)(b.Controller,{name:`Header value ${a}`,render:({field:a,fieldState:o})=>(0,t.jsx)(p.Z,{...a,fullWidth:!0,label:"Header value",value:r.proxy?.spec.headers?.[e],error:!!o.error,helperText:o.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{a.onChange(t),n((0,ed.Uy)(r,r=>{void 0!==r.proxy&&(r.proxy.spec.headers={...r.proxy.spec.headers,[e]:t.target.value})}))}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:1,children:(0,t.jsx)(b.Controller,{name:`Remove Header ${a}`,render:({field:a})=>(0,t.jsx)(ev.Z,{...a,disabled:i,onClick:t=>{a.onChange(t);let i={...r.proxy?.spec.headers};delete i[e],n((0,ed.Uy)(r,e=>{void 0!==e.proxy&&(e.proxy.spec.headers=i)}))},children:(0,t.jsx)(eW.default,{})})})})]},a)),(0,t.jsx)(c.ZP,{item:!0,xs:12,sx:{paddingTop:"0px !important",paddingLeft:"5px !important"},children:(0,t.jsx)(ev.Z,{disabled:i,onClick:()=>n((0,ed.Uy)(r,e=>{void 0!==e.proxy&&(e.proxy.spec.headers={...e.proxy.spec.headers,"":""})})),children:(0,t.jsx)(eK.default,{})})})]}),(0,t.jsx)(b.Controller,{name:"Secret",render:({field:e,fieldState:a})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,label:"Secret",value:r.proxy?.spec.secret||"",error:!!a.error,helperText:a.error?.message,InputProps:{readOnly:i},InputLabelProps:{shrink:!!i||void 0},onChange:t=>{e.onChange(t),n((0,ed.Uy)(r,e=>{void 0!==e.proxy&&(e.proxy.spec.secret=t.target.value)}))}})})]})}],m=g.findIndex(e=>e.label===l),h=g.findIndex(e=>e.label===s),f=r.proxy?h:m,[v,y]=(0,x.useState)(a),[j,C]=(0,x.useState)(o);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{variant:"h4",mt:2,children:"HTTP Settings"}),(0,t.jsx)(eX,{isReadonly:i,tabs:g,defaultTab:f,onModeChange:e=>{if(g[e]?.label===l){C(r);let{proxy:e,...t}=r;n({...t,directUrl:v.directUrl})}else if(g[e]?.label===s){y(r);let{directUrl:e,...t}=r;n({...t,proxy:j.proxy})}}})]})}var e1=n(38475);let e2=["mean","first","first-number","last","last-number","min","max","sum"],e5={bottom:{label:"Bottom"},right:{label:"Right"}},e3={list:{label:"List"},table:{label:"Table"}},e4={small:{label:"Small"},medium:{label:"Medium"}},e7=e2.reduce((e,r)=>(e[r]=a[r],e),{});function e6(e){return void 0===e||!!((0,e1.vo)(e.position)&&(!e.mode||(0,e1.kx)(e.mode))&&(!e.size||(0,e1.BL)(e.size)))}let e8=Object.entries(e5).map(([e,r])=>({id:e,...r})),e9=Object.entries(e3).map(([e,r])=>({id:e,...r})),re=Object.entries(e4).map(([e,r])=>({id:e,...r})),rr=Object.entries(e7).map(([e,r])=>({id:e,...r}));function rn({value:e,onChange:r,showValuesEditor:n=!0}){let a=e6(e),o=(0,e1.Jj)(e?.position),l=e5[o],s=(0,e1.bk)(e?.mode),u=e3[s],d=(0,e1.dT)(e?.size),c=e4[d],p=(e?.values||[]).reduce((e,r)=>{let n=e7[r];return n&&e.push({...n,id:r}),e},[]);return(0,t.jsxs)(i.OptionsEditorGroup,{title:"Legend",children:[!a&&(0,t.jsx)(i.ErrorAlert,{error:{name:"invalid-legend",message:"Invalid legend spec"}}),(0,t.jsx)(i.OptionsEditorControl,{label:"Show",control:(0,t.jsx)(h.Z,{checked:void 0!==e,onChange:(e,n)=>{r(!0===n?{position:e1.zx.position}:void 0)}})}),(0,t.jsx)(i.OptionsEditorControl,{label:"Position",control:(0,t.jsx)(i.SettingsAutocomplete,{value:{...l,id:o},options:e8,onChange:(n,t)=>{r({...e,position:t.id})},disabled:void 0===e,disableClearable:!0})}),(0,t.jsx)(i.OptionsEditorControl,{label:"Mode",control:(0,t.jsx)(i.SettingsAutocomplete,{value:{...u,id:s},options:e9,onChange:(n,t)=>{r({...e,position:o,mode:t.id})},disabled:void 0===e,disableClearable:!0})}),(0,t.jsx)(i.OptionsEditorControl,{label:"Size",control:(0,t.jsx)(i.SettingsAutocomplete,{value:{...c,id:d},options:re,onChange:(n,t)=>{r({...e,position:o,size:t.id})},disabled:void 0===e||"table"!==s,disableClearable:!0})}),n&&(0,t.jsx)(i.OptionsEditorControl,{label:"Values",control:(0,t.jsx)(i.SettingsAutocomplete,{multiple:!0,disableCloseOnSelect:!0,disableClearable:!0,value:p,options:rr,onChange:(n,t)=>{r({...e,position:o,values:t.map(e=>e.id)})},disabled:void 0===e||"table"!==s,limitTags:1,ChipProps:{size:"small"}})})]})}var rt=n(48565),ri=n(22446),ra=n(12449),ro=n(84974);let rl=({queryTypes:e,index:r,query:n,isCollapsed:i,onDelete:a,onChange:o,onCollapseExpand:l})=>(0,t.jsxs)(g.Z,{spacing:1,children:[(0,t.jsxs)(g.Z,{direction:"row",alignItems:"center",borderBottom:1,borderColor:e=>e.palette.divider,children:[(0,t.jsx)(ev.Z,{size:"small",onClick:()=>l(r),children:i?(0,t.jsx)(ro.default,{}):(0,t.jsx)(ra.default,{})}),(0,t.jsxs)(d.Z,{variant:"overline",component:"h4",children:["Query #",r+1]}),(0,t.jsx)(ev.Z,{size:"small",sx:{marginLeft:"auto",visibility:`${a?"visible":"hidden"}`},onClick:()=>a&&a(r),children:(0,t.jsx)(ri.default,{})})]}),!i&&(0,t.jsx)(rs,{queryTypes:e,value:n,onChange:e=>o(r,e)})]},r);function rs(e){let{value:r,onChange:n,queryTypes:i,...a}=e;return(0,t.jsx)(u.Z,{...a,children:(0,t.jsx)(ep,{pluginTypes:i,pluginKindLabel:"Query Type",value:{selection:{kind:r.spec.plugin.kind,type:r.kind},spec:r.spec.plugin.spec},onChange:e=>{n((0,ed.Uy)(r,r=>{r.kind=e.selection.type,r.spec.plugin.kind=e.selection.kind,r.spec.plugin.spec=e.spec}))}})})}function ru({queryTypes:e,queries:r=[],onChange:n}){let{defaultInitialQueryDefinition:i,isLoading:a}=function(e){let r=e[0],{data:n,isLoading:t}=en(e),{defaultPluginKinds:i}=X(),a=i?.[r]??n?.[0]?.spec.name??"",{data:o}=ee(r,a,{throwOnError:!0,enabled:!0});return{defaultInitialQueryDefinition:{kind:r,spec:{plugin:{kind:a,spec:o?.createInitialOptions()||{}}}},isLoading:t}}(e),[o,l]=(0,x.useState)(r.map(()=>!1)),s=(e,t)=>{n((0,ed.Uy)(r,r=>{r?r[e]=t:r=[t]}))},u=e=>{n((0,ed.Uy)(r,r=>{r.splice(e,1)})),l(r=>(r.splice(e,1),[...r]))},d=e=>{l(r=>(r[e]=!r[e],[...r]))},c=r.length?r:a?[]:[i];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Z,{spacing:1,children:c.map((n,i)=>(0,t.jsx)(rl,{queryTypes:e,index:i,query:n,isCollapsed:!!o[i],onChange:s,onDelete:r.length>1?u:void 0,onCollapseExpand:d},i))}),(0,t.jsx)(rt.Z,{variant:"contained",startIcon:(0,t.jsx)(eK.default,{}),sx:{marginTop:1},onClick:()=>{n((0,ed.Uy)(r,e=>{e?e.push(i):e=[...r,i]})),l(e=>(e.push(!1),[...e]))},children:"Add Query"})]})}var rd=n(51781),rc=n(49408);let rp=({tabs:e})=>{let[r,n]=(0,x.useState)(0);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Z,{sx:{borderBottom:1,borderColor:e=>e.palette.divider},children:(0,t.jsx)(rd.Z,{value:r,onChange:(e,r)=>{n(r)},"aria-label":"Panel configuration tabs",children:e.map(({label:e},r)=>(0,t.jsx)(rc.Z,{label:e,id:`options-editor-tab-${r}`,"aria-controls":`options-editor-tabpanel-${r}`},e))})}),e.map(({label:e,content:n},i)=>(0,t.jsx)(eY,{value:r,index:i,children:n},e))]})},rg=(0,x.createContext)(0),rm=({queryCount:e,children:r})=>(0,t.jsx)(rg.Provider,{value:e,children:r}),rh=()=>(0,x.useContext)(rg);function rf(e){let{control:r,panelDefinition:n,onJSONChange:a,onQueriesChange:o,onPluginSpecChange:l}=e,{kind:s}=n.spec.plugin,{data:u,isPending:d,error:c}=ee("Panel",s);if(c)return(0,t.jsx)(i.ErrorAlert,{error:c});if(d)return null;if(void 0===u)throw Error(`Missing implementation for panel plugin with kind '${s}'`);let{panelOptionsEditorComponents:p,hideQueryEditor:g}=u,m=[];return g||m.push({label:"Query",content:(0,t.jsx)(b.Controller,{control:r,name:"panelDefinition.spec.queries",render:({field:e})=>(0,t.jsx)(ru,{queryTypes:u.supportedQueryTypes??[],queries:n.spec.queries??[],onChange:r=>{e.onChange(r),o(r)}})})}),void 0!==p&&(m=m.concat(p.map(({label:e,content:i})=>({label:e,content:(0,t.jsx)(b.Controller,{control:r,name:"panelDefinition.spec.plugin.spec",render:({field:e})=>(0,t.jsx)(i,{value:n.spec.plugin.spec,onChange:r=>{e.onChange(r),l(r)}})})})))),m.push({label:"Links",content:(0,t.jsx)(i.LinksEditor,{control:r})}),m.push({label:"JSON",content:(0,t.jsx)(b.Controller,{control:r,name:"panelDefinition",render:({field:e})=>(0,t.jsx)(i.JSONEditor,{maxHeight:"80vh",value:n,onChange:r=>{e.onChange(JSON.parse(r)),a(r)}})})}),(0,t.jsx)(rm,{queryCount:(n.spec.queries??[]).length,children:(0,t.jsx)(rp,{tabs:m},m.length)})}function rx(e){let{pluginLoader:{getInstalledPlugins:r,importPluginModule:n},children:i,defaultPluginKinds:a}=e,o=function(e){let r=eu(async()=>{let r=await e(),n=new Map,t=new Map;for(let e of r)for(let r of e.spec.plugins){var i,a;let{kind:o,spec:{name:l}}=r,s=(i=o,a=l,`${i}:${a}`);n.has(s)&&console.warn(`Got more than one ${o} plugin for kind ${l}`),n.set(s,e);let u=t.get(o);void 0===u&&(u=[],t.set(o,u)),u.push({...r,module:e.metadata})}return{pluginResourcesByNameAndKind:n,pluginMetadataByKind:t}}),n=(0,x.useRef)(void 0);return(0,x.useCallback)(()=>{let e=n.current;return void 0===e&&(e=r(),n.current=e,e.catch(()=>void 0===n.current)),e},[r])}(r),l=(0,x.useRef)(new Map),s=eu(e=>{let r=l.current.get(e);return void 0===r&&(r=n(e),l.current.set(e,r),r.catch(()=>l.current.delete(e))),r}),u=(0,x.useCallback)(async(e,r)=>{let n=await o(),t=`${e}:${r}`,i=n.pluginResourcesByNameAndKind.get(t);if(void 0===i)throw Error(`A ${r} plugin for kind '${e}' is not installed`);let a=(await s(i))[r];if(void 0===a)throw Error(`The ${r} plugin for kind '${e}' is missing from the ${i.metadata.name} plugin module`);return a},[o,s]),d=(0,x.useCallback)(async e=>{let r=await o();return e.flatMap(e=>r.pluginMetadataByKind.get(e)??[])},[o]),c=(0,x.useMemo)(()=>({getPlugin:u,listPluginMetadata:d,defaultPluginKinds:a}),[u,d,a]);return(0,t.jsx)(Y.Provider,{value:c,children:i})}var rv=n(67877),rb=n(28278),ry=n(17001),rj=n(93729);let rC={refreshVariableValues:"Refresh values",copyVariableValues:"Copy values to clipboard",refresh:"Refresh",refreshInterval:"Auto refresh interval",zoomIn:"Zoom in",zoomOut:"Zoom out"};var rP=n(20461);let rk=(0,x.createContext)(void 0);function rT(){let e=(0,x.useContext)(rk);if(void 0===e)throw Error("No TimeRangeContext found. Did you forget a Provider?");return e}function rE(){return rT()}function rw(e){let{absoluteTimeRange:r}=rE();return void 0===e?0:(0,rj.YF)(r,e)}function rS(e){let{timeRange:r,refreshInterval:n,children:i,setTimeRange:a,setRefreshInterval:o}=e,[l,s]=(0,x.useState)(r),[u,d]=(0,x.useState)(n),[c,p]=(0,x.useState)(0);(0,x.useEffect)(()=>{s(r)},[r,c]),(0,x.useEffect)(()=>{d(n)},[n]);let g=(0,x.useCallback)(()=>{p(e=>e+1)},[p]),m=null!=u?(0,rP.milliseconds)((0,rj.Ib)(u)):0;(0,x.useEffect)(()=>{if(m>0){let e=setInterval(()=>{g()},m);return()=>clearInterval(e)}},[g,m]);let h=(0,x.useMemo)(()=>{let e=(0,rj.s3)(l)?(0,rj.sG)(l):l;return{timeRange:l,setTimeRange:a??s,absoluteTimeRange:e,refresh:g,refreshKey:`${e.start}:${e.end}:${u}:${c}`,refreshInterval:u,refreshIntervalInMs:m,setRefreshInterval:o??d}},[l,a,g,u,c,m,o]);return(0,t.jsx)(rk.Provider,{value:h,children:i})}let rZ={showCustom:!0,showZoomButtons:!0,options:["5m","15m","30m","1h","6h","12h","24h","7d","14d"].map(e=>(0,i.buildRelativeTimeOption)(e))},rV=(0,x.createContext)(rZ);function rO(){let e=(0,x.useContext)(rV);if(void 0===e)throw Error("No TimeRangeContext found. Did you forget a Provider?");return e}function rz(){return rO()}function rI(e){let r=rz().showCustom;return void 0!==e?e:r}function rD(e){let r=rz().showZoomButtons;return void 0!==e?e:r}function rL(e){let r=rz().options;return void 0!==e?e:r}function rR(e){let r=(0,x.useMemo)(()=>({showCustom:void 0===e.showCustom?rZ.showCustom:e.showCustom,showZoomButtons:void 0===e.showZoomButtons?rZ.showZoomButtons:e.showZoomButtons,options:void 0===e.options?rZ.options:e.options}),[e.showCustom,e.showZoomButtons,e.options]);return(0,t.jsx)(rV.Provider,{value:r,children:e.children})}let rA=[{value:{pastDuration:"0s"},display:"Off"},{value:{pastDuration:"5s"},display:"5s"},{value:{pastDuration:"10s"},display:"10s"},{value:{pastDuration:"15s"},display:"15s"},{value:{pastDuration:"30s"},display:"30s"},{value:{pastDuration:"60s"},display:"1m"}];function rM({heightPx:e,showTimeRangeSelector:r=!0,showRefreshButton:n=!0,showRefreshInterval:a=!0,showCustomTimeRange:o,showZoomButtons:l=!0,timePresets:s}){let{timeRange:u,setTimeRange:d,refresh:c,refreshInterval:p,setRefreshInterval:m}=rE(),h=rI(o),f=rD(l),v=rL(s),b=void 0===e?"34px":`${e}px`;"pastDuration"in u&&!v.some(e=>e.value.pastDuration===u.pastDuration)&&v.push((0,i.buildRelativeTimeOption)(u.pastDuration));let y=(0,x.useCallback)(e=>{m(e)},[m]),j=e=>{let r=(0,rj.Ib)(e);return((r.seconds??0)+(r.minutes??0)*60+(r.hours??0)*3600+(r.days??0)*86400+(r.weeks??0)*604800+(r.months??0)*2629746+(r.years??0)*0x1e18558)*1e3},C=()=>{let e,r,n;let t=new Date;return Object.hasOwn(u,"start")?(n=(u.end.getTime()-u.start.getTime())/2,e=new Date(u.start.getTime()-n),r=new Date(u.end.getTime()+n)):(n=j(u.pastDuration)/2,e=new Date((r=void 0===u.end?t:new Date(u.end.getTime()+n)).getTime()-4*n)),r.getTime()>t.getTime()&&(r=t,e.setTime(t.getTime()-4*n)),1>e.getTime()&&e.setTime(1),{start:e,end:r}},P=()=>{let e,r;if(Object.hasOwn(u,"start")){let n=(u.end.getTime()-u.start.getTime())/4;e=new Date(u.start.getTime()+n),r=new Date(u.end.getTime()-n)}else{let n=j(u.pastDuration)/4;e=new Date((r=void 0!==u.end?new Date(u.end.getTime()-n):new Date).getTime()-2*n)}return e.getTime()>=r.getTime()-1e3&&e.setTime(r.getTime()-1e3),{start:e,end:r}};return(0,t.jsxs)(g.Z,{direction:"row",spacing:1,children:[r&&(0,t.jsx)(i.TimeRangeSelector,{timeOptions:v,value:u,onChange:d,height:b,showCustomTimeRange:h}),f&&(0,t.jsx)(i.InfoTooltip,{description:rC.zoomOut,children:(0,t.jsx)(i.ToolbarIconButton,{"aria-label":rC.zoomOut,onClick:()=>d(C()),sx:{height:b},children:(0,t.jsx)(ry.default,{})})}),f&&(0,t.jsx)(i.InfoTooltip,{description:rC.zoomIn,children:(0,t.jsx)(i.ToolbarIconButton,{"aria-label":rC.zoomIn,onClick:()=>d(P()),sx:{height:b},children:(0,t.jsx)(rb.default,{})})}),n&&(0,t.jsx)(i.InfoTooltip,{description:rC.refresh,children:(0,t.jsx)(i.ToolbarIconButton,{"aria-label":rC.refresh,onClick:c,sx:{height:b},children:(0,t.jsx)(rv.default,{})})}),a&&(0,t.jsx)(i.InfoTooltip,{description:rC.refreshInterval,children:(0,t.jsx)(i.RefreshIntervalPicker,{timeOptions:rA,value:p,onChange:y,height:b})})]})}function rq(e,r){let n=[],t=new Set;for(let i of e){let e=i.value.matchAll(r),a="";for(let r of e)for(let e=1;e<r.length;e++){let n=r[e];void 0!==n&&(a=`${a}${n}`)}""===a||t.has(a)||(t.add(a),n.push({label:i.label,value:a}))}return n}function r$(e){let r;let{data:n}=ee("Variable",e.spec.plugin.kind),t=ey(),i=eL(),{absoluteTimeRange:a,refreshKey:o}=rE(),l=e.spec.plugin.spec,s=void 0!==e.spec.capturingRegexp?RegExp(e.spec.capturingRegexp,"g"):void 0;n?.dependsOn&&(r=n.dependsOn(l,{timeRange:a,datasourceStore:t,variables:i}).variables);let u=eL(r),d=!1;r&&(d=r.some(e=>u[e]?.loading));let c=rF(u);return(0,J.a)({queryKey:[e,c,a,o],queryFn:async()=>{let e=await n?.getVariableOptions(l,{datasourceStore:t,variables:u,timeRange:a});return void 0===e?[]:s?rq(e.data,s):e.data},enabled:!!n||d})}function rF(e){return Object.values(e).map(e=>JSON.stringify(e.value)).join(",")}let rQ=[{label:"List",kind:"ListVariable"},{label:"Text",kind:"TextVariable"}];var r_=n(70313),rN=n(84954),rU=n(315),rB=n(50898),rW=n(60993);function rK(e){let{values:r,onRefresh:n,isLoading:a,error:o}=e,[l,s]=(0,x.useState)(50),{infoSnackbar:c}=(0,i.useSnackbar)(),p=0;return r&&r?.length>0&&l&&(p=r.length-l),(0,t.jsxs)(u.Z,{children:[(0,t.jsxs)(g.Z,{direction:"row",spacing:1,alignItems:"center",mb:1,children:[(0,t.jsx)(d.Z,{variant:"h4",children:"Preview Values"}),n&&(0,t.jsx)(i.InfoTooltip,{description:rC.refreshVariableValues,children:(0,t.jsx)(ev.Z,{onClick:n,size:"small",children:(0,t.jsx)(rv.default,{})})}),(0,t.jsx)(i.InfoTooltip,{description:rC.copyVariableValues,children:(0,t.jsx)(ev.Z,{onClick:async()=>{r?.length&&(await navigator.clipboard.writeText(r.map(e=>e).join(", ")),c("Preview values copied to clipboard!"))},size:"small",children:(0,t.jsx)(rW.default,{})})})]}),(0,t.jsx)(rN.Z,{variant:"outlined",children:(0,t.jsxs)(u.Z,{sx:{display:"flex",flexWrap:"wrap",gap:1,m:2},children:[o&&(0,t.jsx)(rU.Z,{severity:"error",children:o}),r?.length===0&&(0,t.jsx)(rU.Z,{severity:"info",children:"No results"}),a&&(0,t.jsx)(g.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,t.jsx)(rB.Z,{})}),r?.slice(0,l).map((e,r)=>t.jsx(ex.Z,{size:"small",label:e},r)),p>0&&(0,t.jsx)(ex.Z,{onClick:()=>{s(void 0)},variant:"outlined",size:"small",label:`+${p} more`})]})})]})}function rG(e){let{definition:r,onRefresh:n}=e,{data:i,isFetching:a,error:o}=r$(r),l=o?.message;return(0,t.jsx)(rK,{values:i?.map(e=>e.value)||[],onRefresh:n,isLoading:a,error:l})}function rJ(){return(0,t.jsx)("div",{children:"Error previewing values"})}function rH({action:e,control:r}){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{py:1,variant:"subtitle1",children:"Text Options"}),(0,t.jsxs)(g.Z,{spacing:2,children:[(0,t.jsx)(b.Controller,{control:r,name:"spec.value",render:({field:r,fieldState:n})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Z,{children:(0,t.jsx)(rK,{values:[r.value]})}),(0,t.jsx)(p.Z,{...r,label:"Value",InputLabelProps:{shrink:"read"===e||void 0},InputProps:{readOnly:"read"===e},error:!!n.error,helperText:n.error?.message,value:r.value??"",onChange:e=>{r.onChange(e)}})]})}),(0,t.jsx)(b.Controller,{control:r,name:"spec.constant",render:({field:r})=>(0,t.jsx)(m.Z,{label:"Constant",control:(0,t.jsx)(h.Z,{...r,checked:!!r.value,readOnly:"read"===e,value:r.value??!1,onChange:n=>{"read"!==e&&r.onChange(n)}})})})]})]})}function rY({action:e,control:r}){let n=(0,b.useFormContext)(),[a,o]=(0,x.useState)(n.getValues()),l=()=>{o(n.getValues())},s=(0,b.useWatch)({control:r,name:"spec.plugin"}),c=s?.kind,v=s?.spec,y=(0,b.useWatch)({control:r,name:"spec.allowAllValue"}),j=n.getValues();return void 0===j.spec.allowAllValue&&n.setValue("spec.allowAllValue",!1),void 0===j.spec.allowMultiple&&n.setValue("spec.allowMultiple",!1),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{py:1,variant:"subtitle1",children:"List Options"}),(0,t.jsxs)(g.Z,{spacing:2,mb:2,children:[c?(0,t.jsx)(u.Z,{children:(0,t.jsx)(i.ErrorBoundary,{FallbackComponent:rJ,resetKeys:[a],children:(0,t.jsx)(rG,{definition:a,onRefresh:l})})}):(0,t.jsx)(rK,{isLoading:!0}),(0,t.jsxs)(g.Z,{children:[(0,t.jsx)(r_.d,{onClickAway:()=>l(),children:(0,t.jsx)(u.Z,{})}),(0,t.jsx)(i.ErrorBoundary,{FallbackComponent:i.ErrorAlert,children:(0,t.jsx)(b.Controller,{control:r,name:"spec.plugin",render:({field:r})=>(0,t.jsx)(ep,{width:"100%",pluginTypes:["Variable"],pluginKindLabel:"Source",value:{selection:{type:"Variable",kind:c??"StaticListVariable"},spec:v??{values:[]}},isReadonly:"read"===e,onChange:e=>{r.onChange({kind:e.selection.kind,spec:e.spec})}})})})]}),(0,t.jsx)(g.Z,{children:(0,t.jsx)(b.Controller,{control:r,name:"spec.capturingRegexp",render:({field:r,fieldState:n})=>(0,t.jsx)(p.Z,{...r,label:"Capturing Regexp Filter",InputLabelProps:{shrink:"read"===e||void 0},InputProps:{readOnly:"read"===e},error:!!n.error,value:r.value??"",onChange:e=>{""===e.target.value?r.onChange(void 0):r.onChange(e)},helperText:n.error?.message?n.error.message:"Optional, if you want to filter on captured result."})})}),(0,t.jsx)(g.Z,{children:(0,t.jsx)(b.Controller,{control:r,name:"spec.sort",render:({field:r,fieldState:n})=>(0,t.jsxs)(p.Z,{select:!0,...r,fullWidth:!0,label:"Sort",InputLabelProps:{shrink:"read"===e||void 0},InputProps:{readOnly:"read"===e},error:!!n.error,helperText:n.error?.message,value:r.value??"none",onChange:e=>{r.onChange(e)},children:[(0,t.jsx)(G.Z,{value:"none",children:"None"}),(0,t.jsx)(G.Z,{value:"alphabetical-asc",children:"Alphabetical, asc"}),(0,t.jsx)(G.Z,{value:"alphabetical-desc",children:"Alphabetical, desc"}),(0,t.jsx)(G.Z,{value:"numerical-asc",children:"Numerical, asc"}),(0,t.jsx)(G.Z,{value:"numerical-desc",children:"Numerical, desc"}),(0,t.jsx)(G.Z,{value:"alphabetical-ci-asc",children:"Alphabetical, case-insensitive, asc"}),(0,t.jsx)(G.Z,{value:"alphabetical-ci-desc",children:"Alphabetical, case-insensitive, desc"})]})})})]}),(0,t.jsx)(f.Z,{}),(0,t.jsx)(d.Z,{py:1,variant:"subtitle1",children:"Dropdown Options"}),(0,t.jsxs)(g.Z,{spacing:"2",children:[(0,t.jsxs)(g.Z,{children:[(0,t.jsx)(b.Controller,{control:r,name:"spec.allowMultiple",render:({field:r})=>(0,t.jsx)(m.Z,{label:"Allow Multiple Values",control:(0,t.jsx)(h.Z,{...r,checked:!!r.value,readOnly:"read"===e,value:r.value??!1,onChange:n=>{"read"!==e&&r.onChange(n)}})})}),(0,t.jsx)(d.Z,{variant:"caption",children:"Enables multiple values to be selected at the same time"})]}),(0,t.jsxs)(g.Z,{children:[(0,t.jsx)(b.Controller,{control:r,name:"spec.allowAllValue",render:({field:r})=>(0,t.jsx)(m.Z,{label:"Allow All option",control:(0,t.jsx)(h.Z,{...r,checked:!!r.value,readOnly:"read"===e,value:r.value??!1,onChange:n=>{"read"!==e&&r.onChange(n)}})})}),(0,t.jsx)(d.Z,{mb:1,variant:"caption",children:"Enables an option to include all variable values"}),y&&(0,t.jsx)(b.Controller,{control:r,name:"spec.customAllValue",render:({field:r,fieldState:n})=>(0,t.jsx)(p.Z,{...r,fullWidth:!0,label:"Custom All Value",InputLabelProps:{shrink:"read"===e||void 0},InputProps:{readOnly:"read"===e},error:!!n.error,helperText:n.error?.message?n.error.message:"When All is selected, this value will be used",value:r.value??"",onChange:e=>{""===e.target.value?r.onChange(void 0):r.onChange(e)}})})]})]})]})}function rX({initialVariableDefinition:e,action:r,isDraft:n,isReadonly:a,onActionChange:o,onSave:l,onClose:g,onDelete:m}){let[h,v]=(0,x.useState)(!1),y=W(r,n),j=K(r,n),{variableEditorSchema:C}=U(),P=(0,b.useForm)({resolver:(0,s.F)(C),mode:"onBlur",defaultValues:e}),k=(0,b.useWatch)({control:P.control,name:"kind"});function T(e){let r={...e};return r.spec.display?.name===void 0&&r.spec.display?.description===void 0&&r.spec.display?.hidden===void 0&&delete r.spec.display,r}return(0,t.jsxs)(b.FormProvider,{...P,children:[(0,t.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",padding:e=>e.spacing(1,2),borderBottom:e=>`1px solid ${e.palette.divider}`},children:[(0,t.jsxs)(d.Z,{variant:"h2",children:[y," Variable"]}),(0,t.jsx)(i.FormActions,{action:r,submitText:j,isReadonly:a,isValid:P.formState.isValid,onActionChange:o,onSubmit:P.handleSubmit(e=>{l(T(e))}),onDelete:m,onCancel:function(){JSON.stringify(e)!==JSON.stringify(T(P.getValues()))?v(!0):g()}})]}),(0,t.jsxs)(u.Z,{padding:2,sx:{overflowY:"scroll"},children:[(0,t.jsxs)(c.ZP,{container:!0,spacing:2,mb:2,children:[(0,t.jsx)(c.ZP,{item:!0,xs:8,children:(0,t.jsx)(b.Controller,{control:P.control,name:"spec.name",render:({field:e,fieldState:i})=>(0,t.jsx)(p.Z,{...e,required:!0,fullWidth:!0,label:"Name",InputLabelProps:{shrink:"read"===r||void 0},InputProps:{disabled:"update"===r&&!n,readOnly:"read"===r},error:!!i.error,helperText:i.error?.message,value:e.value??"",onChange:r=>{e.onChange(r)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:4,children:(0,t.jsx)(b.Controller,{control:P.control,name:"spec.display.name",render:({field:e,fieldState:n})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,label:"Display Label",InputLabelProps:{shrink:"read"===r||void 0},InputProps:{readOnly:"read"===r},error:!!n.error,helperText:n.error?.message,value:e.value??"",onChange:r=>{e.onChange(r)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:8,children:(0,t.jsx)(b.Controller,{control:P.control,name:"spec.display.description",render:({field:e,fieldState:n})=>(0,t.jsx)(p.Z,{...e,fullWidth:!0,label:"Description",InputLabelProps:{shrink:"read"===r||void 0},InputProps:{readOnly:"read"===r},error:!!n.error,helperText:n.error?.message,value:e.value??"",onChange:r=>{e.onChange(r)}})})}),(0,t.jsx)(c.ZP,{item:!0,xs:4,children:(0,t.jsx)(b.Controller,{control:P.control,name:"kind",render:({field:e,fieldState:n})=>(0,t.jsx)(p.Z,{select:!0,...e,fullWidth:!0,label:"Type",InputLabelProps:{shrink:"read"===r||void 0},InputProps:{readOnly:"read"===r},error:!!n.error,helperText:n.error?.message,value:e.value??"TextVariable",onChange:r=>{e.onChange(r)},children:rQ.map(e=>(0,t.jsx)(G.Z,{value:e.kind,children:e.label},e.kind))})})})]}),(0,t.jsx)(f.Z,{}),"TextVariable"===k&&(0,t.jsx)(i.ErrorBoundary,{FallbackComponent:i.ErrorAlert,children:(0,t.jsx)(rH,{action:r,control:P.control})}),"ListVariable"===k&&(0,t.jsx)(i.ErrorBoundary,{FallbackComponent:i.ErrorAlert,children:(0,t.jsx)(rY,{action:r,control:P.control})})]}),(0,t.jsx)(i.DiscardChangesConfirmationDialog,{description:"Are you sure you want to discard these changes? Changes cannot be recovered.",isOpen:h,onCancel:()=>{v(!1)},onDiscardChanges:()=>{v(!1),g()}})]})}var r0=n(63767);async function r1(...e){let r=await n.g.fetch(...e);if(!1===r.ok){let e=r.headers.get("content-type");if(e?.includes("application/json")){let e=await r.json();if(e.error)throw new r3(e.error,r.status);if(e.message)throw new r3(e.message,r.status)}let n=await r.text();if(n)throw new r3(n,r.status);throw new r5(r)}return r}async function r2(...e){let r=await r1(...e);return await r.json()}class r5 extends Error{status;constructor(e){super(`${e.status} ${e.statusText}`),this.status=e.status,Object.setPrototypeOf(this,r5.prototype)}}class r3 extends Error{status;constructor(e,r){super(e),this.status=r,Object.setPrototypeOf(this,r3.prototype)}}var r4=n(51564);let r7=(0,x.createContext)(void 0);function r6(){return(0,J.a)({queryKey:["projects"],queryFn:()=>r2("/api/v1/projects")})}function r8(){let e=(0,x.useContext)(r7);if(void 0===e)throw Error("No ProjectStoreContext found. Did you forget a Provider?");return e}function r9(e){let{children:r,enabledURLParams:n}=e,{project:i,setProject:a}=function(e=!0){let[r,n]=(0,r4.useQueryParams)({project:""},{updateType:"replaceIn"}),[t,i]=(0,x.useState)("none"),a=(0,x.useCallback)(e=>n({project:e}),[n]);return e?{project:r.project||"none",setProject:a}:{project:t,setProject:i}}(n),o=(0,x.useMemo)(()=>({project:{kind:"Project",metadata:{name:i}},setProject:e=>{a(e.metadata.name)}}),[i,a]);return(0,t.jsx)(r7.Provider,{value:o,children:r})}function ne(e){let{onChange:r,value:n,...i}=e,{data:a,isLoading:o}=r6(),l=o?"":n.metadata.name??"none";return(0,t.jsxs)(r0.Z,{...i,value:l,onChange:e=>{r({kind:"Project",metadata:{name:e.target.value},spec:{}})},children:[(0,t.jsx)(G.Z,{value:"none",children:(0,t.jsx)(g.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:32,children:(0,t.jsx)(ef.Z,{children:"None"})})}),a?.map(e=>[t.jsx(G.Z,{value:e.metadata.name,children:t.jsx(g.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:32,children:t.jsx(ef.Z,{children:e.metadata.name})})},e.metadata.name)])]})}let nr=({value:e,onChange:r})=>(0,t.jsx)(i.OptionsEditorControl,{label:"Metric label",description:"Specify label to display",control:(0,t.jsx)(p.Z,{fullWidth:!0,name:"Metric label",value:e||"",onChange:e=>{r(e.target.value||void 0)}})});function nn(e){let r=new Map(e.map(e=>[e.resource,e.importPlugin]));return{getInstalledPlugins:async()=>Promise.resolve(Array.from(r.keys())),importPluginModule(e){let n=r.get(e);if(void 0===n)throw Error("Plugin not found");return n()}}}function nt(e){return!e||"string"==typeof e&&(0,rj.fs)(e)?e:(1e3*(0,rP.getUnixTime)(e)).toString()}function ni(e){let r=function(e,r){if(!e||0===e.length)return null;let n=e instanceof Array?e[0]:e;return null==n?n:""!==n?n:null}(e);return r?(0,rj.fs)(r)?r:new Date(Number(r)):null}let na={encode:nt,decode:ni,equals:(e,r)=>e===r||(e&&r?e.valueOf()===r.valueOf():e===r)},no={start:na,end:na},nl={refresh:na};function ns(e){let[r]=(0,r4.useQueryParams)(no,{updateType:"replaceIn"}),{start:n,end:t}=r;return(0,x.useMemo)(()=>{let r={pastDuration:e};if(!n)return r;let i=n.toString();return(0,rj.fs)(i)?r={pastDuration:i}:(0,rP.isDate)(n)&&(0,rP.isDate)(t)&&(r={start:n,end:t}),r},[n,t,e])}function nu(e){let[r,n]=(0,r4.useQueryParams)(no,{updateType:"replaceIn"}),[t,i]=(0,x.useState)(!1),{start:a}=r;return(0,x.useEffect)(()=>{!t&&!a&&(0,rj.s3)(e)&&(n({start:e.pastDuration,end:void 0}),i(!0))},[e,t,a,n]),{timeRange:e,setTimeRange:(0,x.useCallback)(e=>{(0,rj.s3)(e)?n({start:e.pastDuration,end:void 0}):n(e)},[n])}}function nd(e){let[r]=(0,r4.useQueryParams)(nl,{updateType:"replaceIn"}),{refresh:n}=r;return(0,x.useMemo)(()=>{let r=e;if(!n)return r;let t=n.toString();return(0,rj.fs)(t)&&(r=t),r},[e,n])}function nc(e){let[r,n]=(0,r4.useQueryParams)(nl,{updateType:"replaceIn"}),[t,i]=(0,x.useState)(!1),{refresh:a}=r;return(0,x.useEffect)(()=>{t||a||(n({refresh:e}),i(!0))},[e,t,a,n]),{refreshInterval:e,setRefreshInterval:(0,x.useCallback)(e=>n({refresh:e}),[n])}}function np(e){let{initialTimeRange:r,initialRefreshInterval:n,children:i}=e,{timeRange:a,setTimeRange:o}=nu(r),{refreshInterval:l,setRefreshInterval:s}=nc(n);return(0,t.jsx)(rS,{timeRange:a,refreshInterval:l,setTimeRange:o,setRefreshInterval:s,children:i})}var ng=n(39517);function nm(e,r){return r?Object.fromEntries(Object.entries(e).filter(([e])=>r.includes(e))):e}function nh(e){return Object.values(e).map(e=>JSON.stringify(e.value)).join(",")}let nf="TimeSeriesQuery";function nx({plugin:e,definition:r,context:n}){let{timeRange:t,datasourceStore:i,suggestedStepMs:a,mode:o,variableState:l,refreshKey:s}=n,u=e?.dependsOn?e.dependsOn(r.spec.plugin.spec,n):{},d=u?.variables,c=[r,t,i,a,o,nh(nm(l,d)),s],p=!1;return d&&(p=d.some(e=>l[e]?.loading)),{queryKey:c,queryEnabled:void 0!==e&&!p}}let nv=(e,r,n)=>{let{data:t}=ee(nf,e.spec.plugin.kind),i=ny(),{queryEnabled:a,queryKey:o}=nx({plugin:t,definition:e,context:i});return(0,J.a)({enabled:(n?.enabled??!0)||a,queryKey:o,queryFn:()=>{if(void 0===t)throw Error("Expected plugin to be loaded");let n={...i,suggestedStepMs:r?.suggestedStepMs};return t.getTimeSeriesData(e.spec.plugin.spec,n)}})};function nb(e,r,n){let{getPlugin:t}=X(),i={...ny(),mode:r?.mode},a=er(nf,e.map(e=>({kind:e.spec.plugin.kind})));return(0,H.h)({queries:e.map((e,o)=>{let{queryEnabled:l,queryKey:s}=nx({plugin:a[o]?.data,definition:e,context:i});return{...n,enabled:(n?.enabled??!0)&&l,queryKey:s,queryFn:async()=>{let n={...i,suggestedStepMs:r?.suggestedStepMs},a=await t(nf,e.spec.plugin.kind);return await a.getTimeSeriesData(e.spec.plugin.spec,n)}}})})}function ny(){let{absoluteTimeRange:e,refreshKey:r}=rE();return{timeRange:e,variableState:eL(),datasourceStore:ey(),refreshKey:r}}function nj(){return nC((0,ng.NL)().getQueryCache())}function nC(e){let r=[];for(let n of e.findAll({type:"active"})){let e=n.queryKey?.[0];e?.kind&&e.kind.startsWith(nf)&&r.push(n)}return r}let nP="TraceQuery";function nk(e){let{start:r,end:n}=e;return{start:Math.ceil((0,rP.getUnixTime)(r)),end:Math.ceil((0,rP.getUnixTime)(n))}}function nT(e){let{getPlugin:r}=X(),n=function(){let{absoluteTimeRange:e}=rE();return{variableState:eL(),datasourceStore:ey(),absoluteTimeRange:e}}(),t=er("TraceQuery",e.map(e=>({kind:e.spec.plugin.kind})));return(0,H.h)({queries:e.map((e,i)=>{let{queryEnabled:a,queryKey:o}=function({plugin:e,definition:r,context:n}){let{datasourceStore:t,variableState:i,absoluteTimeRange:a}=n,o=e?.dependsOn?e.dependsOn(r.spec.plugin.spec,n):{},l=o?.variables,s=[r,t,a,nh(nm(i,l))],u=!1;return l&&(u=l.some(e=>i[e]?.loading)),{queryKey:s,queryEnabled:void 0!==e&&!u}}({context:n,definition:e,plugin:t[i]?.data}),l=e?.spec?.plugin?.kind;return{enabled:a,queryKey:o,queryFn:async()=>{let t=await r(nP,l);return await t.getTraceData(e.spec.plugin.spec,n)}}})})}let nE="ProfileQuery";function nw(e){let{getPlugin:r}=X(),n=ey(),{absoluteTimeRange:t}=rE(),i={datasourceStore:n,absoluteTimeRange:t};return(0,H.h)({queries:e.map(e=>{let a=[e,n,t],o=e?.spec?.plugin?.kind;return{queryKey:a,queryFn:async()=>{let n=await r(nE,o);return await n.getProfileData(e.spec.plugin.spec,i)},structuralSharing:!1}})})}let nS=(0,x.createContext)(void 0),nZ=()=>(0,x.useContext)(nS),nV=()=>{let e=nZ();return{markQuery:(r,n)=>{if(void 0===e)return;let t=JSON.stringify(r);if((!e.pendingQueries.has(t)||"pending"!==n)&&e.pendingQueries.get(t)!==n){e.pendingQueries.set(t,n),"error"===n&&(e.renderErrorCount+=1);let r=[...e.pendingQueries.values()].every(e=>"pending"!==e);0===e.renderDurationMs&&r&&(e.renderDurationMs=Date.now()-e.startRenderTime,nO(e))}}}},nO=async e=>{await r1("/api/v1/view",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project:e.project,dashboard:e.dashboard,render_time:e.renderDurationMs/1e3,render_errors:e.renderErrorCount})})},nz=({project:e,dashboard:r,children:n})=>{let i={project:e,dashboard:r,renderErrorCount:0,startRenderTime:Date.now(),renderDurationMs:0,pendingQueries:new Map};return(0,t.jsx)(nS.Provider,{value:i,children:n})};function nI(e,r){return e.map(({data:e,isFetching:n,isLoading:t,refetch:i,error:a},o)=>({definition:r[o],data:e,isFetching:n,isLoading:t,refetch:i,error:a}))}function nD(){let{data:e,isLoading:r}=en(["TimeSeriesQuery"]),{data:n,isLoading:t}=en(["TraceQuery"]),{data:i,isLoading:a}=en(["ProfileQuery"]),o=(0,x.useMemo)(()=>{let r={TimeSeriesQuery:[],TraceQuery:[],ProfileQuery:[]};return e&&e.forEach(e=>{r[e.kind]?.push(e.spec.name)}),n&&n.forEach(e=>{r[e.kind]?.push(e.spec.name)}),i&&i.forEach(e=>{r[e.kind]?.push(e.spec.name)}),r},[e,n,i]);return(0,x.useCallback)(e=>{if(!(e=>{switch(e){case"PrometheusTimeSeriesQuery":return r;case"TempoTraceQuery":return t;case"PyroscopeProfileQuery":return a}return t||r||a})(e)){for(let r in o)if(o[r]?.includes(e))return r;throw Error(`Unable to determine the query type: ${e}`)}},[o,r,t,a])}let nL=(0,x.createContext)(void 0);function nR(){let e=(0,x.useContext)(nL);if(void 0===e)throw Error("No DataQueriesContext found. Did you forget a Provider?");return e}function nA(e){let r=nR(),n=r.queryResults.filter(r=>r?.definition?.kind===e),t=r.errors.filter((n,t)=>r.queryResults[t]?.definition?.kind===e);return{queryResults:n,isFetching:n.some(e=>e.isFetching),isLoading:n.some(e=>e.isLoading),refetchAll:r.refetchAll,errors:t}}function nM(e){let{definitions:r,options:n,children:i,queryOptions:a}=e,o=nD(),l=r.map(e=>({kind:o(e.kind),spec:{plugin:e}})),s=nV(),u=l.filter(e=>"TimeSeriesQuery"===e.kind),d=nb(u,n,a),c=l.filter(e=>"TraceQuery"===e.kind),p=nT(c),g=l.filter(e=>"ProfileQuery"===e.kind),m=nw(g),h=(0,x.useCallback)(()=>{d.forEach(e=>e.refetch()),p.forEach(e=>e.refetch()),m.forEach(e=>e.refetch())},[d,p,m]),f=(0,x.useMemo)(()=>{let e=[...nI(d,u),...nI(p,c),...nI(m,g)];if(a?.enabled)for(let r of e)r.isLoading||r.isFetching||r.error?r.error?s.markQuery(r.definition,"error"):s.markQuery(r.definition,"pending"):s.markQuery(r.definition,"success");return{queryResults:e,isFetching:e.some(e=>e.isFetching),isLoading:e.some(e=>e.isLoading),refetchAll:h,errors:e.map(e=>e.error)}},[u,d,c,p,g,m,h,a?.enabled,s]);return(0,t.jsx)(nL.Provider,{value:f,children:i})}function nq(...e){let r={kind:"PluginModule",metadata:{name:"Fake Plugin Module for Tests",version:"0"},spec:{plugins:e.map(({kind:e,spec:{name:r}})=>({kind:e,spec:{name:r,display:{name:n$(e,r)}}}))}},n={};for(let r of e)n[r.spec.name]=r.plugin;return{pluginLoader:{getInstalledPlugins:()=>Promise.resolve([r]),importPluginModule:()=>Promise.resolve(n)},defaultPluginKinds:{TimeSeriesQuery:"PrometheusTimeSeriesQuery"}}}function n$(e,r){return`${e} Plugin for ${r}`}var nF=n(56119),nQ=n(72570),n_=n(6085),nN=n.n(n_),nU=n(65895);let nB=null,nW=()=>(null===nB&&(nB=(0,nF.init)({name:"@perses/perses-ui-host",remotes:[],shared:{react:{version:v().version,lib:()=>v(),shareConfig:{singleton:!0,requiredVersion:`^${v().version}`}},"react-dom":{version:"18.3.1",lib:()=>nN(),shareConfig:{singleton:!0,requiredVersion:"^18.3.1"}},"react-router-dom":{version:"6.26.0",lib:()=>nU,shareConfig:{singleton:!0,requiredVersion:"^6.26.0"}},"@tanstack/react-query":{version:"5.64.2",lib:()=>nQ,shareConfig:{singleton:!0,requiredVersion:"^5.64.2"}},"react-hook-form":{version:"7.52.2",lib:()=>b,shareConfig:{singleton:!0,requiredVersion:"^7.52.2"}},echarts:{version:"5.5.0",lib:()=>n(76242),shareConfig:{singleton:!0,requiredVersion:"^5.5.0"}},"@perses-dev/components":{version:"0.51.0-beta.0",lib:()=>n(36765),shareConfig:{singleton:!0,requiredVersion:"^0.51.0-beta.0"}},"@perses-dev/plugin-system":{version:"0.51.0-beta.0",lib:()=>n(88355),shareConfig:{singleton:!0,requiredVersion:"^0.51.0-beta.0"}},"@perses-dev/explore":{version:"0.51.0-beta.0",lib:()=>n(73223),shareConfig:{singleton:!0,requiredVersion:"^0.51.0-beta.0"}},"@perses-dev/dashboards":{version:"0.51.0-beta.0",lib:()=>n(24407),shareConfig:{singleton:!0,requiredVersion:"^0.51.0-beta.0"}},"date-fns":{version:"4.1.0",lib:()=>n(20461),shareConfig:{singleton:!0,requiredVersion:"^4.1.0"}},"date-fns-tz":{version:"3.2.0",lib:()=>n(4665),shareConfig:{singleton:!0,requiredVersion:"^3.2.0"}},lodash:{version:"4.17.21",lib:()=>n(93098),shareConfig:{singleton:!0,requiredVersion:"^4.17.21"}},"@emotion/react":{version:"11.11.3",lib:()=>n(72116),shareConfig:{singleton:!0,requiredVersion:"^11.11.3"}},"@emotion/styled":{version:"11.11.0",lib:()=>n(31373),shareConfig:{singleton:!0,requiredVersion:"^11.11.0"}},"@hookform/resolvers/zod":{version:"3.3.4",lib:()=>n(22538),shareConfig:{singleton:!0,requiredVersion:"^3.3.4"}},"use-resize-observer":{version:"9.1.0",lib:()=>n(75276),shareConfig:{singleton:!0,requiredVersion:"^9.1.0"}},"mdi-material-ui":{version:"7.4.0",lib:()=>n(61157),shareConfig:{singleton:!0,requiredVersion:"^7.4.0"}},immer:{version:"10.1.1",lib:()=>n(86373),shareConfig:{singleton:!0,requiredVersion:"^10.1.1"}}}})),nB),nK=(e,r)=>{let n=nW();if(!n.options.remotes.find(r=>r.name===e)){let t=r?`${r}/${e}/mf-manifest.json`:`/plugins/${e}/mf-manifest.json`;n.registerRemotes([{name:e,entry:t,alias:e}])}},nG=async(e,r,n)=>(nK(e,n),(0,nF.loadRemote)(`${e}/${r}`));function nJ({pluginFn:e,props:r}){return e(r)}function nH({plugin:e,props:r,field:n}){let{loadPlugin:i}=function({plugin:e}){return{pluginRuntime:nW(),loadPlugin:()=>nG(e.moduleName,e.name,e.baseURL)}}({plugin:e}),[a,o]=(0,x.useState)(null),[l,s]=(0,x.useState)(null),u=`${e.moduleName}-${e.name}`,d=(0,x.useRef)(u);if((0,x.useEffect)(()=>{d.current=u,s(null),i().then(e=>{o(e)}).catch(r=>{o(null),console.error(`PluginLoaderComponent: Error loading plugin ${e.name} from module ${e.moduleName}:`,r),s(Error(`PluginLoaderComponent: Error loading plugin ${e.name} from module ${e.moduleName}`))})},[u]),l)throw l;if(!a)return null;let c=a[e.name];if(n&&c&&"object"==typeof c&&n in c&&(c=c[n]),!c)throw Error(`PluginLoaderComponent: Plugin module ${e.moduleName} does not have a ${e.name} export`);if("function"!=typeof c)throw Error(`PluginLoaderComponent: Plugin ${e.name} export is not a function`);return d.current!==u?null:(0,t.jsx)(nJ,{pluginFn:c,props:r},u)}let nY=e=>"object"==typeof e&&null!==e&&"kind"in e&&"spec"in e&&"object"==typeof e.spec&&null!==e.spec&&"name"in e.spec,nX=e=>"object"==typeof e&&null!==e&&"metadata"in e&&"spec"in e&&"object"==typeof e.spec&&null!==e.spec&&"plugins"in e.spec&&Array.isArray(e.spec.plugins)&&e.spec.plugins.every(nY),n0=e=>({getInstalledPlugins:async()=>{let r=await fetch(`${e||""}/api/v1/plugins`),n=await r.json(),t=[];return Array.isArray(n)?t=n.filter(nX):console.error("RemotePluginLoader: Error loading plugins, response is not an array"),t.length||console.error("RemotePluginLoader: No valid plugins found"),t},importPluginModule:async e=>{let r=e.metadata.name,n={};for(let t of e.spec.plugins){let e=await nG(r,t.spec.name),i=e?.[t.spec.name];i?n[t.spec.name]=i:console.error(`RemotePluginLoader: Error loading plugin ${t.spec.name}`)}return n}})}}]);