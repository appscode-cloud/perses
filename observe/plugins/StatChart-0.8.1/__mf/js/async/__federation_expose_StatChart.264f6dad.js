"use strict";(self.webpackChunkStatChart=self.webpackChunkStatChart||[]).push([["29"],{14046:function(e,t,n){n.d(t,{K2:()=>l,c7:()=>r,gO:()=>i});let l="last",r={first:function(e){return a(e,"first")},last:function(e){return a(e,"last")},"first-number":function(e){return a(e,"first-number")},"last-number":function(e){return a(e,"last-number")},mean:function(e){return a(e,"mean")},sum:function(e){return a(e,"sum")},min:function(e){return a(e,"min")},max:function(e){return a(e,"max")}},i={first:{label:"First",description:"First value"},last:{label:"Last",description:"Last value"},"first-number":{label:"First *",description:"First numeric value"},"last-number":{label:"Last *",description:"Last numeric value"},mean:{label:"Avg",description:"Average value excluding nulls"},sum:{label:"Sum",description:"The sum of all values"},min:{label:"Min",description:"Minimum value"},max:{label:"Max",description:"Maximum value"}};function a(e,t){return function(e,t){let n=t.reduce((e,t)=>(e[t]=void 0,e),{}),l=0,r=0;return e.forEach((t,i)=>{let a=t[1];0===i&&"first"in n&&(n.first=a),i===e.length-1&&"last"in n&&(n.last=a),"number"==typeof a&&(l+=1,r+=a,"first-number"in n&&void 0===n["first-number"]&&(n["first-number"]=a),"last-number"in n&&(n["last-number"]=a),"min"in n&&("number"!=typeof n.min?n.min=a:n.min=Math.min(n.min,a)),"max"in n&&("number"!=typeof n.max?n.max=a:n.max=Math.max(n.max,a)))}),l>0&&"sum"in n&&(n.sum=r),l>0&&"mean"in n&&(n.mean=r/l),n}(e,[t])[t]}},61033:function(e,t,n){let l;n.r(t),n.d(t,{StatChart:()=>I});var r=n(24246),i=n(72629),a=n(87895),o=n(58891),u=n(75586),s=n(15409),c=n.n(s);let d={unit:"percent-decimal"};var h=n(25283),m=n(52054),f=n(54538);function p(e){if(!e)throw Error("Input string cannot be empty");if(!e?.startsWith("/"))return RegExp(`^${e}$`);let t=e.match(/^\/(.+)\/([gimy]*)$/);if(!t)throw Error(`Invalid regular expression format: ${e}`);let[,n="",l=""]=t;try{return new RegExp(n,l)}catch(e){throw Error(`Failed to create RegExp ${e}`)}}function v(e,t=[]){if(!t.length)return{value:e};let n={value:e};return t.forEach(t=>{switch(t.kind){case"Value":{let l=t.spec;String(l.value)===String(e)&&(n.value=l.result.value||n.value,n.color=l.result.color);break}case"Range":{let l=t.spec;if(void 0===l.from&&void 0===l.to)break;let r=void 0!==l.from?l.from:-1/0,i=void 0!==l.to?l.to:1/0;e>=r&&e<=i&&(n.value=l.result.value||n.value,n.color=l.result.color);break}case"Regex":{let l=t.spec,r=e.toString();if(!l.pattern)break;let i=p(l.pattern);r.match(i)&&null!==l.result.value&&(n.value=r.replace(i,l.result.value.toString()||"")||n.value,n.color=l.result.color);break}case"Misc":{let l=t.spec;(function(e,t){switch(e){case"empty":return""===t;case"null":return null==t;case"NaN":return Number.isNaN(t);case"true":return!0===t;case"false":return!1===t;default:return!1}})(l.value,e)&&(n.value=l.result.value||n.value,n.color=l.result.color)}}}),n}var g=n(14046);let x=(e,t)=>(void 0===g.c7[e]&&console.warn(`Invalid StatChart panel calculation ${e}, fallback to ${g.K2}`),(g.c7[e]??g.c7[g.K2])(t.values));var b=n(36372),w=n(12709),y=n(36232),S=n(44811),C=n(65201),j=n(99635),k=n(23709),E=n(67745),M=n(50378);function $(e){let{text:t,fontWeight:n,width:r,height:a,lineHeight:o,maxSize:u,fontSizeOverride:s}=e,c=function(){if(!l&&null===(l=document.createElement("canvas").getContext("2d")))throw Error("Canvas context is null.");return l}(),{echartsTheme:d}=(0,i.useChartsTheme)();if(void 0!==s)return Number(s);let h=d.textStyle,m=Number(null==h?void 0:h.fontSize)??12,f=(null==h?void 0:h.fontFamily)??"Lato",p=`${n} ${m}px ${f}`;c.font=p;let v=Math.min(a/o,r/c.measureText(t).width*m);return u?Math.min(v,u):v}var N=n(74664);let z=(e,t)=>null===e?"null":"number"==typeof e?(0,N.Bw)(e,t):void 0===e?"":e;(0,y.D)([S.N,C.N,j.N,k.N,E.N,M.N]);let F=e=>{var t,n;let{width:l,height:a,data:o,sparkline:u,showSeriesName:s,format:d,valueFontSize:h}=e,m=(0,i.useChartsTheme)(),p=o.color,v=z(o.calculatedValue,d),g=m.container.padding.default,x=$({text:(null==o?void 0:null===(t=o.seriesData)||void 0===t?void 0:t.name)??"",fontWeight:400,width:l,height:.125*a,lineHeight:1.2,maxSize:30}),w=s?1.2*x+g:0,y=l-2*g,S=a-w,C=$({text:v,fontSizeOverride:h,fontWeight:700,width:u?y:.5*y,height:u?.25*S:.9*S,lineHeight:1.2}),j=1.2*C;x=Math.min(.7*C,x);let k=(0,f.useMemo)(()=>{if(void 0===o.seriesData)return m.noDataOption;let e=o.seriesData,t=[];if(void 0!==u){let n={type:"line",name:e.name,data:e.values,zlevel:1,symbol:"none",animation:!1,silent:!0},l=c()(n,u);t.push(l)}return{title:{show:!1},grid:{show:!1,top:"35%",right:0,bottom:0,left:0,containLabel:!1},xAxis:{type:"time",show:!1,boundaryGap:!1},yAxis:{type:"value",show:!1,min:e=>e.min>=0&&e.min<=1?0:e.min},tooltip:{show:!1},series:t}},[o,m,u]),E=u?"auto":"center";return(0,r.jsxs)(b.Z,{sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column",justifyContent:E,alignItems:E},children:[s&&(0,r.jsx)(O,{padding:g,fontSize:x,children:null===(n=o.seriesData)||void 0===n?void 0:n.name}),(0,r.jsx)(D,{variant:"h3",color:p,fontSize:C,padding:g,children:v}),void 0!==u&&(0,r.jsx)(i.EChart,{sx:{width:"100%"},style:{height:Math.floor(a-w-j)},option:k,theme:m.echartsTheme,renderer:"svg"})]})},O=(0,w.ZP)(m.Z,{shouldForwardProp:e=>"padding"!==e&&"fontSize"!==e})(e=>{let{theme:t,padding:n,fontSize:l}=e;return{color:t.palette.text.secondary,padding:`${n}px`,fontSize:`${l}px`,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}),D=(0,w.ZP)(m.Z,{shouldForwardProp:e=>"color"!==e&&"padding"!==e&&"fontSize"!==e&&"sparkline"!==e})(e=>{let{theme:t,color:n,padding:l,fontSize:r,sparkline:i}=e;return{color:n??t.palette.text.primary,fontSize:`${r}px`,padding:i?`${l}px ${l}px 0 ${l}px`:` 0 ${l}px`,whiteSpace:"nowrap",lineHeight:1.2}}),L=(e,t,n)=>(0,f.useMemo)(()=>{let{calculation:l,mappings:r,metricLabel:i}=t,a=[];for(let o of e)for(let e of o.data.series){let o=x(l,e),u=T(o,r,Z(i,e.labels)),s=function(e,t,n){let{mappings:l,thresholds:r}=t??{},i=(null==r?void 0:r.defaultColor)??e.thresholds.defaultColor;if(null==n||""===n||!(null==r?void 0:r.steps)&&!l)return i;if(null==l?void 0:l.length){let e=function(e,t){if((null==t?void 0:t.length)&&null!=e){let{color:n}=v(e,t);return n||null}return null}(n,l);if(e)return e}if(r){let t=function(e,t,n,l){if((null==t?void 0:t.steps)&&"number"==typeof e){let r=t.steps.map((t,r)=>e>=t.value?t.color??n.thresholds.palette[r]??l:null).filter(e=>null!==e);return r[r.length-1]??null}return null}(n,r,e,i);if(t)return t}return i}(n,t,o),c={name:e.formattedName??"",values:e.values};a.push({calculatedValue:u,seriesData:c,color:s})}return a},[e,t,n]),T=(e,t,n)=>n||((null==t?void 0:t.length)&&null!=e?v(e,t).value:e),Z=(e,t)=>{if(t&&e){for(let[n,l]of Object.entries(t))if(p(e).test(n))return l}},I={PanelComponent:e=>{let{spec:t,contentDimensions:n,queryResults:l}=e,{format:a,sparkline:o,valueFontSize:u}=t,s=(0,i.useChartsTheme)(),c=L(l,t,s),d=c.length>1;if(void 0===n)return null;let f=2*(c.length-1),p=(n.width-f)/c.length;d&&p<100&&(p=100);let v=s.noDataOption.title.textStyle;return(0,r.jsx)(h.Z,{height:n.height,width:n.width,spacing:"2px",direction:"row",justifyContent:d?"left":"center",alignItems:"center",sx:{overflowX:d?"scroll":"auto"},children:c.length?c.map((e,t)=>{let l=function(e,t,n){if(void 0!==n)return{lineStyle:{width:n.width??e.sparkline.width,color:t,opacity:1},areaStyle:{color:t,opacity:.4}}}(s,e.color,o);return(0,r.jsx)(F,{width:p,height:n.height,data:e,format:a,sparkline:l,showSeriesName:d,valueFontSize:u},t)}):(0,r.jsx)(m.Z,{sx:{...v},children:"No data"})})},supportedQueryTypes:["TimeSeriesQuery"],panelOptionsEditorComponents:[{label:"Settings",content:function(e){let{onChange:t,value:n}=e,l=c()({},d,n.format);return(0,r.jsxs)(i.OptionsEditorGrid,{children:[(0,r.jsx)(i.OptionsEditorColumn,{children:(0,r.jsxs)(i.OptionsEditorGroup,{title:"Misc",children:[(0,r.jsx)(i.OptionsEditorControl,{label:"Sparkline",control:(0,r.jsx)(a.Z,{checked:!!n.sparkline,onChange:(e,l)=>{t((0,u.Uy)(n,e=>{e.sparkline=l?{}:void 0}))}})}),(0,r.jsx)(i.FormatControls,{value:l,onChange:e=>{t((0,u.Uy)(n,t=>{t.format=e}))}}),(0,r.jsx)(o.CalculationSelector,{value:n.calculation,onChange:e=>{t((0,u.Uy)(n,t=>{t.calculation=e}))}}),(0,r.jsx)(o.MetricLabelInput,{value:n.metricLabel,onChange:e=>{t((0,u.Uy)(n,t=>{t.metricLabel=e}))}}),(0,r.jsx)(i.FontSizeSelector,{value:n.valueFontSize,onChange:e=>{t((0,u.Uy)(n,t=>{t.valueFontSize=e}))}})]})}),(0,r.jsx)(i.OptionsEditorColumn,{children:(0,r.jsx)(i.ThresholdsEditor,{disablePercentMode:!0,thresholds:n.thresholds,onChange:e=>{t((0,u.Uy)(n,t=>{t.thresholds=e}))}})})]})}},{label:"Value mapping",content:e=>{let{onChange:t,value:n}=e;return(0,r.jsx)(i.ValueMappingsEditor,{mappings:n.mappings??[],onChange:function(e){t({...n,mappings:e})}})}}],createInitialOptions:function(){return{calculation:"last-number",format:{unit:"decimal"},sparkline:{}}}}}}]);