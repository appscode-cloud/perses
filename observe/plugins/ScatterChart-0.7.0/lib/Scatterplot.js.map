{"version":3,"sources":["../../src/Scatterplot.tsx"],"sourcesContent":["// Copyright 2023 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { ReactElement, useMemo } from 'react';\nimport { EChart, OnEventsType, useChartsTheme } from '@perses-dev/components';\nimport { use, EChartsCoreOption } from 'echarts/core';\nimport { ScatterChart as EChartsScatterChart } from 'echarts/charts';\nimport {\n  DatasetComponent,\n  DataZoomComponent,\n  LegendComponent,\n  GridComponent,\n  TitleComponent,\n  TooltipComponent,\n} from 'echarts/components';\nimport { CanvasRenderer } from 'echarts/renderers';\nimport { EChartsOption, ScatterSeriesOption } from 'echarts';\nimport { formatValue } from '@perses-dev/core';\nimport { EChartTraceValue } from './ScatterChartPanel';\n\nuse([\n  DatasetComponent,\n  DataZoomComponent,\n  LegendComponent,\n  EChartsScatterChart,\n  GridComponent,\n  TitleComponent,\n  TooltipComponent,\n  CanvasRenderer,\n]);\n\ninterface ScatterplotProps<T> {\n  width: number;\n  height: number;\n  options: EChartsOption;\n  onClick?: (data: T) => void;\n}\n\nconst DATE_FORMATTER = new Intl.DateTimeFormat(undefined, {\n  dateStyle: 'long',\n  timeStyle: 'medium',\n}).format;\n\nexport function Scatterplot<T>(props: ScatterplotProps<T>): ReactElement {\n  const { width, height, options, onClick } = props;\n  const chartsTheme = useChartsTheme();\n\n  // Apache EChart Options Docs: https://echarts.apache.org/en/option.html\n  const eChartOptions: EChartsCoreOption = {\n    dataset: options.dataset,\n    series: options.series,\n    dataZoom: options.dataZoom,\n    grid: {\n      bottom: 40,\n      top: 50,\n      left: 50,\n      right: 100,\n    },\n    xAxis: {\n      type: 'time',\n      name: 'Local Time',\n    },\n    yAxis: {\n      scale: true,\n      type: 'value',\n      name: 'Duration',\n      axisLabel: {\n        formatter: (durationMs: number) => formatValue(durationMs, { unit: 'milliseconds' }),\n      },\n    },\n    animation: false,\n    tooltip: {\n      padding: 5,\n      borderWidth: 1,\n      trigger: 'axis',\n      axisPointer: {\n        type: 'cross',\n      },\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      formatter: function (params: any) {\n        // TODO: import type from ECharts instead of using any\n        const data = params[0].data as EChartTraceValue;\n        return [\n          `<b>Service name</b>: ${data.rootServiceName}<br/>`,\n          `<b>Span name</b>: ${data.rootTraceName}<br/>`,\n          `<b>Time</b>: ${DATE_FORMATTER(data.startTime)}<br/>`,\n          `<b>Duration</b>: ${formatValue(data.durationMs, { unit: 'milliseconds' })}<br/>`,\n          `<b>Span count</b>: ${data.spanCount} (${data.errorCount} errors)<br/>`,\n        ].join('');\n      },\n    },\n    legend: {\n      show: true,\n      type: 'scroll',\n      orient: 'horizontal',\n      bottom: 0,\n    },\n  };\n\n  const handleEvents: OnEventsType<ScatterSeriesOption['data'] | unknown> = useMemo(() => {\n    const handlers: OnEventsType<ScatterSeriesOption['data'] | unknown> = {};\n    if (onClick) {\n      handlers.click = (params): void => onClick(params.data as T);\n    }\n    return handlers;\n  }, [onClick]);\n\n  return (\n    <EChart\n      sx={{\n        width: width,\n        height: height,\n      }}\n      option={eChartOptions}\n      theme={chartsTheme.echartsTheme}\n      onEvents={handleEvents}\n    />\n  );\n}\n"],"names":["useMemo","EChart","useChartsTheme","use","ScatterChart","EChartsScatterChart","DatasetComponent","DataZoomComponent","LegendComponent","GridComponent","TitleComponent","TooltipComponent","CanvasRenderer","formatValue","DATE_FORMATTER","Intl","DateTimeFormat","undefined","dateStyle","timeStyle","format","Scatterplot","props","width","height","options","onClick","chartsTheme","eChartOptions","dataset","series","dataZoom","grid","bottom","top","left","right","xAxis","type","name","yAxis","scale","axisLabel","formatter","durationMs","unit","animation","tooltip","padding","borderWidth","trigger","axisPointer","params","data","rootServiceName","rootTraceName","startTime","spanCount","errorCount","join","legend","show","orient","handleEvents","handlers","click","sx","option","theme","echartsTheme","onEvents"],"mappings":"AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;AAEjC,SAAuBA,OAAO,QAAQ,QAAQ;AAC9C,SAASC,MAAM,EAAgBC,cAAc,QAAQ,yBAAyB;AAC9E,SAASC,GAAG,QAA2B,eAAe;AACtD,SAASC,gBAAgBC,mBAAmB,QAAQ,iBAAiB;AACrE,SACEC,gBAAgB,EAChBC,iBAAiB,EACjBC,eAAe,EACfC,aAAa,EACbC,cAAc,EACdC,gBAAgB,QACX,qBAAqB;AAC5B,SAASC,cAAc,QAAQ,oBAAoB;AAEnD,SAASC,WAAW,QAAQ,mBAAmB;AAG/CV,IAAI;IACFG;IACAC;IACAC;IACAH;IACAI;IACAC;IACAC;IACAC;CACD;AASD,MAAME,iBAAiB,IAAIC,KAAKC,cAAc,CAACC,WAAW;IACxDC,WAAW;IACXC,WAAW;AACb,GAAGC,MAAM;AAET,OAAO,SAASC,YAAeC,KAA0B;IACvD,MAAM,EAAEC,KAAK,EAAEC,MAAM,EAAEC,OAAO,EAAEC,OAAO,EAAE,GAAGJ;IAC5C,MAAMK,cAAczB;IAEpB,wEAAwE;IACxE,MAAM0B,gBAAmC;QACvCC,SAASJ,QAAQI,OAAO;QACxBC,QAAQL,QAAQK,MAAM;QACtBC,UAAUN,QAAQM,QAAQ;QAC1BC,MAAM;YACJC,QAAQ;YACRC,KAAK;YACLC,MAAM;YACNC,OAAO;QACT;QACAC,OAAO;YACLC,MAAM;YACNC,MAAM;QACR;QACAC,OAAO;YACLC,OAAO;YACPH,MAAM;YACNC,MAAM;YACNG,WAAW;gBACTC,WAAW,CAACC,aAAuB/B,YAAY+B,YAAY;wBAAEC,MAAM;oBAAe;YACpF;QACF;QACAC,WAAW;QACXC,SAAS;YACPC,SAAS;YACTC,aAAa;YACbC,SAAS;YACTC,aAAa;gBACXb,MAAM;YACR;YACA,8DAA8D;YAC9DK,WAAW,SAAUS,MAAW;gBAC9B,sDAAsD;gBACtD,MAAMC,OAAOD,MAAM,CAAC,EAAE,CAACC,IAAI;gBAC3B,OAAO;oBACL,CAAC,qBAAqB,EAAEA,KAAKC,eAAe,CAAC,KAAK,CAAC;oBACnD,CAAC,kBAAkB,EAAED,KAAKE,aAAa,CAAC,KAAK,CAAC;oBAC9C,CAAC,aAAa,EAAEzC,eAAeuC,KAAKG,SAAS,EAAE,KAAK,CAAC;oBACrD,CAAC,iBAAiB,EAAE3C,YAAYwC,KAAKT,UAAU,EAAE;wBAAEC,MAAM;oBAAe,GAAG,KAAK,CAAC;oBACjF,CAAC,mBAAmB,EAAEQ,KAAKI,SAAS,CAAC,EAAE,EAAEJ,KAAKK,UAAU,CAAC,aAAa,CAAC;iBACxE,CAACC,IAAI,CAAC;YACT;QACF;QACAC,QAAQ;YACNC,MAAM;YACNvB,MAAM;YACNwB,QAAQ;YACR7B,QAAQ;QACV;IACF;IAEA,MAAM8B,eAAoE/D,QAAQ;QAChF,MAAMgE,WAAgE,CAAC;QACvE,IAAItC,SAAS;YACXsC,SAASC,KAAK,GAAG,CAACb,SAAiB1B,QAAQ0B,OAAOC,IAAI;QACxD;QACA,OAAOW;IACT,GAAG;QAACtC;KAAQ;IAEZ,qBACE,KAACzB;QACCiE,IAAI;YACF3C,OAAOA;YACPC,QAAQA;QACV;QACA2C,QAAQvC;QACRwC,OAAOzC,YAAY0C,YAAY;QAC/BC,UAAUP;;AAGhB"}