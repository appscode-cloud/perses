"use strict";(self.webpackChunkPrometheus=self.webpackChunkPrometheus||[]).push([["9606"],{8702:function(e,t,a){a.r(t),a.d(t,{PrometheusTimeSeriesQuery:()=>y});var r=a(58891),s=a(29085),n=a(20461),l=a(87629);function u(e,t){let a=[];return Object.keys(e).sort().forEach(r=>{let s=e[r];void 0!==s&&(t?a.push(`"${r}":"${s}"`):a.push(`${r}="${s}"`))}),`{${a.join(",")}}`}function o(e,t,a){let r=function(e){let{removeExprWrap:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="__name__";if(Object.prototype.hasOwnProperty.call(e,a)){let r=u({...e,[a]:void 0},t);return t?`${r}`:`${e[a]}${r}`}return u(e,t)}(t),s=a?a.replace(/\{\{\s*(.+?)\s*\}\}/g,(e,a)=>t[a]??""):r;return{name:r,formattedName:s}}var i=a(13690),c=a(6421);let d=async(e,t)=>{let a;if(void 0===e.query||null===e.query||""===e.query)return{series:[]};let u=await t.datasourceStore.listDatasourceSelectItems(l.nY),d=(0,r.datasourceSelectValueToSelector)(e.datasource??l.Mm,t.variableState,u)??l.Mm,m=await t.datasourceStore.getDatasource(d),p=Math.trunc((0,n.milliseconds)((0,s.Ib)(m.plugin.spec.scrapeInterval??i.v))/1e3),h=(0,l.k7)((0,r.replaceVariables)(e.minStep,t.variableState))??p,v=(0,l.Bf)(t.timeRange),g=(0,l.wd)(v,h,void 0,t.suggestedStepMs),{start:S,end:f}=v,b=60*new Date().getTimezoneOffset(),y=Math.floor((f+b)/g)*g-b;S=Math.floor((S+b)/g)*g-b,(f=y)===S&&(f=S+g,console.warn(`Step (${g}) was larger than the time range! end of time range was set accordingly.`));let w=(0,c.d)(e.query,1e3*h,1e3*g);w=(0,r.replaceVariables)(w,t.variableState);let q=e.seriesNameFormat;q&&(q=(0,r.replaceVariables)(q,t.variableState));let x=await t.datasourceStore.getDatasourceClient(d),C=(a="instant"===t.mode?await x.instantQuery({query:w,time:f}):await x.rangeQuery({query:w,start:S,end:f,step:g})).data,D=[];if("success"===a.status){let e=(a.warnings??[])[0]??"";""!==e&&D.push({type:"warning",message:e})}return{timeRange:{start:(0,n.fromUnixTime)(S),end:(0,n.fromUnixTime)(f)},stepMs:1e3*g,series:function(e,t,a){if(!t)return[];let r=t.resultType;switch(r){case"vector":return t.result.map(t=>{let{metric:r,value:s,histogram:n}=t,{name:u,formattedName:i}=o(e,r,a);return n?{name:u,formattedName:i,labels:r,values:[(0,l.qJ)([n[0],n[1].sum])],histograms:[n]}:{name:u,formattedName:i,labels:r,values:[(0,l.qJ)(s)]}});case"matrix":return t.result.map(t=>{let{metric:r,values:s,histograms:n}=t,{name:u,formattedName:i}=o(e,r,a);return n?{name:u,formattedName:i,labels:r,values:n.map(e=>(0,l.qJ)([e[0],e[1].sum])),histograms:n.map(e=>e)}:{name:u,formattedName:i,labels:r,values:s.map(l.qJ)}});case"scalar":return function(e,t,a){let{name:r,formattedName:s}=o(e,{},a);return[{name:r,values:[(0,l.qJ)(t.result)],formattedName:s}]}(e,t,a);default:return console.warn("Unknown result type",r,t),[]}}(w,C,q),metadata:{notices:D,executedQueryString:w}}};var m=a(24246),p=a(75586),h=a(72629),v=a(25283),g=a(90192),S=a(8695),f=a(82901),b=a(54538);let y={getTimeSeriesData:d,OptionsEditorComponent:function(e){let{onChange:t,value:a}=e,{datasource:s}=a,n=s??l.Mm,u=(0,h.useId)("prom-datasource-label"),o=(0,r.useDatasourceSelectValueToSelector)(n,l.nY),{data:c}=(0,r.useDatasourceClient)(o),d=null==c?void 0:c.options.datasourceUrl,{data:y}=(0,r.useDatasource)(o),{handleQueryChange:w,handleQueryBlur:q}=function(e){let{onChange:t,value:a}=e,[r,s]=(0,b.useState)(a.query),[n,l]=(0,b.useState)(a.query);return a.query!==n&&(s(a.query),l(a.query)),{query:r,handleQueryChange:e=>{s(e)},handleQueryBlur:()=>{l(r),t((0,p.Uy)(a,e=>{e.query=r}))}}}(e),{format:x,handleFormatChange:C,handleFormatBlur:D}=function(e){let{onChange:t,value:a}=e,[r,s]=(0,b.useState)(a.seriesNameFormat),[n,l]=(0,b.useState)(a.seriesNameFormat);return a.seriesNameFormat!==n&&(s(a.seriesNameFormat),l(a.seriesNameFormat)),{format:r,handleFormatChange:e=>{s(e)},handleFormatBlur:()=>{l(r),t((0,p.Uy)(a,e=>{e.seriesNameFormat=r}))}}}(e),{minStep:M,handleMinStepChange:T,handleMinStepBlur:j}=function(e){let{onChange:t,value:a}=e,[r,s]=(0,b.useState)(a.minStep),[n,l]=(0,b.useState)(a.minStep);return a.minStep!==n&&(s(a.minStep),l(a.minStep)),{minStep:r,handleMinStepChange:e=>{s(e)},handleMinStepBlur:()=>{l(r),t((0,p.Uy)(a,e=>{e.minStep=r}))}}}(e),F=M??(y&&(null==y?void 0:y.plugin.spec).scrapeInterval)??i.v;return(0,m.jsxs)(v.Z,{spacing:2,children:[(0,m.jsx)(g.Z,{margin:"dense",fullWidth:!1,children:(0,m.jsx)(r.DatasourceSelect,{datasourcePluginKind:l.nY,value:n,onChange:e=>{if((0,l.sv)(e)){t((0,p.Uy)(a,t=>{let a=(0,l.Rv)(e)?void 0:e;t.datasource=a}));return}throw Error("Got unexpected non-Prometheus datasource selector")},labelId:u,label:"Prometheus Datasource",notched:!0})}),(0,m.jsx)(f.P,{completeConfig:{remote:{url:d}},value:a.query,datasource:o,onChange:w,onBlur:q}),(0,m.jsxs)(v.Z,{direction:"row",spacing:2,children:[(0,m.jsx)(S.Z,{fullWidth:!0,label:"Legend",placeholder:"Example: '{{instance}}' will generate series names like 'webserver-123', 'webserver-456'...",helperText:"Text to be displayed in the legend and the tooltip. Use {{label_name}} to interpolate label values.",value:x??"",onChange:e=>C(e.target.value),onBlur:D}),(0,m.jsx)(S.Z,{label:"Min Step",placeholder:F,helperText:"Lower bound for the step. If not provided, the scrape interval of the datasource is used.",value:M??"",onChange:e=>T(e.target.value?e.target.value:void 0),onBlur:j,sx:{width:"250px"}})]})]})},createInitialOptions:()=>({query:"",datasource:void 0}),dependsOn:e=>{let t=(0,r.parseVariables)(e.query);return{variables:[...new Set([...t,...(0,r.parseVariables)(e.seriesNameFormat||""),...(0,r.isVariableDatasource)(e.datasource)?(0,r.parseVariables)(e.datasource??""):[]])]}}}},13690:function(e,t,a){a.d(t,{v:()=>r});let r="1m"}}]);