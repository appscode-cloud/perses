{"version":3,"sources":["../../src/StatusHistoryPanel.tsx"],"sourcesContent":["// Copyright 2024 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Box } from '@mui/material';\nimport { ContentWithLegend, useChartsTheme } from '@perses-dev/components';\nimport { PanelProps, validateLegendSpec } from '@perses-dev/plugin-system';\nimport { merge } from 'lodash';\nimport { ReactElement, useMemo } from 'react';\nimport { TimeSeriesData } from '@perses-dev/core';\nimport { useStatusHistoryDataModel } from './utils/data-transform';\nimport { StatusHistoryChartOptions } from './status-history-model.js';\nimport { StatusHistoryChartBase } from './StatusHistoryChartBase';\n\nexport type StatusHistoryChartPanelProps = PanelProps<StatusHistoryChartOptions, TimeSeriesData>;\n\nexport function StatusHistoryPanel(props: StatusHistoryChartPanelProps): ReactElement | null {\n  const { spec, contentDimensions, queryResults } = props;\n\n  const legend = useMemo(() => {\n    return spec.legend && validateLegendSpec(spec.legend) ? merge({}, spec.legend) : undefined;\n  }, [spec.legend]);\n\n  const chartsTheme = useChartsTheme();\n  const PADDING = chartsTheme.container.padding.default;\n\n  const { statusHistoryData, yAxisCategories, xAxisCategories, legendItems, timeScale, colors } =\n    useStatusHistoryDataModel(queryResults, chartsTheme.echartsTheme.color as string[], spec);\n\n  const adjustedContentDimensions: typeof contentDimensions = contentDimensions\n    ? {\n        width: contentDimensions.width - PADDING * 2,\n        height: contentDimensions.height - PADDING * 2,\n      }\n    : undefined;\n\n  if (!statusHistoryData || statusHistoryData.length === 0) {\n    return null;\n  }\n\n  return (\n    <Box sx={{ padding: `${PADDING}px` }}>\n      <ContentWithLegend\n        width={adjustedContentDimensions?.width ?? 400}\n        height={adjustedContentDimensions?.height ?? 1000}\n        legendSize={legend?.size}\n        legendProps={\n          legend && {\n            options: legend,\n            data: legendItems || [],\n            selectedItems: 'ALL',\n            onSelectedItemsChange: () => null,\n          }\n        }\n      >\n        {({ height, width }) => {\n          return (\n            <Box sx={{ height, width }}>\n              <StatusHistoryChartBase\n                xAxisCategories={xAxisCategories}\n                yAxisCategories={yAxisCategories}\n                data={statusHistoryData}\n                timeScale={timeScale}\n                height={height}\n                colors={colors}\n              />\n            </Box>\n          );\n        }}\n      </ContentWithLegend>\n    </Box>\n  );\n}\n"],"names":["Box","ContentWithLegend","useChartsTheme","validateLegendSpec","merge","useMemo","useStatusHistoryDataModel","StatusHistoryChartBase","StatusHistoryPanel","props","spec","contentDimensions","queryResults","legend","undefined","chartsTheme","PADDING","container","padding","default","statusHistoryData","yAxisCategories","xAxisCategories","legendItems","timeScale","colors","echartsTheme","color","adjustedContentDimensions","width","height","length","sx","legendSize","size","legendProps","options","data","selectedItems","onSelectedItemsChange"],"mappings":"AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;AAEjC,SAASA,GAAG,QAAQ,gBAAgB;AACpC,SAASC,iBAAiB,EAAEC,cAAc,QAAQ,yBAAyB;AAC3E,SAAqBC,kBAAkB,QAAQ,4BAA4B;AAC3E,SAASC,KAAK,QAAQ,SAAS;AAC/B,SAAuBC,OAAO,QAAQ,QAAQ;AAE9C,SAASC,yBAAyB,QAAQ,yBAAyB;AAEnE,SAASC,sBAAsB,QAAQ,2BAA2B;AAIlE,OAAO,SAASC,mBAAmBC,KAAmC;IACpE,MAAM,EAAEC,IAAI,EAAEC,iBAAiB,EAAEC,YAAY,EAAE,GAAGH;IAElD,MAAMI,SAASR,QAAQ;QACrB,OAAOK,KAAKG,MAAM,IAAIV,mBAAmBO,KAAKG,MAAM,IAAIT,MAAM,CAAC,GAAGM,KAAKG,MAAM,IAAIC;IACnF,GAAG;QAACJ,KAAKG,MAAM;KAAC;IAEhB,MAAME,cAAcb;IACpB,MAAMc,UAAUD,YAAYE,SAAS,CAACC,OAAO,CAACC,OAAO;IAErD,MAAM,EAAEC,iBAAiB,EAAEC,eAAe,EAAEC,eAAe,EAAEC,WAAW,EAAEC,SAAS,EAAEC,MAAM,EAAE,GAC3FnB,0BAA0BM,cAAcG,YAAYW,YAAY,CAACC,KAAK,EAAcjB;IAEtF,MAAMkB,4BAAsDjB,oBACxD;QACEkB,OAAOlB,kBAAkBkB,KAAK,GAAGb,UAAU;QAC3Cc,QAAQnB,kBAAkBmB,MAAM,GAAGd,UAAU;IAC/C,IACAF;IAEJ,IAAI,CAACM,qBAAqBA,kBAAkBW,MAAM,KAAK,GAAG;QACxD,OAAO;IACT;IAEA,qBACE,KAAC/B;QAAIgC,IAAI;YAAEd,SAAS,GAAGF,QAAQ,EAAE,CAAC;QAAC;kBACjC,cAAA,KAACf;YACC4B,OAAOD,2BAA2BC,SAAS;YAC3CC,QAAQF,2BAA2BE,UAAU;YAC7CG,YAAYpB,QAAQqB;YACpBC,aACEtB,UAAU;gBACRuB,SAASvB;gBACTwB,MAAMd,eAAe,EAAE;gBACvBe,eAAe;gBACfC,uBAAuB,IAAM;YAC/B;sBAGD,CAAC,EAAET,MAAM,EAAED,KAAK,EAAE;gBACjB,qBACE,KAAC7B;oBAAIgC,IAAI;wBAAEF;wBAAQD;oBAAM;8BACvB,cAAA,KAACtB;wBACCe,iBAAiBA;wBACjBD,iBAAiBA;wBACjBgB,MAAMjB;wBACNI,WAAWA;wBACXM,QAAQA;wBACRL,QAAQA;;;YAIhB;;;AAIR"}