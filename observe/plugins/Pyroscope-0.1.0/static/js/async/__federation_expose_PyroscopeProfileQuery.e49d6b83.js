"use strict";(self.webpackChunkPyroscope=self.webpackChunkPyroscope||[]).push([["6936"],{10763:function(e,a,l){a.default=void 0;var t,r=(t=l(30265))&&t.__esModule?t:{default:t};a.default=(0,r.default)("M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z","Close")},28546:function(e,a,l){l.r(a),l.d(a,{PyroscopeProfileQuery:()=>P});var t=l(20461);let r="PyroscopeDatasource",n={kind:r},s=async(e,a)=>{let l=await a.datasourceStore.getDatasourceClient(e.datasource??{kind:r}),n=()=>{let a="";if(e.service&&(a=`service_name="${e.service}"`),e.filters&&e.filters.length>0){var l;let t=(l=e.filters,`${l.filter(e=>""!==e.labelName&&""!==e.labelValue).map(e=>`${e.labelName}${e.operator}"${e.labelValue}"`).join(",")}`);""===a?a=t:a+=","+t}return e.profileType+(""===a?"":"{"+a+"}")};return function(e){let a={profile:{stackTrace:{}},numTicks:0,maxSelf:0,metadata:{spyName:"",sampleRate:0,units:"",name:""},timeline:{startTime:0,samples:[],durationDelta:0}};if(!e)return a;let l=[],t=1;for(let a=0;a<e.flamebearer.levels.length;a++){let r=0,n=[];for(let l=0;l<e.flamebearer.levels[a].length;l+=4){let s={};s.id=t,t+=1;let i=e.flamebearer.levels[a][l+3];s.name=e.flamebearer.names[i],s.level=a,s.total=e.flamebearer.levels[a][l+1],s.self=e.flamebearer.levels[a][l+2],r+=e.flamebearer.levels[a][l],s.start=r,r+=e.flamebearer.levels[a][l+1],s.end=r,s.children=[],n.push(s)}l.push(n)}return function(e){for(let a=1;a<e.length;a++)for(let l=0;l<e[a].length;l++)for(let t=0;t<e[a-1].length;t++)if(e[a][l].start>=e[a-1][t].start&&e[a][l].end<=e[a-1][t].end){e[a-1][t].children.push(e[a][l]);break}}(l),a.profile.stackTrace=l[0][0],a.numTicks=e.flamebearer.numTicks,a.maxSelf=e.flamebearer.maxSelf,a.metadata={spyName:e.metadata.spyName,sampleRate:e.metadata.sampleRate,units:e.metadata.units,name:e.metadata.name},a.timeline={startTime:e.timeline.startTime,samples:e.timeline.samples,durationDelta:e.timeline.durationDelta},a}(await l.searchProfiles((()=>{let l={query:n(),from:"now-1h"};if(a.absoluteTimeRange){let{start:e,end:r}=function(e){let{start:a,end:l}=e;return{start:Math.ceil((0,t.getUnixTime)(a)),end:Math.ceil((0,t.getUnixTime)(l))}}(a.absoluteTimeRange);l.from=e,l.until=r}return e.maxNodes&&(l.maxNodes=e.maxNodes),l})()))};var i=l(24246),o=l(60243),u=l(54966),d=l(75586),c=l(25283),p=l(90192),m=l(68808),f=l(8695),h=l(50898),x=l(10517),v=l(91909);function b(e){let{datasource:a,value:l,onChange:t}=e,{data:r,isLoading:n}=function(e){let{data:a}=(0,o.useDatasourceClient)(e);return(0,v.useQuery)({enabled:!!a,queryKey:["searchProfileTypes","datasource",e],queryFn:async()=>await a.searchProfileTypes({},{"content-type":"application/json"},{})})}(a);return(0,i.jsx)(c.Z,{position:"relative",sx:{flexGrow:1,maxWidth:"100%"},children:(0,i.jsx)(f.Z,{select:!0,label:"Profile Type",value:l,size:"small",onChange:e=>null==t?void 0:t(e.target.value),children:n?(0,i.jsx)(c.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(h.Z,{color:"inherit",size:20})}):(null==r?void 0:r.profileTypes)&&(null==r?void 0:r.profileTypes.map(e=>(0,i.jsx)(x.Z,{value:e.ID,children:e.name+"/"+e.sampleType},e.ID)))})})}var y=l(94776);function g(e){let{datasource:a,value:l,onChange:t}=e,{data:r,isLoading:n}=function(e){let{data:a}=(0,o.useDatasourceClient)(e);return(0,v.useQuery)({enabled:!!a,queryKey:["searchServices","datasource",e],queryFn:async()=>await a.searchServices({},{"content-type":"application/json"})})}(a);return(0,i.jsx)(c.Z,{position:"relative",sx:{flexGrow:1,maxWidth:"100%",[(0,y.Z)().breakpoints.down("sm")]:{width:"100%"}},children:(0,i.jsx)(f.Z,{select:!0,label:"Service",value:l,size:"small",onChange:e=>null==t?void 0:t(e.target.value),children:n?(0,i.jsx)(c.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(h.Z,{color:"inherit",size:20})}):(null==r?void 0:r.names)&&(null==r?void 0:r.names.map(e=>(0,i.jsx)(x.Z,{value:e,children:e},e)))})})}var j=l(63767);function C(e){let{datasource:a,value:l,onChange:t}=e,{data:r,isLoading:n}=function(e){let{data:a}=(0,o.useDatasourceClient)(e);return(0,v.useQuery)({enabled:!!a,queryKey:["searchLabelNames","datasource",e],queryFn:async()=>await a.searchLabelNames({},{"content-type":"application/json"},{})})}(a);return(0,i.jsx)(j.Z,{sx:{borderTopRightRadius:"0",borderBottomRightRadius:"0"},value:l,size:"small",onChange:e=>null==t?void 0:t(e.target.value),displayEmpty:!0,renderValue:e=>""===e?"Select label name":e,children:n?(0,i.jsx)(c.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(h.Z,{color:"inherit",size:20})}):(null==r?void 0:r.names)&&(function(e){let a=/^__.*__$/;return e.filter(e=>!a.test(e)&&"service_name"!==e)})(null==r?void 0:r.names).map(e=>(0,i.jsx)(x.Z,{value:e,children:e},e))})}function N(e){let{value:a,onChange:l}=e;return(0,i.jsx)(j.Z,{sx:{borderRadius:"0"},value:a,size:"small",onChange:e=>null==l?void 0:l(e.target.value),children:["=","!=","=~","!~"].map(e=>(0,i.jsx)(x.Z,{value:e,children:e},e))})}function T(e){let{datasource:a,value:l,labelName:t,onChange:r}=e,{data:n,isLoading:s}=function(e,a){let{data:l}=(0,o.useDatasourceClient)(e);return(0,v.useQuery)({enabled:!!l,queryKey:["searchLabelValues",a,"datasource",e],queryFn:async()=>await l.searchLabelValues({},{"content-type":"application/json"},{name:a})})}(a,t);return(0,i.jsx)(j.Z,{sx:{borderRadius:"0"},value:l,size:"small",onChange:e=>null==r?void 0:r(e.target.value),displayEmpty:!0,disabled:!t||""===t,renderValue:e=>""===e?"Select label value":e,children:s?(0,i.jsx)(c.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(h.Z,{color:"inherit",size:20})}):(null==n?void 0:n.names)&&(null==n?void 0:n.names.map(e=>(0,i.jsx)(x.Z,{value:e,children:e},e)))})}var Z=l(10763);function w(e){let{onClick:a}=e;return(0,i.jsx)(u.ToolbarIconButton,{sx:{borderTopLeftRadius:"0",borderBottomLeftRadius:"0"},"aria-label":"delete filter",onClick:a,children:(0,i.jsx)(Z.default,{})})}function k(e){let{datasource:a,value:l,onChange:t,deleteItem:r}=e;return(0,i.jsxs)(c.Z,{direction:"row",spacing:0,sx:{flexWrap:"wrap",maxWidth:"100%"},children:[(0,i.jsx)(C,{datasource:a,value:l.labelName,onChange:e=>{null==t||t({labelName:e,labelValue:"",operator:l.operator})}}),(0,i.jsx)(N,{value:l.operator,onChange:e=>{null==t||t({labelName:l.labelName,labelValue:l.labelValue,operator:e})}}),(0,i.jsx)(T,{datasource:a,value:l.labelValue,labelName:l.labelName,onChange:e=>{null==t||t({labelName:l.labelName,labelValue:e,operator:l.operator})}}),(0,i.jsx)(w,{onClick:()=>{null==r||r()}})]})}var L=l(33755);function S(e){let{onClick:a}=e;return(0,i.jsx)(u.ToolbarIconButton,{"aria-label":"add filter",onClick:a,children:(0,i.jsx)(L.default,{})})}function D(e){let a=(0,y.Z)(),{datasource:l,value:t,onChange:r}=e,n=(e,a)=>{let l=[...t];l[e]=a,null==r||r(l)},s=e=>{let a=[...t];a.splice(e,1),0===a.length?null==r||r([{labelName:"",labelValue:"",operator:"="}]):null==r||r(a)};return(0,i.jsxs)(c.Z,{position:"relative",direction:"row",spacing:0,sx:{flexWrap:"wrap",rowGap:1,gap:1,padding:"10px",border:`1px solid ${a.palette.action.disabled}`,borderRadius:`${a.shape.borderRadius}px`,"&:hover":{borderColor:a.palette.text.primary}},children:[(0,i.jsx)(m.Z,{shrink:!0,sx:{position:"absolute",top:"-6px",left:"10px",padding:"0 4px",color:a.palette.text.primary,backgroundColor:a.palette.background.default,zIndex:1},children:"Filters"}),t.map((e,a)=>(0,i.jsx)(k,{datasource:l,value:e,onChange:e=>n(a,e),deleteItem:()=>s(a)},`${e.labelName}:${e.operator}:${e.labelValue}`)),(0,i.jsx)(S,{onClick:()=>{let e=[...t,{labelName:"",labelValue:"",operator:"="}];null==r||r(e)}})]})}var I=l(54538);let P={getProfileData:s,OptionsEditorComponent:function(e){let{onChange:a,value:l}=e,{datasource:t}=l,s=t??n,h=(0,u.useId)("pyroscope-datasource-label"),{maxNodes:x,handleMaxNodesChange:v,maxNodesHasError:y}=function(e){let{onChange:a,value:l}=e,[t,r]=(0,I.useState)(l.maxNodes?l.maxNodes.toString():""),[n,s]=(0,I.useState)(l.maxNodes);l.maxNodes!==n&&(r(l.maxNodes?l.maxNodes.toString():""),s(l.maxNodes));let i=!(""===t||/^[0-9]+$/.test(t)&&parseInt(t)>0);return{maxNodes:t,handleMaxNodesChange:e=>{r(e),a((0,d.Uy)(l,a=>{a.maxNodes=""===e?void 0:parseInt(e)}))},maxNodesHasError:i}}(e),{profileType:j,handleProfileTypeChange:C}=function(e){let{onChange:a,value:l}=e,[t,r]=(0,I.useState)(l.profileType?l.profileType:""),[n,s]=(0,I.useState)(l.profileType);return l.profileType!==n&&(r(l.profileType),s(l.profileType)),{profileType:t,handleProfileTypeChange:e=>{r(e),a((0,d.Uy)(l,a=>{a.profileType=e}))}}}(e),{service:N,handleServiceChange:T}=function(e){let{onChange:a,value:l}=e,[t,r]=(0,I.useState)(l.service?l.service:""),[n,s]=(0,I.useState)(l.service);return l.service!==n&&(r(l.service||""),s(l.service)),{service:t,handleServiceChange:e=>{r(e),a((0,d.Uy)(l,a=>{a.service=e}))}}}(e),{filters:Z,handleFiltersChange:w}=function(e){let{onChange:a,value:l}=e,[t,r]=(0,I.useState)(l.filters?l.filters:[]);return{filters:t,handleFiltersChange:e=>{r(e),a((0,d.Uy)(l,a=>{a.filters=e}))}}}(e);return(0,i.jsxs)(c.Z,{spacing:2,children:[(0,i.jsxs)(p.Z,{margin:"dense",fullWidth:!1,children:[(0,i.jsx)(m.Z,{id:h,shrink:!0,children:"Pyroscope Datasource"}),(0,i.jsx)(o.DatasourceSelect,{datasourcePluginKind:r,value:s,onChange:e=>{if("object"==typeof e&&"kind"in e&&"name"in e&&e.kind===r){a((0,d.Uy)(l,a=>{let l=void 0===e.name?void 0:e;a.datasource=l}));return}throw Error("Got unexpected non-Pyroscope datasource selector")},labelId:h,label:"Pyroscope Datasource",notched:!0})]}),(0,i.jsxs)(c.Z,{direction:"row",spacing:0,sx:{flexWrap:"wrap",rowGap:1,gap:2},children:[(0,i.jsx)(g,{datasource:s,value:N,onChange:T}),(0,i.jsx)(b,{datasource:s,value:j,onChange:C}),(0,i.jsx)(f.Z,{size:"small",label:"Max Nodes",value:x,error:y,onChange:e=>v(e.target.value),sx:{width:"110px"}})]}),(0,i.jsx)(D,{datasource:s,value:Z,onChange:w})]})},createInitialOptions:()=>({maxNodes:0,datasource:void 0,service:"",profileType:"",filters:[{labelName:"",labelValue:"",operator:"="}]})}}}]);