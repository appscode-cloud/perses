{"version":3,"sources":["../../../src/plugins/PrometheusLabelNamesVariable.tsx"],"sourcesContent":["import { VariablePlugin, GetVariableOptionsContext, replaceVariables, parseVariables } from '@perses-dev/plugin-system';\nimport { PrometheusClient, DEFAULT_PROM, getPrometheusTimeRange } from '../model';\nimport { stringArrayToVariableOptions, PrometheusLabelNamesVariableEditor } from './prometheus-variables';\nimport { PrometheusLabelNamesVariableOptions } from './types';\n\nexport const PrometheusLabelNamesVariable: VariablePlugin<PrometheusLabelNamesVariableOptions> = {\n  getVariableOptions: async (spec: PrometheusLabelNamesVariableOptions, ctx: GetVariableOptionsContext) => {\n    const client: PrometheusClient = await ctx.datasourceStore.getDatasourceClient(spec.datasource ?? DEFAULT_PROM);\n    const match = spec.matchers ? spec.matchers.map((m) => replaceVariables(m, ctx.variables)) : undefined;\n    const timeRange = getPrometheusTimeRange(ctx.timeRange);\n\n    const { data: options } = await client.labelNames({ 'match[]': match, ...timeRange });\n    return {\n      data: stringArrayToVariableOptions(options),\n    };\n  },\n  dependsOn: (spec: PrometheusLabelNamesVariableOptions) => {\n    return { variables: spec.matchers?.map((m) => parseVariables(m)).flat() || [] };\n  },\n  OptionsEditorComponent: PrometheusLabelNamesVariableEditor,\n  createInitialOptions: () => ({}),\n};\n"],"names":["replaceVariables","parseVariables","DEFAULT_PROM","getPrometheusTimeRange","stringArrayToVariableOptions","PrometheusLabelNamesVariableEditor","PrometheusLabelNamesVariable","getVariableOptions","spec","ctx","client","datasourceStore","getDatasourceClient","datasource","match","matchers","map","m","variables","undefined","timeRange","data","options","labelNames","dependsOn","flat","OptionsEditorComponent","createInitialOptions"],"mappings":"AAAA,SAAoDA,gBAAgB,EAAEC,cAAc,QAAQ,4BAA4B;AACxH,SAA2BC,YAAY,EAAEC,sBAAsB,QAAQ,WAAW;AAClF,SAASC,4BAA4B,EAAEC,kCAAkC,QAAQ,yBAAyB;AAG1G,OAAO,MAAMC,+BAAoF;IAC/FC,oBAAoB,OAAOC,MAA2CC;QACpE,MAAMC,SAA2B,MAAMD,IAAIE,eAAe,CAACC,mBAAmB,CAACJ,KAAKK,UAAU,IAAIX;QAClG,MAAMY,QAAQN,KAAKO,QAAQ,GAAGP,KAAKO,QAAQ,CAACC,GAAG,CAAC,CAACC,IAAMjB,iBAAiBiB,GAAGR,IAAIS,SAAS,KAAKC;QAC7F,MAAMC,YAAYjB,uBAAuBM,IAAIW,SAAS;QAEtD,MAAM,EAAEC,MAAMC,OAAO,EAAE,GAAG,MAAMZ,OAAOa,UAAU,CAAC;YAAE,WAAWT;YAAO,GAAGM,SAAS;QAAC;QACnF,OAAO;YACLC,MAAMjB,6BAA6BkB;QACrC;IACF;IACAE,WAAW,CAAChB;QACV,OAAO;YAAEU,WAAWV,KAAKO,QAAQ,EAAEC,IAAI,CAACC,IAAMhB,eAAegB,IAAIQ,UAAU,EAAE;QAAC;IAChF;IACAC,wBAAwBrB;IACxBsB,sBAAsB,IAAO,CAAA,CAAC,CAAA;AAChC,EAAE"}