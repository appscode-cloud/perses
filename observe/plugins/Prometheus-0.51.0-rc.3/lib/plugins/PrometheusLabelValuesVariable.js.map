{"version":3,"sources":["../../../src/plugins/PrometheusLabelValuesVariable.tsx"],"sourcesContent":["import { VariablePlugin, GetVariableOptionsContext, replaceVariables, parseVariables } from '@perses-dev/plugin-system';\nimport { PrometheusClient, DEFAULT_PROM, getPrometheusTimeRange } from '../model';\nimport { stringArrayToVariableOptions, PrometheusLabelValuesVariableEditor } from './prometheus-variables';\nimport { PrometheusLabelValuesVariableOptions } from './types';\n\nexport const PrometheusLabelValuesVariable: VariablePlugin<PrometheusLabelValuesVariableOptions> = {\n  getVariableOptions: async (spec: PrometheusLabelValuesVariableOptions, ctx: GetVariableOptionsContext) => {\n    const pluginDef = spec;\n    const client: PrometheusClient = await ctx.datasourceStore.getDatasourceClient(spec.datasource ?? DEFAULT_PROM);\n    const match = pluginDef.matchers ? pluginDef.matchers.map((m) => replaceVariables(m, ctx.variables)) : undefined;\n\n    const timeRange = getPrometheusTimeRange(ctx.timeRange);\n\n    const { data: options } = await client.labelValues({\n      labelName: replaceVariables(pluginDef.labelName, ctx.variables),\n      'match[]': match,\n      ...timeRange,\n    });\n    return {\n      data: stringArrayToVariableOptions(options),\n    };\n  },\n  dependsOn: (spec: PrometheusLabelValuesVariableOptions) => {\n    return {\n      variables:\n        spec.matchers\n          ?.map((m) => parseVariables(m))\n          .flat()\n          .concat(parseVariables(spec.labelName)) || [],\n    };\n  },\n  OptionsEditorComponent: PrometheusLabelValuesVariableEditor,\n  createInitialOptions: () => ({ labelName: '' }),\n};\n"],"names":["replaceVariables","parseVariables","DEFAULT_PROM","getPrometheusTimeRange","stringArrayToVariableOptions","PrometheusLabelValuesVariableEditor","PrometheusLabelValuesVariable","getVariableOptions","spec","ctx","pluginDef","client","datasourceStore","getDatasourceClient","datasource","match","matchers","map","m","variables","undefined","timeRange","data","options","labelValues","labelName","dependsOn","flat","concat","OptionsEditorComponent","createInitialOptions"],"mappings":"AAAA,SAAoDA,gBAAgB,EAAEC,cAAc,QAAQ,4BAA4B;AACxH,SAA2BC,YAAY,EAAEC,sBAAsB,QAAQ,WAAW;AAClF,SAASC,4BAA4B,EAAEC,mCAAmC,QAAQ,yBAAyB;AAG3G,OAAO,MAAMC,gCAAsF;IACjGC,oBAAoB,OAAOC,MAA4CC;QACrE,MAAMC,YAAYF;QAClB,MAAMG,SAA2B,MAAMF,IAAIG,eAAe,CAACC,mBAAmB,CAACL,KAAKM,UAAU,IAAIZ;QAClG,MAAMa,QAAQL,UAAUM,QAAQ,GAAGN,UAAUM,QAAQ,CAACC,GAAG,CAAC,CAACC,IAAMlB,iBAAiBkB,GAAGT,IAAIU,SAAS,KAAKC;QAEvG,MAAMC,YAAYlB,uBAAuBM,IAAIY,SAAS;QAEtD,MAAM,EAAEC,MAAMC,OAAO,EAAE,GAAG,MAAMZ,OAAOa,WAAW,CAAC;YACjDC,WAAWzB,iBAAiBU,UAAUe,SAAS,EAAEhB,IAAIU,SAAS;YAC9D,WAAWJ;YACX,GAAGM,SAAS;QACd;QACA,OAAO;YACLC,MAAMlB,6BAA6BmB;QACrC;IACF;IACAG,WAAW,CAAClB;QACV,OAAO;YACLW,WACEX,KAAKQ,QAAQ,EACTC,IAAI,CAACC,IAAMjB,eAAeiB,IAC3BS,OACAC,OAAO3B,eAAeO,KAAKiB,SAAS,MAAM,EAAE;QACnD;IACF;IACAI,wBAAwBxB;IACxByB,sBAAsB,IAAO,CAAA;YAAEL,WAAW;QAAG,CAAA;AAC/C,EAAE"}