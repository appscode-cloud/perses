"use strict";(self.webpackChunkPrometheus=self.webpackChunkPrometheus||[]).push([["5742"],{35015:function(e,t,n){async function l(...e){let t=await n.g.fetch(...e);if(!1===t.ok){let e=t.headers.get("content-type");if(e?.includes("application/json")){let e=await t.json();if(e.error)throw new i(e.error,t.status);if(e.message)throw new i(e.message,t.status)}let n=await t.text();if(n)throw new i(n,t.status);throw new r(t)}return t}async function a(...e){let t=await l(...e);return await t.json()}n.d(t,{he:()=>l,rd:()=>a});class r extends Error{status;constructor(e){super(`${e.status} ${e.statusText}`),this.status=e.status,Object.setPrototypeOf(this,r.prototype)}}class i extends Error{status;constructor(e,t){super(e),this.status=t,Object.setPrototypeOf(this,i.prototype)}}},30666:function(e,t,n){t.default=void 0;var l,a=(l=n(30265))&&l.__esModule?l:{default:l};t.default=(0,a.default)("M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z","ArrowLeft")},82562:function(e,t,n){t.default=void 0;var l,a=(l=n(30265))&&l.__esModule?l:{default:l};t.default=(0,a.default)("M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z","Check")},77463:function(e,t,n){t.default=void 0;var l,a=(l=n(30265))&&l.__esModule?l:{default:l};t.default=(0,a.default)("M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z","Cog")},50737:function(e,t,n){t.default=void 0;var l,a=(l=n(30265))&&l.__esModule?l:{default:l};t.default=(0,a.default)("M14.19,14.19L6,18L9.81,9.81L18,6M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,10.9A1.1,1.1 0 0,0 10.9,12A1.1,1.1 0 0,0 12,13.1A1.1,1.1 0 0,0 13.1,12A1.1,1.1 0 0,0 12,10.9Z","Compass")},88160:function(e,t,n){t.default=void 0;var l,a=(l=n(30265))&&l.__esModule?l:{default:l};t.default=(0,a.default)("M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z","HelpCircleOutline")},66268:function(e,t,n){t.default=void 0;var l,a=(l=n(30265))&&l.__esModule?l:{default:l};t.default=(0,a.default)("M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z","Magnify")},27472:function(e,t,n){n.r(t),n.d(t,{PrometheusExplorer:()=>ew});var l=n(24246),a=n(36372),r=n(25283),i=n(51781),s=n(49408),o=n(58891),d=n(90382),u=n(75276),c=n(32600),h=n(65456),x=n(75094),f=n(5549),p=n(10517),m=n(28797),j=n(82707),g=n(50898),b=n(8695),v=n(76992),Z=n(76439),C=n(94776),w=n(48565);function y(e){return e.to-e.from+1}function M(e,t){let n=e[t],l=null;return 0===t&&0!==n.from&&(l={from:0,to:n.from-1}),t>0&&(l={from:e[t-1].to+1,to:n.from-1}),l}class S{constructor(e){this.conf={caseSensitive:(null==e?void 0:e.caseSensitive)!==void 0&&e.caseSensitive,excludedChars:(null==e?void 0:e.excludedChars)===void 0?[]:e.excludedChars,includeMatches:(null==e?void 0:e.includeMatches)!==void 0&&e.includeMatches,shouldSort:(null==e?void 0:e.shouldSort)!==void 0&&e.shouldSort,shouldRender:(null==e?void 0:e.shouldRender)===void 0||e.shouldRender,escapeHTML:(null==e?void 0:e.escapeHTML)!==void 0&&e.escapeHTML,pre:(null==e?void 0:e.pre)===void 0?"":e.pre,post:(null==e?void 0:e.post)===void 0?"":e.post}}filter(e,t,n){let l=(null==n?void 0:n.shouldSort)!==void 0?n.shouldSort:this.conf.shouldSort,a=[];for(let l=0;l<t.length;l++){let r=this.match(e,t[l],n);null!==r&&(r.index=l,a.push(r))}return l&&(a=a.sort((e,t)=>t.score-e.score)),a}match(e,t,n){let l=e,a=t,r=(null==n?void 0:n.caseSensitive)!==void 0?n.caseSensitive:this.conf.caseSensitive,i=(null==n?void 0:n.includeMatches)!==void 0?n.includeMatches:this.conf.includeMatches,s=(null==n?void 0:n.shouldRender)!==void 0?n.shouldRender:this.conf.shouldRender;if(r||(l=l.toLowerCase(),a=a.toLowerCase()),l===a){let l=[{from:0,to:e.length-1}],a={original:t,rendered:s?this.render(t,l,n):t,score:1/0};return i&&(a.intervals=l),a}let o=[],d=0;for(let e=0;e<a.length-l.length+1;e++)if(a[e]===l[0]){let t=this.generateMatchingInterval(l,a,e,n);if(null===t)break;t.score>d&&(d=t.score,o=t.intervals)}if(0===o.length)return null;let u={original:t,rendered:s?this.render(t,o,n):t,score:d};return i&&(u.intervals=o),u}render(e,t,n){if(0==t.length)return e;let l="",a=(null==n?void 0:n.pre)?n.pre:this.conf.pre,r=(null==n?void 0:n.post)?n.post:this.conf.post;for(let i=0;i<t.length;i++){let s=t[i],o=M(t,i),d="";null!==o&&(d=this.extractSubString(e,o,n));let u=this.extractSubString(e,s,n);l=`${l}${d}${a}${u}${r}`}let i=t[t.length-1];return i.to<e.length-1&&(l+=this.extractSubString(e,{from:i.to+1,to:e.length},n)),l}extractSubString(e,t,n){let l=(null==n?void 0:n.escapeHTML)!==void 0?n.escapeHTML:this.conf.escapeHTML,a=e.substr(t.from,y(t));return l&&(a=a.replace(/[&<>"']/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return"&#039;"}})),a}generateMatchingInterval(e,t,n,l){let a=[];(null==l?void 0:l.excludedChars)!==void 0?a=l.excludedChars:void 0!==this.conf.excludedChars&&(a=this.conf.excludedChars);let r=0,i=[];for(let l=n;l<t.length&&r<e.length;){if(a.includes(t[l])){l++;continue}if(a.includes(e[r])){r++;continue}if(t[l]===e[r]){let n={from:l,to:l};r++,l++;for(let a=l;a<t.length&&r<e.length&&t[a]===e[r];a++)n.to=a,r++,l=a;i.push(n)}l++}return 0===i.length||r!==e.length?null:{score:function(e,t){let n=0;for(let l=0;l<e.length;l++){let a=e[l],r=M(e,l);null!==r&&(n-=y(r)/t),n+=y(a)**2}return n}(i,t.length),intervals:i}}}new S;var L=n(30666),k=n(77463),_=n(66268),E=n(54538),I=n(67430),A=n(87629),T=n(96205),P=n(52054),V=n(66224),$=n(79119),F=n(50737),O=n(83675),q=n(91909);function N(e){return`${e.map(e=>`${e.label}${e.operator}"${e.labelValues.join("|")}"`).join(",")}`}function R(e,t,n){let{data:l}=(0,o.useDatasourceClient)(t),a=e.replace(/(_count|_sum|_bucket)$/,""),{data:r,isLoading:i,error:s}=(0,q.useQuery)({enabled:!!l&&n,queryKey:["metricMetadata",a],queryFn:async()=>await l.metricMetadata({metric:a})});return{metadata:(0,E.useMemo)(()=>{var e;for(let t of(null==r?void 0:null===(e=r.data)||void 0===e?void 0:e[a])??[])if(t.help.length>0)return t},[r,a]),isLoading:i,error:s}}function H(e,t,n){let{absoluteTimeRange:{start:l,end:a}}=(0,o.useTimeRange)(),{data:r}=(0,o.useDatasourceClient)(n);return(0,q.useQuery)({enabled:!!r,queryKey:["labelValues",e,"datasource",n.name,"start",l,"end","filters",...t],queryFn:async()=>{let n={labelName:e,start:l.valueOf()/1e3,end:a.valueOf()/1e3};return t.length&&(n["match[]"]=[`{${N(t)}}`]),await r.labelValues(n)}})}var D=n(52889);function Q(e){let{label:t,...n}=e;return"gauge"===t?(0,l.jsx)(D.Z,{label:t,color:"success",...n}):"counter"===t?(0,l.jsx)(D.Z,{label:t,color:"primary",...n}):"histogram"===t?(0,l.jsx)(D.Z,{label:t,color:"warning",...n}):"summary"===t?(0,l.jsx)(D.Z,{label:t,color:"secondary",...n}):(0,l.jsx)(D.Z,{label:t,sx:{fontStyle:"unknown"===t?"italic":"initial"},...n})}function W(e){let{children:t,metricName:n,datasource:a,filters:r,isMetadataEnabled:i,onExplore:s}=e,{metadata:o,isLoading:u}=R(n,a,i),c=(0,d.useExplorerQueryParams)({data:{tab:"finder",datasource:a,filters:r,exploredMetric:n}});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(T.Z,{style:{width:"300px"},children:(0,l.jsx)(P.Z,{sx:{fontFamily:"monospace"},children:t??n})}),(0,l.jsx)(T.Z,{style:{width:115,textAlign:"center"},children:i&&u?(0,l.jsx)(V.Z,{variant:"rounded",width:75}):(0,l.jsx)(Q,{label:(null==o?void 0:o.type)??"unknown"})}),(0,l.jsx)(T.Z,{style:{width:"100%"},children:i&&u?(0,l.jsx)(V.Z,{variant:"text",width:180}):(0,l.jsx)(P.Z,{sx:{fontStyle:(null==o?void 0:o.help)?"initial":"italic",minWidth:"30vw"},children:o?o.help:"unknown"})}),(0,l.jsx)(T.Z,{style:{width:140},children:(0,l.jsx)(w.Z,{"aria-label":`explore metric ${n}`,variant:"contained",startIcon:(0,l.jsx)(F.default,{}),style:{textWrap:"nowrap"},onClick:()=>null==s?void 0:s(n),component:I.Link,to:`?${c}`,children:"Explore"})})]})}function z(e){let{metricNames:t,filteredResults:n,datasource:a,filters:i,isMetadataEnabled:s,onExplore:o,...d}=e,u=new S,c=(0,E.useMemo)(()=>n||t.map(e=>({original:e})),[n,t]);return(0,l.jsxs)(r.Z,{gap:2,width:"100%",divider:(0,l.jsx)($.Z,{orientation:"horizontal",flexItem:!0}),...d,children:[(0,l.jsx)(O._n,{style:{height:"70vh",width:"100%"},totalCount:c.length,itemContent:e=>(0,l.jsx)(W,{metricName:c[e].original,datasource:a,filters:i,isMetadataEnabled:s,onExplore:o,children:(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:u.render(c[e].original,c[e].intervals??[],{pre:'<strong style="color:darkorange">',post:"</strong>",escapeHTML:!0})}})})}),(0,l.jsx)(r.Z,{sx:{width:"100%"},textAlign:"end",children:(0,l.jsxs)(P.Z,{"data-testid":"finder-total",children:["Total: ",(0,l.jsx)("strong",{children:t.length})," metrics"]})})]})}var Y=n(90192),J=n(68808),K=n(33755),B=n(11774),U=n(82562),G=n(80354);function X(e){let{datasource:t,value:n,filters:a,onChange:r,onDelete:i}=e,s=(0,E.useMemo)(()=>a.filter(e=>e.label!==n.label),[a,n.label]),{data:d,isLoading:u}=function(e,t){let{absoluteTimeRange:{start:n,end:l}}=(0,o.useTimeRange)(),{data:a}=(0,o.useDatasourceClient)(t);return(0,q.useQuery)({enabled:!!a,queryKey:["labels","datasource",t.name,"start",n,"end",l,"filters",...e],queryFn:async()=>{let t={start:n.valueOf()/1e3,end:l.valueOf()/1e3};return e.length&&(t["match[]"]=[`{${N(e)}}`]),await a.labelNames(t)}})}(s,t),{data:c,isLoading:h}=H(n.label,s,t);return(0,l.jsx)(et,{value:n,labelOptions:(null==d?void 0:d.data)??[],labelValuesOptions:(null==c?void 0:c.data)??[],isLabelOptionsLoading:u,isLabelValuesOptionsLoading:h,onChange:r,onDelete:i})}let ee=(0,E.forwardRef)((e,t)=>{let{children:n,...a}=e,r=(0,E.useRef)("500px"),[i,s]=(0,E.useState)(0);return(0,l.jsx)("ul",{style:{overflow:"hidden",padding:"0",height:i?`min(40vh, ${i}px)`:"40vh"},ref:e=>{let n=e?getComputedStyle(e).maxHeight:null;n&&n!==r.current&&(r.current=n),"function"==typeof t&&t(e)},...a,children:(0,l.jsx)(O.OO,{style:{height:r.current,padding:"10px 0"},data:n,totalListHeightChanged:s,itemContent:(e,t)=>(0,E.cloneElement)(t,{index:e,title:t.props.children})})})});function et(e){let{value:t,labelOptions:n,labelValuesOptions:a,isLabelOptionsLoading:r,isLabelValuesOptionsLoading:i,onChange:s,onDelete:o}=e,[d,u]=(0,E.useState)(0===t.labelValues.length),[c,h]=(0,E.useState)(t.label);function f(){u(!1),s({label:c,labelValues:t.labelValues,operator:t.operator})}return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(B.Z,{freeSolo:!0,disableClearable:!0,options:n??[],value:t.label,sx:{minWidth:250,display:d?"block":"none"},ListboxComponent:ee,loading:r,renderInput:e=>(0,l.jsx)(b.Z,{...e,label:"Label Name",variant:"outlined",fullWidth:!0,size:"medium",InputProps:{...e.InputProps,endAdornment:(0,l.jsxs)(v.Z,{position:"end",children:[r?(0,l.jsx)(g.Z,{color:"inherit",size:20}):null,(0,l.jsx)(x.Z,{"aria-label":"validate label name",onClick:()=>f(),edge:"end",children:(0,l.jsx)(U.default,{})})]})}}),onKeyDown:function(e){d&&"Enter"===e.key&&f()},onInputChange:(e,t)=>{h(t??"")}}),(0,l.jsx)(B.Z,{freeSolo:!0,multiple:"=~"===t.operator||"!~"===t.operator,limitTags:1,disableClearable:!0,options:a??[],value:t.labelValues,ListboxComponent:ee,sx:{minWidth:250,display:d?"none":"block"},loading:i,renderInput:e=>(0,l.jsx)(b.Z,{...e,label:t.label,variant:"outlined",fullWidth:!0,size:"medium",InputProps:{...e.InputProps,startAdornment:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(v.Z,{position:"start",children:t.operator}),e.InputProps.startAdornment]}),endAdornment:(0,l.jsxs)(v.Z,{position:"end",children:[i?(0,l.jsx)(g.Z,{color:"inherit",size:20}):null,(0,l.jsx)(x.Z,{"aria-label":"delete label filter",onClick:()=>o(),edge:"end",children:(0,l.jsx)(G.default,{})})]})}}),onChange:(e,n)=>{"string"==typeof n&&s({label:t.label,labelValues:[n],operator:t.operator}),Array.isArray(n)&&s({label:t.label,labelValues:n,operator:t.operator})}})]})}function en(e){let{datasource:t,filters:n,filteredFilters:a,onDatasourceChange:i,onFiltersChange:s,...d}=e,{data:u}=(0,o.useListDatasourceSelectItems)(h.nY);return(0,l.jsxs)(r.Z,{...d,direction:"row",alignItems:"center",flexWrap:"wrap",gap:1,sx:{width:"100%"},children:[(0,l.jsxs)(Y.Z,{children:[(0,l.jsx)(J.Z,{children:"Prometheus Datasource"}),(0,l.jsx)(o.DatasourceSelect,{datasourcePluginKind:h.nY,value:t,onChange:function(e){i((0,o.datasourceSelectValueToSelector)(e,{},u)??{kind:h.nY})},label:"Prometheus Datasource"})]}),n.map((e,r)=>(0,l.jsx)(X,{datasource:t,filters:a,value:e,onChange:e=>{let t=[...n];t[r]=e,s(t)},onDelete:()=>{let e=[...n];e.splice(r,1),s(e)}},r)),(0,l.jsx)(w.Z,{startIcon:(0,l.jsx)(K.default,{}),"aria-label":"add filter",onClick:()=>{s([...n,{label:"",labelValues:[],operator:"=~"}])},children:"Add filter"})]})}ee.displayName="ListboxComponent";var el=n(32964),ea=n(88160),er=n(63767),ei=n(10763),es=n(72629);function eo(e){let{label:t,valueCounters:n,onFilterAdd:a,...i}=e,[s,o]=(0,E.useState)(!1),[d,u]=(0,E.useState)("="),[c,h]=(0,E.useState)(""),[f,m]=(0,E.useState)(!1),j=(0,Z.Z)((0,C.Z)().breakpoints.down("md")),g=(0,E.useMemo)(()=>f?n:n.slice(0,5),[f,n]);return(0,l.jsxs)(r.Z,{sx:{width:"100%"},direction:j?"column":"row",alignItems:"center",gap:2,...i,children:[(0,l.jsxs)(r.Z,{sx:{width:"100%",height:"100%"},justifyContent:"space-between",alignContent:"center",direction:j?"column":"row",children:[(0,l.jsx)(P.Z,{sx:{fontFamily:"monospace"},pl:+!j,children:t}),(0,l.jsx)(r.Z,{direction:"row",gap:1,alignItems:"center",children:s?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(er.Z,{size:"small",value:d,variant:"outlined",onChange:e=>{u(e.target.value)},children:[(0,l.jsx)(p.Z,{value:"=",children:"="}),(0,l.jsx)(p.Z,{value:"!=",children:"!="}),(0,l.jsx)(p.Z,{value:"=~",children:"=~"}),(0,l.jsx)(p.Z,{value:"!~",children:"!~"})]}),(0,l.jsx)(B.Z,{freeSolo:!0,limitTags:1,disableClearable:!0,options:n.map(e=>e.labelValue),value:c,ListboxComponent:ee,sx:{width:250},renderInput:e=>(0,l.jsx)(b.Z,{...e,label:"Value",variant:"outlined",fullWidth:!0,size:"small"}),onInputChange:(e,t)=>{h(t)}}),(0,l.jsx)(x.Z,{"aria-label":"confirm",onClick:()=>{a({label:t,labelValues:[c],operator:d}),o(!1)},children:(0,l.jsx)(U.default,{})}),(0,l.jsx)(x.Z,{"aria-label":"cancel",onClick:()=>{o(!1)},children:(0,l.jsx)(ei.default,{})})]}):(0,l.jsx)(w.Z,{startIcon:(0,l.jsx)(K.default,{}),"aria-label":"add filter",onClick:()=>o(!0),children:"Add filter"})})]}),(0,l.jsxs)(r.Z,{sx:{width:"100%"},gap:.5,children:[(0,l.jsx)(r.Z,{direction:"row",gap:2,children:(0,l.jsxs)(P.Z,{variant:"subtitle1",children:[n.length," values"]})}),(0,l.jsx)(r.Z,{sx:{overflow:j?"auto":"unset"},children:g.map(e=>(0,l.jsxs)(r.Z,{direction:"row",gap:2,children:[(0,l.jsx)(P.Z,{sx:{color:e=>e.palette.success.main,fontFamily:"monospace",":hover":{backgroundColor:"rgba(127,127,127,0.35)",cursor:"pointer"},textWrap:j?"nowrap":"unset"},onClick:()=>a({label:t,labelValues:[e.labelValue],operator:"="}),children:e.labelValue}),(0,l.jsxs)(P.Z,{sx:{textWrap:"nowrap"},children:["(",e.counter," series)"]})]},`${t}-${e.labelValue}`))}),(0,l.jsx)(r.Z,{width:"100%",textAlign:j?"center":"unset",children:f?(0,l.jsx)(w.Z,{variant:"text",sx:{width:"fit-content"},onClick:()=>m(!1),children:"Hide full values"}):(0,l.jsx)(l.Fragment,{children:n.length>5&&(0,l.jsxs)(w.Z,{variant:"text",sx:{width:"fit-content"},onClick:()=>m(!0),children:["Show ",n.length-5," more values"]})})})]})]},t)}function ed(e){let{labelValueCounters:t,isLoading:n,onFilterAdd:a,...i}=e,s=(0,E.useMemo)(()=>[...t.keys()].sort(),[t]);return n?(0,l.jsx)(r.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(g.Z,{})}):(0,l.jsxs)(r.Z,{sx:{width:"100%"},divider:(0,l.jsx)($.Z,{flexItem:!0,orientation:"horizontal"}),gap:2,...i,children:[(0,l.jsxs)(r.Z,{gap:2,direction:"row",sx:{width:"100%"},children:[(0,l.jsx)(r.Z,{sx:{width:"100%"},children:(0,l.jsx)(P.Z,{variant:"h3",children:"Label"})}),(0,l.jsx)(r.Z,{sx:{width:"100%"},children:(0,l.jsx)(P.Z,{variant:"h3",children:"Values"})})]}),s.map(e=>(0,l.jsx)(eo,{label:e,valueCounters:t.get(e)??[],onFilterAdd:a},e))]})}function eu(e){let{metricName:t,datasource:n,filters:a,onFilterAdd:i,...s}=e,{metadata:d,isLoading:u,error:c}=R(t,n),{series:h,labelValueCounters:x,isLoading:f,error:p}=function(e,t,n){let{absoluteTimeRange:{start:l,end:a}}=(0,o.useTimeRange)(),{data:r}=(0,o.useDatasourceClient)(n),{data:i,isLoading:s,isError:d,error:u}=(0,q.useQuery)({enabled:!!r,queryKey:["series",e,"datasource",n,"start",l,"end","filters",...t],queryFn:async()=>{let e={"match[]":[`{${N(t)}}`],start:l.valueOf()/1e3,end:a.valueOf()/1e3};return await r.series(e)}}),c=(0,E.useMemo)(()=>{let e=new Map;if((null==i?void 0:i.data)===void 0)return e;for(let t of i.data)for(let[n,l]of Object.entries(t)){let t=e.get(n);if(void 0===t){e.set(n,[{labelValue:l,counter:1}]);continue}let a=t.find(e=>e.labelValue===l);void 0===a?t.push({labelValue:l,counter:1}):a.counter+=1}return e},[i]);return{series:null==i?void 0:i.data,labelValueCounters:c,isLoading:s,isError:d,error:u}}(t,a,n);return(0,l.jsxs)(r.Z,{gap:2,...s,children:[(0,l.jsxs)(r.Z,{direction:"row",gap:3,mt:1,justifyContent:"space-between",children:[(0,l.jsxs)(r.Z,{gap:1,children:[(0,l.jsx)(P.Z,{variant:"h1",sx:{fontFamily:"monospace"},children:t}),(0,l.jsx)(P.Z,{children:"Description:"}),u?(0,l.jsx)(V.Z,{variant:"text",width:180}):(0,l.jsx)(P.Z,{style:{fontStyle:(null==d?void 0:d.help)?"initial":"italic"},children:c?"Failed to fetch metadata":(null==d?void 0:d.help)??"unknown"})]}),(0,l.jsxs)(r.Z,{gap:1,justifyContent:"center",children:[u?(0,l.jsx)(V.Z,{variant:"rounded",width:75}):c?(0,l.jsx)(D.Z,{label:"failed to fetch",color:"error",sx:{fontStyle:"italic"}}):(0,l.jsx)(Q,{label:(null==d?void 0:d.type)??"unknown"}),(0,l.jsxs)(P.Z,{children:["Result:"," ",f?(0,l.jsx)(V.Z,{variant:"text",width:20,sx:{display:"inline-block"}}):p?(0,l.jsx)("strong",{children:"failed to fetch series"}):(0,l.jsxs)("strong",{children:[(null==h?void 0:h.length)??"unknown"," series"]})]})]})]}),p?(0,l.jsx)(es.ErrorAlert,{error:{name:`Failed to fetch series ${(null==p?void 0:p.status)&&`(${p.status})`}`,message:(null==p?void 0:p.message)??"Failed to fetch series"}}):(null==h?void 0:h.length)===0?(0,l.jsx)(r.Z,{...s,children:(0,l.jsx)(P.Z,{sx:{color:e=>e.palette.warning.main},children:"No series found with current filters."})}):(0,l.jsx)(ed,{labelValueCounters:x,onFilterAdd:i,isLoading:f})]})}function ec(e){let{job:t,filters:n,datasource:a,isMetadataEnabled:i,onExplore:s,...o}=e,d=(0,E.useMemo)(()=>{let e=n.filter(e=>"__name__"!==e.label&&"job"!==e.label);return e.push({label:"job",labelValues:[t],operator:"="}),e},[n,t]),{data:u,isLoading:c}=H("__name__",d,a);return c?(0,l.jsx)(r.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(g.Z,{})}):(0,l.jsx)(z,{metricNames:(null==u?void 0:u.data)??[],datasource:a,filters:d,isMetadataEnabled:i,onExplore:s,...o})}function eh(e){let{jobs:t,filters:n,datasource:a,isMetadataEnabled:i,onExplore:s,...o}=e,[d,u]=(0,E.useState)(t[0]??"");return d?(0,l.jsxs)(r.Z,{gap:2,...o,children:[t.length>2&&(0,l.jsxs)(Y.Z,{fullWidth:!0,children:[(0,l.jsx)(J.Z,{id:"job-select-label",children:"Job"}),(0,l.jsx)(er.Z,{labelId:"job-select-label",id:"job-select",label:"Job",variant:"outlined",value:d,onChange:e=>u(e.target.value),children:t.map(e=>(0,l.jsx)(p.Z,{value:e,children:e},e))})]}),d&&(0,l.jsx)(ec,{job:d,filters:n,datasource:a,isMetadataEnabled:i,onExplore:s})]}):(0,l.jsx)(P.Z,{children:"Something went wrong..."})}function ex(e){let{filters:t,datasource:n,isMetadataEnabled:a,onExplore:i,...s}=e,{data:o,isLoading:d}=H("job",t,n);return d?(0,l.jsx)(r.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(g.Z,{})}):(null==o?void 0:o.data)&&0!==o.data.length?(0,l.jsx)(eh,{jobs:o.data,filters:t,datasource:n,isMetadataEnabled:a,onExplore:i,...s}):(0,l.jsx)(r.Z,{...s,children:(0,l.jsx)(P.Z,{children:"No jobs found"})})}function ef(e){let{filters:t,datasource:n,isMetadataEnabled:a,onExplore:i,...s}=e,o=(0,E.useMemo)(()=>t.filter(e=>"__name__"!==e.label),[t]),{data:d,isLoading:u}=H("__name__",o,n);return u?(0,l.jsx)(r.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(g.Z,{})}):(0,l.jsx)(z,{metricNames:(null==d?void 0:d.data)??[],datasource:n,filters:o,isMetadataEnabled:a,onExplore:i,...s})}function ep(e){let{metricName:t,datasource:n,filters:a,type:i,isLoading:s,...d}=e,{width:h,ref:x}=(0,u.default)(),f=(0,o.useSuggestedStepMs)(h),[p,g]=(0,E.useState)(!0),{queries:b,definitions:v}=(0,E.useMemo)(()=>{let e=[{kind:"TimeSeriesQuery",spec:{plugin:{kind:"PrometheusTimeSeriesQuery",spec:{datasource:n,query:"counter"===i||p&&(void 0===i||"summary"===i||"histogram"===i)?`rate({__name__="${t}", ${N(a)}}[5m])`:`{__name__="${t}", ${N(a)}}`}}}}],l=e.map(e=>({kind:e.spec.plugin.kind,spec:e.spec.plugin.spec}));return{queries:e,definitions:l}},[n,a,t,p,i]);return s?(0,l.jsx)(r.Z,{...d,children:(0,l.jsx)(V.Z,{variant:"rectangular",height:"100%"})}):(0,l.jsxs)(r.Z,{ref:x,alignItems:"end",...d,children:[(void 0===i||"summary"===i||"histogram"===i)&&(0,l.jsx)(m.Z,{control:(0,l.jsx)(j.Z,{size:"small"}),label:"Enable rate",checked:p,onChange:(e,t)=>g(t)}),(0,l.jsx)(o.DataQueriesProvider,{definitions:v,options:{suggestedStepMs:f,mode:"range"},children:(0,l.jsx)(c.Panel,{panelOptions:{hideHeader:!0},definition:{kind:"Panel",spec:{queries:b,display:{name:""},plugin:{kind:"TimeSeriesChart",spec:{}}}}})})]})}function em(e){let{metricName:t,datasource:n,filters:a,isMetadataEnabled:o,isPanelEnabled:d,onExplore:u,onFiltersChange:c,...h}=e,[x,f]=(0,E.useState)(0),{metadata:p,isLoading:m}=R(t,n),j=(0,E.useMemo)(()=>{let e=a.filter(e=>"__name__"!==e.label);return e.push({label:"__name__",labelValues:[t],operator:"="}),e},[a,t]);function g(e,t){null==u||u(e),void 0!==t&&f(t)}return(0,l.jsxs)(r.Z,{sx:{width:"100%"},...h,children:[d&&(0,l.jsx)(ep,{metricName:t,filters:a,datasource:n,type:null==p?void 0:p.type,height:"250px",isLoading:o&&m}),(0,l.jsxs)(i.Z,{value:x,onChange:(e,t)=>f(t),variant:"scrollable",sx:{borderBottom:1,borderColor:"divider"},children:[(0,l.jsx)(s.Z,{label:"Overview"}),(0,l.jsx)(s.Z,{label:"Job related metrics",icon:(0,l.jsx)(el.Z,{title:"All metrics scraped from the same job",placement:"top",children:(0,l.jsx)(ea.default,{})}),iconPosition:"end"}),a.length>0&&(0,l.jsx)(s.Z,{label:"Similar metrics",icon:(0,l.jsx)(el.Z,{title:"All metrics matching current filters",placement:"top",children:(0,l.jsx)(ea.default,{})}),iconPosition:"end"})]}),(0,l.jsxs)(r.Z,{gap:1,children:[0===x&&(0,l.jsx)(eu,{metricName:t,datasource:n,filters:j,onFilterAdd:function(e){c([...a,e])}}),1===x&&(0,l.jsx)(ex,{filters:j,datasource:n,isMetadataEnabled:o,onExplore:e=>g(e,0)}),2===x&&(0,l.jsx)(ef,{filters:j,datasource:n,isMetadataEnabled:o,onExplore:e=>g(e,0)})]})]})}let ej="PERSES_METRICS_FINDER_SETTINGS";function eg(e){let{value:t,onChange:n}=e,[a,r]=(0,E.useState)(null);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.Z,{"aria-label":"settings",size:"large",onClick:e=>{r(e.currentTarget)},children:(0,l.jsx)(k.default,{})}),(0,l.jsxs)(f.Z,{id:"finder-settings-menu",anchorEl:a,open:!!a,onClose:()=>{r(null)},children:[(0,l.jsx)(p.Z,{onClick:e=>e.preventDefault(),children:(0,l.jsx)(m.Z,{control:(0,l.jsx)(j.Z,{}),label:"Enable Metadata",checked:t.isMetadataEnabled,onClick:()=>n({...t,isMetadataEnabled:!t.isMetadataEnabled})})}),(0,l.jsx)(p.Z,{onClick:e=>e.preventDefault(),children:(0,l.jsx)(m.Z,{control:(0,l.jsx)(j.Z,{}),label:"Enable Time Series Chart",checked:t.isPanelEnabled,onClick:()=>n({...t,isPanelEnabled:!t.isPanelEnabled})})})]})]})}function eb(e){let{datasource:t,filters:n,isMetadataEnabled:a,onExplore:i,...s}=e,{data:o,isLoading:d,error:u}=H("__name__",n,t),[c,h]=(0,E.useState)(""),x=(0,E.useMemo)(()=>new S({includeMatches:!0,excludedChars:[" "]}),[]),f=(0,E.useMemo)(()=>{if(c&&(null==o?void 0:o.data))return x.filter(c,o.data).sort((e,t)=>t.score-e.score)},[o,x,c]);return u?(0,l.jsxs)(r.Z,{width:"100%",children:["Error: ",u.message]}):d?(0,l.jsx)(r.Z,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(g.Z,{})}):(0,l.jsxs)(r.Z,{...s,children:[(0,l.jsx)(b.Z,{value:c,onChange:e=>h(e.target.value),placeholder:"Search metric name...",InputProps:{startAdornment:(0,l.jsx)(v.Z,{position:"start",children:(0,l.jsx)(_.default,{})})}}),(0,l.jsx)(z,{metricNames:(null==o?void 0:o.data)??[],filteredResults:f,datasource:t,filters:n,isMetadataEnabled:a,onExplore:i})]})}function ev(e){let{value:{datasource:t=A.Mm,filters:n=[],exploredMetric:a},onChange:i,onExplore:s,...o}=e,u=localStorage.getItem(ej),[c,h]=(0,E.useState)(u?JSON.parse(u):{isMetadataEnabled:!0}),x=(0,Z.Z)((0,C.Z)().breakpoints.down("md")),f=(0,E.useMemo)(()=>n.filter(e=>e.label&&e.labelValues.length>0),[n]),p=(0,d.useExplorerQueryParams)({data:{tab:"finder",datasource:t,filters:n,exploredMetric:void 0}});function m(e){i({datasource:t,filters:e,exploredMetric:a})}return(0,l.jsxs)(r.Z,{...o,gap:1,children:[(0,l.jsxs)(r.Z,{direction:x?"column":"row",gap:2,justifyContent:"space-between",children:[(0,l.jsx)(en,{datasource:t??A.Mm,filters:n??[],filteredFilters:f,onDatasourceChange:function(e){i({datasource:e,filters:n,exploredMetric:a})},onFiltersChange:m}),(0,l.jsxs)(r.Z,{direction:"row",gap:1,alignItems:"center",children:[a&&(0,l.jsx)(w.Z,{variant:"contained","aria-label":"back to metric explorer",startIcon:(0,l.jsx)(L.default,{}),component:I.Link,to:`?${p}`,children:"Back"}),(0,l.jsx)(r.Z,{direction:"row",sx:{width:x?"100%":"unset"},justifyContent:x?"end":"unset",alignItems:"center",children:(0,l.jsx)(eg,{value:c,onChange:function(e){h(e),localStorage.setItem(ej,JSON.stringify(e))}})})]})]}),a?(0,l.jsx)(em,{metricName:a,datasource:t??A.Mm,filters:f,isMetadataEnabled:c.isMetadataEnabled,isPanelEnabled:c.isPanelEnabled,onFiltersChange:m,onExplore:s}):(0,l.jsx)(eb,{datasource:t??A.Mm,filters:f,isMetadataEnabled:c.isMetadataEnabled,onExplore:s})]})}function eZ(e){let{queries:t}=e,{width:n,ref:r}=(0,u.default)(),i=(0,o.useSuggestedStepMs)(n),s=t.length?t.map(e=>({kind:e.spec.plugin.kind,spec:e.spec.plugin.spec})):[];return(0,l.jsx)(a.Z,{ref:r,height:700,children:(0,l.jsx)(o.DataQueriesProvider,{definitions:s,options:{suggestedStepMs:i,mode:"range"},children:(0,l.jsx)(c.Panel,{panelOptions:{hideHeader:!0},definition:{kind:"Panel",spec:{queries:t,display:{name:""},plugin:{kind:"TimeSeriesChart",spec:{}}}}})})})}function eC(e){let{queries:t}=e,n=t.map(e=>({kind:e.spec.plugin.kind,spec:e.spec.plugin.spec}));return(0,l.jsx)(a.Z,{height:700,children:(0,l.jsx)(o.DataQueriesProvider,{definitions:n,options:{mode:"instant"},children:(0,l.jsx)(c.Panel,{panelOptions:{hideHeader:!0},definition:{kind:"Panel",spec:{queries:t,display:{name:""},plugin:{kind:"TimeSeriesTable",spec:{}}}}})})})}function ew(){let{data:{tab:e="table",queries:t=[],datasource:n=h.Mm,filters:a=[],exploredMetric:u},setData:c}=(0,d.useExplorerManagerContext)();return(0,l.jsxs)(r.Z,{gap:2,sx:{width:"100%"},children:[(0,l.jsxs)(i.Z,{value:e,onChange:(e,n)=>c({tab:n,queries:t}),variant:"scrollable",sx:{borderBottom:1,borderColor:"divider"},children:[(0,l.jsx)(s.Z,{value:"table",label:"Table"}),(0,l.jsx)(s.Z,{value:"graph",label:"Graph"}),(0,l.jsx)(s.Z,{value:"finder",label:"Finder"})]}),(0,l.jsxs)(r.Z,{gap:1,children:["table"===e&&(0,l.jsxs)(r.Z,{children:[(0,l.jsx)(o.MultiQueryEditor,{queryTypes:["TimeSeriesQuery"],onChange:t=>c({tab:e,queries:t}),queries:t}),(0,l.jsx)(eC,{queries:t})]}),"graph"===e&&(0,l.jsxs)(r.Z,{children:[(0,l.jsx)(o.MultiQueryEditor,{queryTypes:["TimeSeriesQuery"],onChange:t=>c({tab:e,queries:t}),queries:t}),(0,l.jsx)(eZ,{queries:t})]}),"finder"===e&&(0,l.jsx)(r.Z,{children:(0,l.jsx)(ev,{onChange:t=>c({tab:e,...t}),value:{datasource:n,filters:a,exploredMetric:u}})})]})]})}},87629:function(e,t,n){function l(e){let[t,n]=e;return[1e3*t,function(e){let t;switch(e){case"+Inf":t=Number.POSITIVE_INFINITY;break;case"-Inf":t=Number.NEGATIVE_INFINITY;break;default:t=parseFloat(e)}return t}(n)]}n.d(t,{X2:()=>u,mB:()=>h,mY:()=>o,k7:()=>C,c4:()=>r,Nr:()=>i,Mm:()=>j.Mm,Fp:()=>s,Rv:()=>j.Rv,sv:()=>j.sv,ac:()=>c,qJ:()=>l,nY:()=>j.nY,Bf:()=>v,PL:()=>d,wd:()=>Z});var a=n(35015);function r(e){return async()=>{let t=`${e.datasourceUrl}/-/healthy`;try{let n=await (0,a.he)(t,{headers:e.headers});return 200===n.status}catch{return!1}}}function i(e,t){return f("/api/v1/query",e,t)}function s(e,t){return f("/api/v1/query_range",e,t)}function o(e,t){return f("/api/v1/labels",e,t)}function d(e,t){let{labelName:n,...l}=e;return 0===n.length?new Promise(e=>{e({data:[]})}):x(`/api/v1/label/${encodeURIComponent(n)}/values`,l,t)}function u(e,t){return x("/api/v1/metadata",e,t)}function c(e,t){return f("/api/v1/series",e,t)}function h(e,t){return f("/api/v1/parse_query",e,t)}function x(e,t,n){let{datasourceUrl:l,headers:r}=n,i=`${l}${e}`,s=p(t).toString();return""!==s&&(i+=`?${s}`),(0,a.rd)(i,{method:"GET",headers:r})}function f(e,t,n){let{datasourceUrl:l,headers:a}=n;return m(`${l}${e}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",...a},body:p(t)})}function p(e){let t=new URLSearchParams;for(let n in e){let l=e[n];if(void 0!==l){if("string"==typeof l){t.append(n,l);continue}if("number"==typeof l){t.append(n,l.toString());continue}for(let e of l)t.append(n,e)}}return t}async function m(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let l=await (0,a.he)(...t);return{...await l.json(),rawResponse:l}}var j=n(65456),g=n(29085),b=n(20461);function v(e){let{start:t,end:n}=e;return{start:Math.ceil((0,b.getUnixTime)(t)),end:Math.ceil((0,b.getUnixTime)(n))}}function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=(e.end-e.start)/1e4;return a>1&&(a=Math.ceil(a)),Math.max(l/1e3*n,t,a)}function C(e){if(!e)return;let t=(0,g.Ib)(e);return Math.floor((0,b.milliseconds)(t)/1e3)}},65456:function(e,t,n){n.d(t,{Mm:()=>r,Rv:()=>i,nY:()=>a,sv:()=>s});var l=n(58891);let a="PrometheusDatasource",r={kind:a};function i(e){return!(0,l.isVariableDatasource)(e)&&void 0===e.name}function s(e){return(0,l.isVariableDatasource)(e)||e.kind===a}}}]);